<?xml version="1.0"?>
<snippets>
  <branch title="phpTraining-0110">
    <branch title="project">
      <branch title="Functions">
        <leaf type="insert" title="fn_strings.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_strings.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1003   date: 2010-07-01
*
*		purpose:			string functions for use in alphaCRM		
*
*		Contents:		todGreeting()
*							fullCoName($coID, $preName, $coName, $regType)
*							shortCoName($coName, $regType)
*							coAddress($A, $B, $C)
*
*	===========================================================================
*/		
	
		function todGreeting()
		{	
			$todAMPM = date("A");
			$todHour = date("H");
			if ($todAMPM == "AM") {
				$todReturn = "Good Morning";	
			} else {
				if ($todHour &gt; 18) {
					$todReturn = "Good Evening";	
				} else {
					$todReturn = "Good Afternoon";	
				}
			}
			$todReturn = '&lt;span class="greeting"&gt;'.$todReturn.' ';
			$todReturn .= '&lt;span class="greetingName"&gt;'.$_COOKIE["username"].'&lt;/span&gt;&lt;/span&gt;';
							  
			return $todReturn;
		}

		function fullCoName($coID, $preName, $coName, $regType)
		{
			if (empty($coID)) {
				$temp = "Un-Allocated";
			} else {
				$temp = trim($preName." ".$coName." ".$regType);
			}
			return $temp;
		}


		function shortCoName($coName, $regType)
		{
			$temp = trim($coName." ".$regType);
			return $temp;
		}

		function coAddress($A, $B, $C)
		{
			$temp = $A;
			if (!empty($B)) { $temp .=  ", ".$B; }
			if (!empty($C)) { $temp .=  ", ".$C; }
			return $temp;
		}


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="...+ .todGreeting &gt; alphacrm_style">
          <before>
.greeting {
	font-size: 0.7em;
	color: maroon;
	padding-right: 10px;
	float: right;	
}

.greetingName {
	color: black;
}

.pageHint {
	font-size: 0.6em;
	color: maroon;
}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="...+ new header &gt; index">
          <before>			 &lt;div id="header"&gt;
		    	&lt;p class="todGreeting"&gt;
			    	&lt;?php 
		    			if ($loginAuthorised) { 
			    			echo todGreeting();
		    			} 
			    	?&gt;
		    	&lt;/p&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;				
		    &lt;/div&gt;&lt;!-- end header --&gt;

</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... *new: fn_authorise">
          <before>	function userAuthorised($username, $password) {

			$md5Password = md5($password);
			$tUser_SQLselect = "SELECT ID, username, password, accessLevel FROM tUser ";
			$tUser_SQLselect .= "WHERE username = '".$username."' ";	

			$tUser_SQLselect_Query = mysql_query($tUser_SQLselect); 	
			while ($row = mysql_fetch_array($tUser_SQLselect_Query, MYSQL_ASSOC)) {
			    $userID = $row['ID'];
			    $username = $row['username'];
			    $passwordRetrieved = $row['password'];
			    $accessLevel = $row['accessLevel'];
			}
		
			if (!empty($passwordRetrieved) AND ($md5Password == $passwordRetrieved)) {
	
					setcookie("accessLevel", $accessLevel, time()+7200, "/");	
					setcookie("userID", $userID, time()+7200, "/");	
					setcookie("loginAuthorised", "loginAuthorised", time()+7200, "/");
					setcookie("username", $username, time()+7200, "/");
					
					$returnCode = true;
					
					$sessionLogged = insertLogin($userID);
					if (!$sessionLogged) {
						setcookie("sessionLogging", "failed", time()+300, "/");
					}				
			} else {
				$returnCode = false;			
			}
			
		return $returnCode;
	}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_formatting.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_formatting.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1004   date: 2010-07-01
*
*		purpose:			format functions for use in alphaCRM		
*
*		Contents:		pageHint()
*
*	===========================================================================
*/		
	
		function pageHint($subject)
		{				
			$returnText = '&lt;span class="pageHints"&gt;.'.$subject.'&lt;/span&gt;';
							  
			return $returnText;
		}

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="...+ include_once &gt; index">
          <before>		include_once('includes/fn_formatting.php');
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="...pagehints &gt; tp_companyList">
          <before>	echo pageHint('&amp;nbsp;&amp;nbsp;^'.str_repeat('&amp;nbsp;',25).'^ click Company name to EDIT company details.');
	echo "&lt;br /&gt;";	
	echo pageHint('&amp;nbsp;&amp;nbsp;^ click ID to list PEOPLE in this company.');
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="eMail Check &gt; fn_strings (1005)">
          <before>/*  eMail Functions        vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv*/
/*							revisions 1005								 */

	   function check_email($email) {  
	    	if( (preg_match('/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/', $email)) || 
	    		(preg_match('/^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/',$email)) ) { 
				 return true;
	    	} else {
				 return false;
			}    	
	    }

	    function check_email_mx($email) {  
	    		$host = explode('@', $email);
   		
	    		if(checkdnsrr($host[1].'.', 'MX') ) return true;
	    		if(checkdnsrr($host[1].'.', 'A') ) return true;
	    		if(checkdnsrr($host[1].'.', 'CNAME') ) return true;
   		
	    	return false;
	    }

/*							revisions 1005								 */	
/*^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^*/</before>
          <after/>
        </leaf>
        <leaf type="insert" title="...  .dataError &gt; styleSheet (1005)">
          <before>
/*	revision 1005 */
.dataError {
	font-size: 1em;
	font-weight: bolder;
	color: red;	
}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... dataError() &gt; fn_formatting (1005)">
          <before>
		/*		revision    1005   */
		function dataError($subject)
		{				
			$returnText = '&lt;span class="dataError"&gt;'.$subject.'&lt;/span&gt;';
							  
			return $returnText;
		}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... *file fn_User_SQL (r1005)">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tUser_SQL.php
*
*		folder:			includes/
*
*		Used in:   		tp_userInsert.php
*
*		version:    	1005   date: 2010-07-02
*
*		purpose:			SQL commands for tUser, tAccessLog and tAccessControl
*
*		content:			function userInsert($username, $password, $passwordValidate, $eMail, $accessLevel)
*
*		revision 1005:	check for valid eMail - using: 
*							check_email_mx() and check_email() from fn_strings.php
*							format a return string:   dataError() from fn_formatting.php
*
*
*	===========================================================================
*/		

	function userInsert($username, $password, $passwordValidate, $eMail, $accessLevel) {

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (strlen($username) &lt; 5) { $errorMsg = "Username cannot be less than 5 characters&lt;br /&gt;"; }
			if (strlen($password) &lt; 5) { $errorMsg .= "Password cannot be less than 5 characters&lt;br /&gt;"; }
			if ($password &lt;&gt; $passwordValidate) { $errorMsg .= "Password retype does not match.&lt;br /&gt;"; }

			if (!empty($eMail)) {
				if (!check_email($eMail)) { $errorMsg = "Invalid eMail address format.&lt;br /&gt;";}
			}			
			if (!empty($eMail)) {
				if (!check_email_mx($eMail)) { $errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";}
			}
			
			$returnMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
		
		if (empty($errorMsg)) {
			
			$md5Password = md5($password);
			
			{  //   SQL:     $tUser_SQLinsert			
				$tUser_SQLinsert = "INSERT INTO tUser (";			
				$tUser_SQLinsert .=  "username, ";
				$tUser_SQLinsert .=  "password, ";
				$tUser_SQLinsert .=  "eMail, ";
				$tUser_SQLinsert .=  "accessLevel ";
				$tUser_SQLinsert .=  ") ";
				
				$tUser_SQLinsert .=  "VALUES (";
				$tUser_SQLinsert .=  "'".$username."', ";
				$tUser_SQLinsert .=  "'".$md5Password."', ";	
				$tUser_SQLinsert .=  "'".$eMail."', ";	
				$tUser_SQLinsert .=  "'".$accessLevel."' ";
				$tUser_SQLinsert .=  ") ";
			}
			
			if (mysql_query($tUser_SQLinsert))  {	
					$returnMsg = "User &lt;strong&gt;".$username."&lt;/strong&gt;";
					$returnMsg .= " was successfully inserted with ID# ";
					$returnMsg .= mysql_insert_id().".&lt;br /&gt;&lt;br /&gt;";

			} else {
					$errorMsg = "FAILED to add new person.&lt;br /&gt;";
					$errorMsg .= mysql_error()."&lt;br /&gt;&lt;br /&gt;";
					$returnMsg = dataError($errorMsg);
			}		
		} 		
				
		return $returnMsg;
		//		END: function userInsert()
	 }  

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... *Form &gt; tp_userInsert  (1005)">
          <before>		{	//	FORM postUser
			//							revision   1005 
			//							create field variables to retain current values.
			//	
			
			$fld_userInserted = '&lt;input type="hidden" name="userInserted" value="1"/&gt;';
			$fld_access = dropdownUserAccess($accessLevel);
	
			$fld_username = '&lt;input type="text" name="username" value="'.$username.'"/&gt;';
			$fld_password = '&lt;input type="password" name="password" value="'.$password.'"/&gt;';
			$fld_passwordValidate = '&lt;input type="text" name="passwordValidate" value="'.$passwordValidate.'"/&gt;';
			$fld_eMail = '&lt;input type="text" name="eMail" value="'.$eMail.'"/&gt;';

			echo '&lt;form name="postUser" action="index.php?content=insertUser" method="post"&gt;';
					echo $fld_userInserted;
					echo '
					&lt;table&gt;
						&lt;tr&gt;
							&lt;td&gt;username&lt;/td&gt;
							&lt;td&gt;'.$fld_username.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;password&lt;/td&gt;
							&lt;td&gt;'.$fld_password.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;retype password&lt;/td&gt;
							&lt;td&gt;'.$fld_passwordValidate.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;eMail&lt;/td&gt;
							&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;access level&lt;/td&gt;
							&lt;td&gt;'.$fld_access.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;&lt;/td&gt;
							&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
					&lt;/table&gt;
					';
						
			echo '&lt;/form&gt;';
		//	END: FORM postUser 
		}			
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... insert &gt; tp_userInsert (1005)">
          <before>		{	//		Insert New tUser Record
			//												revision    1005
			//												uses:     userInsert(..)  r1005 		
		
			if(isset($userInserted) AND $userInserted == '1'){
				
				$newUserMsg = userInsert($username, $password, $passwordValidate, $eMail, $accessLevel);
				
				echo $newUserMsg;
				
				unset($userInserted);
			}		
		//		END:  Insert New tUser Record		
		}
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="eMail">
        <leaf type="insert" title="tp_eMailForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_eMailForm.php
*
*		folder:			includes/
*
*		used in:       tp_companyPeopleEdit.php
*
*		version:    	1202   date: 2010-07-03
*
*		purpose:		   send eMail to email address in tPerson
*
*	===========================================================================
*/


$personID = $_POST["personID"];
if(!isset($personID)) {$personID = $_GET["personID"]; }

{	//  Get the details of tPerson where ID = $personID

		$tPerson_SQLselect = "SELECT * ";
		$tPerson_SQLselect .= "FROM ";
		$tPerson_SQLselect .= "tPerson ";
		$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
		
		$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
		
		while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {

			$Salutation = $row['Salutation'];
			$FirstName = $row['FirstName'];
			$LastName = $row['LastName'];
			$Tel = $row['Tel'];
			$eMail = $row['eMail'];	
			$CompanyID = $row['CompanyID'];	
		}
}
	
{	//  Get the SMTP server	and default FROM address	
		$tLookup_SQLselect = "SELECT * ";
		$tLookup_SQLselect .= "FROM tLookup ";
		$tLookup_SQLselect .= "WHERE lookupType LIKE 'eMail_%' ";
		
		$tLookup_SQLselect_Query = mysql_query($tLookup_SQLselect);	
		
		while ($row = mysql_fetch_array($tLookup_SQLselect_Query, MYSQL_ASSOC)) {
			if ($row['lookupType'] == "eMail_server") { 
				$SMTPserver= $row['lookupValue'];
			}		
			if ($row['lookupType'] == "eMail_fromAddress") { 
				$FromMail= $row['lookupValue'];
			}				 
		}
}			
		
$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];
if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 

				//		$ToMail  comes from SELECT from tPersons 
				$ToMail = $eMail;
				// 	$FromMail comes from SELECT from tLookup
				
				$subject = $_POST['subject'];
				$message = $_POST['message'];
		
				$headers =   'From: '.$FromMail."\r\n" .
							    'Reply-To: '.$FromMail."\r\n" .
							    'X-Mailer: PHP/' . phpversion();
				
				ini_set("SMTP",$SMTPserver);		
				$mailSent = mail($ToMail, $subject, $message, $headers);
						
				//		vvvvvvvvvvvvvvvvvvvvv  eMail SENT HERE vvvvvvvvvvvvvvvvvvvvvvvvv		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					$msg = eMailSentLog("P", $personID, 1, 0, $subject, $message);
					//		&gt;&gt;   error trap here if needed ^^^^^
					
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';	
					$backLink = 'index.php?content=eMailFormLink&amp;personID='.$personID;
					echo '&lt;a href="'.$backLink.'"&gt;try again...&lt;/a&gt;';		
				}		
				//    ^^^^^^^^^^^^^^^^^^^^^^^   eMail Out ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
		}
		
} else {
			

		{	//		FORM to get eMail details 

				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1&gt;';
				$personID_fld = '&lt;input type="hidden" name="personID" value='.$personID.'&gt;';	
				
				$subject_fld = '&lt;input type="text" name="subject" size="43"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="index.php?content=eMailFormLink"&gt;';
						echo $sendWasClicked_fld;
						echo $personID_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$eMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$FromMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Message&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
		//		END: FORM to get eMail details			
		} 
		
} 

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$CompanyID.'"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... &gt; index">
          <before>				    //	revision  1202:   eMailForm as link in tp_companyPeopleEdit.php
				    //							opens   tp_eMailForm.php
				    case "eMailFormLink":
				        $contentFile = "includes/tp_eMailForm.php";
				        break;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... *new tp_companyPeopleEdit.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	1204   date: 2010-07-03
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*							1204 - add email opened by clicking eMail address 
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
					
				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';

				//	revision 1202:                 $eMailFormLink
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;eMail&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1202:                 $eMailFormLink

					
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$eMailFormLink.'&amp;nbsp;&lt;/td&gt;';	//	revision 1202

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="Table: tMailLog">
          <before>CREATE TABLE alphacrm.tMailLog (
ID INT( 11 ) NOT NULL AUTO_INCREMENT PRIMARY KEY ,
mailTargetType VARCHAR( 1 ) NOT NULL ,
targetID INT( 11 ) NOT NULL ,
templateID INT( 11 ) DEFAULT '0' ,
contentID INT( 11 ) DEFAULT '1',
subjectText VARCHAR(255) NOT NULL ,
contentText TEXT NOT NULL DEFAULT '',
mailDateTime DATETIME NOT NULL
)</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... fn_eMailLog.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_eMailLog.php
*
*		folder:			includes/
*
*		used in:       tp_eMailForm.php
*
*		version:    	1205   date: 2010-07-03
*
*		purpose:		   log eMail sent
*
*	===========================================================================
*/

//			mailTargetType = P or C  - for Person or Company 
//			targetID  =  ID from tPerson or tCompany 

function eMailSentLog( 	$mailTargetType, $targetID, 
								$templateID, 
								$contentID, $subjectText, $contentText) {
	
		$mailDateTime = date("Y-m-d H:i:s",strtotime("now"));
		
		$errorMsg = "";	
		$tMailLog_SQLinsert = "INSERT INTO tMailLog (";			
		$tMailLog_SQLinsert .=  "mailTargetType, ";
		$tMailLog_SQLinsert .=  "targetID, ";
		$tMailLog_SQLinsert .=  "templateID, ";
		$tMailLog_SQLinsert .=  "contentID, ";	
		$tMailLog_SQLinsert .=  "subjectText, ";	
		$tMailLog_SQLinsert .=  "contentText, ";	
		$tMailLog_SQLinsert .=  "mailDateTime ";
		$tMailLog_SQLinsert .=  ") ";
		
		$tMailLog_SQLinsert .=  "VALUES (";
		$tMailLog_SQLinsert .=  "'".$mailTargetType."', ";
		$tMailLog_SQLinsert .=  "'".$targetID."', ";
		$tMailLog_SQLinsert .=  "'".$templateID."', ";
		$tMailLog_SQLinsert .=  "'".$contentID."', ";	
		$tMailLog_SQLinsert .=  "'".$subjectText."', ";	
		$tMailLog_SQLinsert .=  "'".$contentText."', ";	
		$tMailLog_SQLinsert .=  "'".$mailDateTime."' ";
		$tMailLog_SQLinsert .=  ") ";


		if (!mysql_query($tMailLog_SQLinsert))  {	
			$errorMsg = dataError("FAILED to add new mail log.");
		}

		return $errorMsg;
	
}


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... &gt; tp_eMailForm.php">
          <before>				//		vvvvvvvvvvvvvvvvvvvvv  eMail SENT HERE vvvvvvvvvvvvvvvvvvvvvvvvv		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					$msg = eMailSentLog("P", $personID, 1, 0, $subject, $message);
					//		&gt;&gt;   error trap here if needed ^^^^^
					
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';	
					$backLink = 'index.php?content=eMailFormLink&amp;personID='.$personID;
					echo '&lt;a href="'.$backLink.'"&gt;try again...&lt;/a&gt;';		
				}		
				//    ^^^^^^^^^^^^^^^^^^^^^^^   eMail Out ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... include &gt; index">
          <before>		include_once('includes/fn_eMailLog.php');
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="Deletions">
        <leaf type="insert" title="SQL - add fields">
          <before>ALTER TABLE tPerson ADD delUserID INT NULL ,
ADD delTime DATETIME NOT NULL;

ALTER TABLE tCompany ADD delUserID INT NULL ,
ADD delTime DATETIME NOT NULL;

ALTER TABLE tUser ADD delUserID INT NULL ,
ADD delTime DATETIME NOT NULL;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="switch suspend &gt; index">
          <before>				    //	revision  1301:   suspend record
				    case "personSuspend":
				        $contentFile = "includes/tp_personSuspend.php";
				        break;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. *new - fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1302   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*							personSuspend - make records as suspended
*
*		revisions  
*						1010 validates eMail addresses
*						1302 personSuspend($tableName ,$recordID)
*
*	===========================================================================
*/		

	function suspendRecord($tableName ,$recordID) {

			$delUserID = $_COOKIE["userID"];
			$delTime = date("Y-m-d H:i:s",strtotime("now"));

			$suspend_SQL = "UPDATE ".$tableName." SET ";			
			$suspend_SQL .=  "delUserID = '".$delUserID."', "; 		
			$suspend_SQL .=  "delTime = '".$delTime."' ";

			$suspend_SQL .=  "WHERE ID = '".$recordID."' "; 	
		
			if (mysql_query($suspend_SQL))  {
				$errorMsg = "Record Deleted.";							
			} else {
				$errorMsg =  dataError("FAILED to delete record.");
			}
			
			return $errorMsg;
					
	}
	
	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		//		revision:    1010

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

			if (!empty($eMail)) {
				if (!check_email($eMail)) { 
					$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
				} else {
					if (!check_email_mx($eMail)) { 
						$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
					}
				}
			}				
		}

		if (empty($errorMsg)) {
			$tPerson_SQLinsert = "INSERT INTO tPerson (";			
			$tPerson_SQLinsert .=  "Salutation, ";
			$tPerson_SQLinsert .=  "FirstName, ";
			$tPerson_SQLinsert .=  "LastName, ";
			$tPerson_SQLinsert .=  "Tel, ";	
			$tPerson_SQLinsert .=  "eMail, ";	
			$tPerson_SQLinsert .=  "companyID ";
			$tPerson_SQLinsert .=  ") ";
			
			$tPerson_SQLinsert .=  "VALUES (";
			$tPerson_SQLinsert .=  "'".$Salutation."', ";
			$tPerson_SQLinsert .=  "'".$FirstName."', ";
			$tPerson_SQLinsert .=  "'".$LastName."', ";
			$tPerson_SQLinsert .=  "'".$Tel."', ";	
			$tPerson_SQLinsert .=  "'".$eMail."', ";	
			$tPerson_SQLinsert .=  "'".$companyID."' ";
			$tPerson_SQLinsert .=  ") ";
	

			if (!mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = dataError("FAILED to add new person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {


		if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

		if (!empty($eMail)) {
			if (!check_email($eMail)) { 
				$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
			} else {
				if (!check_email_mx($eMail)) { 
					$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
				}
			}
		}				

		if (empty($errorMsg)) {
		
			$tPerson_SQLupdate = "UPDATE tPerson SET ";			
			$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
			
			$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
			$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
			$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
			$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
			$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
			$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
		
			if (!mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = dataError("FAILED to update person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. *new - tp_companyPeopleEdit.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	1204   date: 2010-07-03
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*							1204 - add email opened by clicking eMail address 
*							1301 - record suspension
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }

	$personSuspended = $_POST["personSuspended"];											//	&lt;&lt;&lt;&lt;&lt; 1301
	if(!isset($personSuspended)) {$personSuspended = $_GET["personSuspended"]; }	//	&lt;&lt;&lt;&lt;&lt; 1301


		//													vvvvvvvvvvvvvv    1301 - record suspension
		{	//		Suspend Person Record
			if(isset($personSuspended) AND $personSuspended == '1'){
				
				$suspendMsg = suspendRecord("tPerson" ,$personID);
				if (!empty($suspendMsg)) {
					echo $suspendMsg;
				}
				
				unset($personSuspended);
			}		
		//		END:  personSuspended
		}


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  UPDATE Person		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				$tPerson_SQLselect .= "AND delUserID IS NULL";						//   &lt;&lt;&lt;&lt;&lt;&lt;&lt;


				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';												//	&lt;&lt;&lt;&lt;&lt; 1301
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
					
				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';

				//	revision 1291:    convert eMail link to button
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;
						&lt;img src="images/btnEmail.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1291: 



				//	revision 1301:                 $suspendLink				//	&lt;&lt;&lt;&lt;&lt; 1301
					$suspendLink = '&lt;a href="index.php
					?content=personSuspend
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnDelete.png" border="0" alt="delete button" /&gt;
					&lt;/a&gt;';
				//	END:  	revision 1301:                 $suspendLink			^^^^^^^^



				
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$eMailFormLink.'&amp;nbsp;&lt;/td&gt;';	//	revision 1202

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
							echo '&lt;td&gt;'.$suspendLink.'&amp;nbsp;&lt;/td&gt;';						//	&lt;&lt;&lt;&lt;&lt; 1301
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. ASK: tp_personSuspend.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personSuspend.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			EDIT FORM for selected tPerson
*
*	===========================================================================
*/		

		{	//		Get the details of the person selected 
			$personID = $_GET["personID"];	
					
			$tPerson_SQLselect = "SELECT * ";
			$tPerson_SQLselect .= "FROM ";
			$tPerson_SQLselect .= "tPerson ";
			$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
			
			$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
			
			while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
				$Salutation = $row['Salutation'];
				$FirstName = $row['FirstName'];
				$LastName = $row['LastName'];

				$companyID = $row['CompanyID'];
				
				$personFullName = trim($Salutation." ".$FirstName." ".$LastName);	 
			}
			
		//  END: Get the details of the person selected 
		}

		{	//		Create form fields 
			$fld_personID = '&lt;input type="hidden" name="personID" value="'.$personID.'"/&gt;';
			$fld_companyID = '&lt;input type="hidden" name="companyID" value="'.$companyID.'"/&gt;';
			$fld_personSuspended = '&lt;input type="hidden" name="personSuspended" value="1"/&gt;';
	
			$backLink = '&lt;a href="index.php
			?content=companyPeopleEdit
			&amp;companyID='.$companyID.'"&gt;
			&lt;img src="images/noDoNotDelete.png" border="0" alt="dont delete button" /&gt;
			&lt;/a&gt;';

			$submitButton = '&lt;Input Type="image" 
			src="images/deleteRecord.png" 
			border="0" alt="delete button"&gt;';
			

		//  END: Create form fields 
		}

		{	//	render the FORM 

			echo '&lt;form name="postPerson" action="index.php?content=companyPeopleEdit" method="post"&gt;';
			echo $fld_personSuspended;
		
				echo $fld_personID.$fld_companyID;

				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;Are you sure you want to DELTE:&lt;/td&gt;
						&lt;td&gt;&lt;/td&gt;
					&lt;/tr&gt;		&#xD;					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;'.$personFullName.'&lt;/td&gt;
					&lt;/tr&gt;		&#xD;					&lt;tr&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
						&lt;td align="right"&gt;'.$submitButton.'&lt;br /&gt;&lt;br /&gt;&lt;/td&gt;
					&lt;/tr&gt;					
					&lt;tr&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
						&lt;td align="right"&gt;'.$backLink.'&lt;/td&gt;
					&lt;/tr&gt;					
				&lt;/table&gt;
				';
					
			echo '&lt;/form&gt;';
		//		END: render the FORM 
		}

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$companyID.'"&gt;Back to Company/People List&lt;/a&gt;';
echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="switch restore &gt; index">
          <before>     
				    //	revision  1302:   restore record
				    case "personRestore":
				        $contentFile = "includes/tp_companyPeopleEdit.php";
				        break;
     
</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. *new fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1302   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*							personSuspend - make records as suspended
*
*		revisions  
*						1010 validates eMail addresses
*						1301 suspendRecord($tableName ,$recordID)
*						1302 restoreRecord($tableName ,$recordID)
*
*	===========================================================================
*/		
	function restoreRecord($tableName ,$recordID) {

			$delUserID = $_COOKIE["userID"];
			$delTime = date("Y-m-d H:i:s",strtotime("now"));

			$suspend_SQL = "UPDATE ".$tableName." SET ";			
			$suspend_SQL .=  "delUserID = NULL , "; 		
			$suspend_SQL .=  "delTime = 0 ";

			$suspend_SQL .=  "WHERE ID = '".$recordID."' "; 	
		
			if (mysql_query($suspend_SQL))  {
				$errorMsg = "Record Restored.";							
			} else {
				$errorMsg =  dataError("FAILED to restore record.");
			}
			
			return $errorMsg;
					
	}

	function suspendRecord($tableName ,$recordID) {

			$delUserID = $_COOKIE["userID"];
			$delTime = date("Y-m-d H:i:s",strtotime("now"));

			$suspend_SQL = "UPDATE ".$tableName." SET ";			
			$suspend_SQL .=  "delUserID = '".$delUserID."', "; 		
			$suspend_SQL .=  "delTime = '".$delTime."' ";

			$suspend_SQL .=  "WHERE ID = '".$recordID."' "; 	
		
			if (mysql_query($suspend_SQL))  {
				$errorMsg = "Record Deleted.";							
			} else {
				$errorMsg =  dataError("FAILED to delete record.");
			}
			
			return $errorMsg;
					
	}
	
	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		//		revision:    1010

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

			if (!empty($eMail)) {
				if (!check_email($eMail)) { 
					$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
				} else {
					if (!check_email_mx($eMail)) { 
						$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
					}
				}
			}				
		}

		if (empty($errorMsg)) {
			$tPerson_SQLinsert = "INSERT INTO tPerson (";			
			$tPerson_SQLinsert .=  "Salutation, ";
			$tPerson_SQLinsert .=  "FirstName, ";
			$tPerson_SQLinsert .=  "LastName, ";
			$tPerson_SQLinsert .=  "Tel, ";	
			$tPerson_SQLinsert .=  "eMail, ";	
			$tPerson_SQLinsert .=  "companyID ";
			$tPerson_SQLinsert .=  ") ";
			
			$tPerson_SQLinsert .=  "VALUES (";
			$tPerson_SQLinsert .=  "'".$Salutation."', ";
			$tPerson_SQLinsert .=  "'".$FirstName."', ";
			$tPerson_SQLinsert .=  "'".$LastName."', ";
			$tPerson_SQLinsert .=  "'".$Tel."', ";	
			$tPerson_SQLinsert .=  "'".$eMail."', ";	
			$tPerson_SQLinsert .=  "'".$companyID."' ";
			$tPerson_SQLinsert .=  ") ";
	

			if (!mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = dataError("FAILED to add new person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {


		if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

		if (!empty($eMail)) {
			if (!check_email($eMail)) { 
				$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
			} else {
				if (!check_email_mx($eMail)) { 
					$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
				}
			}
		}				

		if (empty($errorMsg)) {
		
			$tPerson_SQLupdate = "UPDATE tPerson SET ";			
			$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
			
			$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
			$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
			$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
			$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
			$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
			$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
		
			if (!mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = dataError("FAILED to update person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. *new - tp_companyPeopleEdit.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	1302   date: 2010-07-05
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*							1204 - add email opened by clicking eMail address 
*							1301 - record suspension
*							1302 - record restore
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }

	$personSuspended = $_POST["personSuspended"];											
	if(!isset($personSuspended)) {$personSuspended = $_GET["personSuspended"]; }	

	$personRestored = $_GET["content"] == "personRestore"; 	//	&lt;&lt;&lt;&lt;&lt; 1302

	
		//													vvvvvvvvvvvvvv    1302 - record restored
		
		{	//		 Person restored
			if(isset($personRestored) AND $personRestored == 'personRestore'){
				
				$suspendMsg = restoreRecord("tPerson" ,$personID);
				if (!empty($suspendMsg)) {
					echo $suspendMsg;
				}
				
				unset($personSuspended);
			}		
		//		END:  personRestored
		}
																	//	^^^^^^^^^^^^^^^^^^^  1302
		
		{	//		Suspend Person Record
			if(isset($personSuspended) AND $personSuspended == '1'){
				
				$suspendMsg = suspendRecord("tPerson" ,$personID);
				if (!empty($suspendMsg)) {
					echo $suspendMsg;
				}
				
				unset($personSuspended);
			}		
		//		END:  personSuspended
		}


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  UPDATE Person		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				if (isset($accessLevel) AND $accessLevel &lt; 99) {						//   &lt;&lt;&lt;&lt;&lt;&lt;&lt;
					$tPerson_SQLselect .= "AND delUserID IS NULL";
				}																						//   &lt;&lt;&lt;&lt;&lt;&lt;&lt;

				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
					$personArray[$indx]['delUserID'] = $row['delUserID'];					//   &lt;&lt;&lt;&lt;&lt;&lt;&lt;
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';												
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
					
				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';

				//	revision 1291:    convert eMail link to button
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;
						&lt;img src="images/btnEmail.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1291: 

																				//	vvvvvvvvvvv   1302
				if (empty($personArray[$indx]['delUserID'])) {
				//	revision 1301:                 $suspendLink			
					$suspendLink = '&lt;a href="index.php
					?content=personSuspend
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnDelete.png" border="0" alt="delete button" /&gt;
					&lt;/a&gt;';
				//	END:  	revision 1301:                 $suspendLink			
				} else {
				//	revision 1302:                 $restoreLink				//	vvvvvvvvvvv   1302
					$suspendLink = '&lt;a href="index.php
					?content=personRestore
					&amp;companyID='.$companyID.'
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnRestore.png" border="0" alt="delete button" /&gt;
					&lt;/a&gt;';
				//	END:  	revision 1301:                 $restoreLink			^^^^^^^^
				}


				
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$eMailFormLink.'&amp;nbsp;&lt;/td&gt;';	//	revision 1202

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
							echo '&lt;td&gt;'.$suspendLink.'&amp;nbsp;&lt;/td&gt;';						//	&lt;&lt;&lt;&lt;&lt; 1301
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="tools">
      <leaf type="insert" title="fn_createButton.php">
        <before>&lt;?php

/*		THIS IS INCLUDE FILE:   fn_createButton.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1301   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							createButton - for use in alphaCRM
*
*
*	===========================================================================
*/		

	function createButton($xOffset, $background, $textColour, $string, $fileName) {
	
		//		CONSTANTS
			$imageSizeY = 16;
		
			//		set a path to the font
			$font_file = 'FreeSans.ttf';
			$font_path = '../fonts/'.$font_file;
			
			//		path and name of image file to be saved	
			$image_file = $fileName.'.png';
			$image_path = '../images/'.$image_file;
		
			$fontsize = 12;
			$textAngle = 0;
			//$xOffset = 5;
			$yOffset = 13;
		
		
		// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
		
		
		//		dummy image
		
		
			$dummy_image = imagecreate(300, $imageSizeY);		
			$dummyColour = imagecolorallocate ($dummy_image, 0, 0, 0);
			$dummy_imagettfArray =   imagettftext (	$dummy_image, $fontsize, 
									0, 
									$xOffset, $yOffset, 
									$dummyColour, 
									$font_path, 
									$string);
	
			$ttfImageWidth = $dummy_imagettfArray[2]; 
			
			//echo $ttfImageWidth."&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
		//		^^^^^^^^^^^^^^^^^^^^^^^^^^^
		
		
		$image = imagecreate($ttfImageWidth+$xOffset, $imageSizeY);
	
		$bgHexColour = trim($background);
		$bgHexColour = trim($bgHexColour, "#");
		
		$bgR = hexdec(substr($bgHexColour,0,2));
		$bgG = hexdec(substr($bgHexColour,2,2));
		$bgB = hexdec(substr($bgHexColour,4,2));

	//		first instance of imagecolorallocate sets background of image.
		$background = imagecolorallocate ($image, $bgR, $bgG, $bgB);		
	
	//		now set a colour for the text
		$txHexColour = trim($textColour);
		$txHexColour = trim($txHexColour, "#");
		
		$txR = hexdec(substr($txHexColour,0,2));
		$txG = hexdec(substr($txHexColour,2,2));
		$txB = hexdec(substr($txHexColour,4,2));
		
		$textColour = imagecolorallocate ($image, $txR, $txG, $txB);
		
	//		create the image 
	
		$imagettfArray =   imagettftext (	$image, $fontsize, 
								$textAngle, 
								$xOffset, $yOffset, 
								$textColour, 
								$font_path, 
								$string);



	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image produced at "'.$image_path.'" is: ';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);			
		return $errorMsg;
	}	

 
?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="tool_createButton.php">
        <before>&lt;?php

/*		THIS IS TOOL:   tool_createButton.php
*
*		folder:			tools/
*
*		used in:       
*
*		version:    	1   		date: 2010-08-05
*
*		purpose:			FUNCTIONS:
*							createButton - for use in alphaCRM
*
*/		

echo "&lt;script src=\"colourSelectorV3.js\" type=\"text/javascript\"&gt;&lt;/script&gt;";
echo "&lt;div id=\"colourSelectorV3\" class=\"colourSelectorV3\"&gt;&lt;/div&gt;";

$pageStyle = pageStyle();	

$background = "";

		include_once('../includes/fn_createButton.php');

	
		$xOffset = $_POST['xOffset'];
		$background = $_POST['background'];
		$textColour = $_POST['textColour'];
		$string = $_POST['string'];
		$fileName = $_POST['fileName'];
		
		if (!empty($xOffset) 
				AND strlen($background)==7 
				AND strlen($textColour)==7
				AND !empty($string) 
				AND !empty($fileName) 	) {
			$p = createButton($xOffset,  $background, $textColour, $string, $fileName);
		} else {
			$xOffset = 5;
		}
			

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";


		echo '&lt;form name="colours" action="tool_createButton.php" method="post"&gt;';	


			echo '&lt;table&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;Left/Right Margin:&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="xOffset" value="'.$xOffset.'" SIZE=3 MAXLENGTH=3&gt;&lt;/P&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;background colour:&lt;/td&gt;';
					echo '&lt;td&gt;'.tForm_Colour("background",$background, "marooon" ).'&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;text colour:&lt;/td&gt;';
					echo '&lt;td&gt;'.tForm_Colour("textColour",$textColour, "marooon" ).'&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;button lable:&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="string" value="'.$string.'"  SIZE=10 MAXLENGTH=20&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;fileName (ne extension):&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="fileName" value="'.$fileName.'"  SIZE=20 MAXLENGTH=50&gt;
							   (a   .png  file is created.)&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;&lt;/td&gt;';
					echo '&lt;td align="right"&gt;&lt;input type="submit"  value="create the button" /&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
			
			echo '&lt;/table&gt;';					
		echo '&lt;/form&gt;';

	function tForm_Colour($fieldID, $initValue, $btnTextColour ) { 

	  $result = "&lt;input type=\"button\" style=\"color: ".$btnTextColour.";\" ";
	  $result .= "onclick=\"selectColour('".$fieldID."','none');\" "; 
	  $result .= "value=\"pick colour\"&gt;";
	  $result .= "&amp;nbsp;";
	  $result .= "&lt;input type=\"text\" id=\"".$fieldID."\" name=\"".$fieldID."\" ";
	  $result .= "value=\"".$initValue."\" "; 
	  $result .= "size=\"7\" ";
	  $result .= "maxlength=\"7\"&gt;";
	  return($result);	
	}
	
	function pageStyle() {
				echo'	
				&lt;style type="text/css"&gt;
				body {
					font-family: Arial, Helvetica, sans-serif;
				}
				td {
					color: maroon;	
				}
				.scriptcolour {
					color: maroon;	
				}
				
				&lt;/style&gt;
				';
	}        

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="colourSelectorV3.js">
        <before>//*******************************************************************************&#xD;
//Title:      Colour Selector				File:  colourSelectorV3.js&#xD;
//Version:    V3&#xD;
//Date:       05/08/2010&#xD;
//License:		Free - no restriction&#xD;
//  Use as:    
//			at top of php script:
//				echo "&lt;script src=\"colourSelectorV3.js\" type=\"text/javascript\"&gt;&lt;/script&gt;";
//				echo "&lt;div id=\"colourSelectorV3\" class=\"colourSelectorV3\"&gt;&lt;/div&gt;";
//			in a form:
//				selectColour("input_field_id","span_id")
//
//
//
//	 provided by:    TMIT World  (modified from original)
//	 author:			  untraceable (thought to be FCP Combo-Chromatic Color Picker )
//&#xD;
//=============================================================================================
&#xD;
function getScrollY(){var scrOfX = 0,scrOfY=0;if(typeof(window.pageYOffset)=='number'){scrOfY=window.pageYOffset;scrOfX=window.pageXOffset;}
	else if(document.body&amp;&amp;(document.body.scrollLeft||document.body.scrollTop)){scrOfY=document.body.scrollTop;scrOfX=document.body.scrollLeft;}
	else if(document.documentElement&amp;&amp;(document.documentElement.scrollLeft||document.documentElement.scrollTop)){scrOfY=document.documentElement.scrollTop;scrOfX=document.documentElement.scrollLeft;}
	return scrOfY;}
	document.write("&lt;style type='text/css'&gt;.colourSelectorV3{visibility:hidden;display:none;position:absolute;background:#FFF;border:solid 1px #CCC;padding:4px;z-index:999;filter:progid:DXImageTransform.Microsoft.Shadow(color=#D0D0D0,direction=135);}.o5582brd{padding:0;width:12px;height:14px;border-bottom:solid 1px #DFDFDF;border-right:solid 1px #DFDFDF;}a.o5582n66,.o5582n66,.o5582n66a{font-family:arial,tahoma,sans-serif;text-decoration:underline;font-size:9px;color:#666;border:none;}.o5582n66,.o5582n66a{text-align:center;text-decoration:none;}a:hover.o5582n66{text-decoration:none;color:#FFA500;cursor:pointer;}.a01p3{padding:1px 4px 1px 2px;background:whitesmoke;border:solid 1px #DFDFDF;}&lt;/style&gt;");

function getTop2(){csBrHt=0;if(typeof(window.innerWidth)=='number'){csBrHt=window.innerHeight;}
	else if(document.documentElement&amp;&amp;(document.documentElement.clientWidth||document.documentElement.clientHeight)){csBrHt=document.documentElement.clientHeight;}else if(document.body&amp;&amp;(document.body.clientWidth||document.body.clientHeight)){csBrHt=document.body.clientHeight;}ctop=((csBrHt/2)-115)+getScrollY();return ctop;}var nocol1="No Colour",clos1="Close",tt2="TMITworld.com",hm2="http://www.";hm2+=tt2;tt2="provided by TMIT";

function getLeft2(){var csBrWt=0;if(typeof(window.innerWidth)=='number'){csBrWt=window.innerWidth;}
	else if(document.documentElement&amp;&amp;(document.documentElement.clientWidth||document.documentElement.clientHeight)){csBrWt=document.documentElement.clientWidth;}else if(document.body&amp;&amp;(document.body.clientWidth||document.body.clientHeight)){csBrWt=document.body.clientWidth;}cleft=(csBrWt/2)-125;return cleft;}

function setCCbldID2(objID,val){document.getElementById(objID).value=val;}

function setCCbldSty2(objID,prop,val){switch(prop)
	{case "bc":if(objID!='none'){document.getElementById(objID).style.backgroundColor=val;};
		break;
		case "vs":document.getElementById(objID).style.visibility=val;
		break;case "ds":document.getElementById(objID).style.display=val;
		break;case "tp":document.getElementById(objID).style.top=val;
		break;case "lf":document.getElementById(objID).style.left=val;
	break;}}

function putOBJxColor2(OBjElem,Samp,pigMent){if(pigMent!='x'){setCCbldID2(OBjElem,pigMent);setCCbldSty2(Samp,'bc',pigMent);}setCCbldSty2('colourSelectorV3','vs','hidden');setCCbldSty2('colourSelectorV3','ds','none');}

function selectColour(OBjElem,Sam)
	{var objX=new Array('00','33','66','99','CC','FF');
	var c=0;var z='"'+OBjElem+'","'+Sam+'",""';var xl='"'+OBjElem+'","'+Sam+'","x"';
	var mid='';mid+='&lt;table bgcolor="#FFFFFF" border="0" cellpadding="0" cellspacing="0" style="border:solid 0px #F0F0F0;padding:2px;"&gt;&lt;tr&gt;';
	mid+="&lt;td colspan='18' align='left' style='font-size:10px;background:#6666CC;color:#FFF;font-family:arial;'&gt;&amp;nbsp;Colour Selector V3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan='18' align='center' style='margin:0;padding:2px;height:12px;' &gt;&lt;input class='o5582n66' type='text' size='12' id='o5582n66' value='#FFFFFF'&gt;&lt;input class='o5582n66a' type='text' size='2' style='width:14px;' id='o5582n66a' onclick='javascript:alert(\"click on selected swatch below...\");' value='' style='border:solid 1px #666;'&gt;&amp;nbsp;|&amp;nbsp;&lt;a class='o5582n66' href='javascript:onclick=putOBJxColor2("+z+")'&gt;&lt;span class='a01p3'&gt;"+nocol1+"&lt;/span&gt;&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a class='o5582n66' href='javascript:onclick=putOBJxColor2("+xl+")'&gt;&lt;span class='a01p3'&gt;"+clos1+"&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;";var br=1;for(o=0;o&lt;6;o++){mid+='&lt;/tr&gt;&lt;tr&gt;';for(y=0;y&lt;6;y++){if(y==3){mid+='&lt;/tr&gt;&lt;tr&gt;';}for(x=0;x&lt;6;x++){var grid='';grid=objX[o]+objX[y]+objX[x];var b="'"+OBjElem+"', '"+Sam+"','#"+grid+"'";mid+='&lt;td class="o5582brd" style="background-color:#'+grid+'"&gt;&lt;a class="o5582n66"  href="javascript:onclick=putOBJxColor2('+b+');" onmouseover=javascript:document.getElementById("o5582n66").value="#'+grid+'";javascript:document.getElementById("o5582n66a").style.backgroundColor="#'+grid+'";  title="#'+grid+'"&gt;&lt;div style="width:12px;height:14px;"&gt;&lt;/div&gt;&lt;/a&gt;&lt;/td&gt;';c++;}}}mid+="&lt;/tr&gt;&lt;tr&gt;&lt;td colspan='18' align='right' style='padding:2px;border:solid 1px #FFF;background:#FFF;'&gt;&lt;a href='"+hm2+"' style='color:#666;font-size:8px;font-family:arial;text-decoration:none;letter-spacing:1px;'&gt;"+tt2+"&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;";var ttop=getTop2();setCCbldSty2('colourSelectorV3','tp',ttop);document.getElementById('colourSelectorV3').style.left=getLeft2();setCCbldSty2('colourSelectorV3','vs','visible');setCCbldSty2('colourSelectorV3','ds','block');
	document.getElementById('colourSelectorV3').innerHTML=mid;}&#xD;
</before>
        <after/>
      </leaf>
      <branch title="&gt; template">
        <leaf type="insert" title="buttonTools &gt; index">
          <before> 				    //	revision  1300:   admin tools
				    //							
				    case "toolButtons":
				        $contentFile = "tools/tool_createButton.php";
				        break;
 
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="menu &gt; crmMenu">
          <before>//	Restricted - Admin Only menu items
	if (isset($accessLevel) AND $accessLevel &gt;= 99) {
		echo '&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Tools:&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';	
		
		echo '&lt;a href="index.php?content=toolButtons"&gt;
				&lt;span class="mainMenuItem"&gt;Button Tool&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';
	}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_createButton.php">
          <before>&lt;?php

/*		THIS IS INCLUDE FILE:   fn_createButton.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1301   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							createButton - for use in alphaCRM
*
*
*	===========================================================================
*/		

	function createButton($xOffset, $background, $textColour, $string, $fileName) {
	
		//		CONSTANTS
			$imageSizeY = 16;
		
			//		set a path to the font
			$font_file = 'FreeSans.ttf';
			$font_path = 'fonts/'.$font_file;
			
			//		path and name of image file to be saved	
			$image_file = $fileName.'.png';
			$image_path = 'images/'.$image_file;
		
			$fontsize = 12;
			$textAngle = 0;
			//$xOffset = 5;
			$yOffset = 13;
		
		
		// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
		
		
		//		dummy image
		
		
			$dummy_image = imagecreate(300, $imageSizeY);		
			$dummyColour = imagecolorallocate ($dummy_image, 0, 0, 0);
			$dummy_imagettfArray =   imagettftext (	$dummy_image, $fontsize, 
									0, 
									$xOffset, $yOffset, 
									$dummyColour, 
									$font_path, 
									$string);
	
			$ttfImageWidth = $dummy_imagettfArray[2]; 
			
			//echo $ttfImageWidth."&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
		//		^^^^^^^^^^^^^^^^^^^^^^^^^^^
		
		
		$image = imagecreate($ttfImageWidth+$xOffset, $imageSizeY);
	
		$bgHexColour = trim($background);
		$bgHexColour = trim($bgHexColour, "#");
		
		$bgR = hexdec(substr($bgHexColour,0,2));
		$bgG = hexdec(substr($bgHexColour,2,2));
		$bgB = hexdec(substr($bgHexColour,4,2));

	//		first instance of imagecolorallocate sets background of image.
		$background = imagecolorallocate ($image, $bgR, $bgG, $bgB);		
	
	//		now set a colour for the text
		$txHexColour = trim($textColour);
		$txHexColour = trim($txHexColour, "#");
		
		$txR = hexdec(substr($txHexColour,0,2));
		$txG = hexdec(substr($txHexColour,2,2));
		$txB = hexdec(substr($txHexColour,4,2));
		
		$textColour = imagecolorallocate ($image, $txR, $txG, $txB);
		
	//		create the image 
	
		$imagettfArray =   imagettftext (	$image, $fontsize, 
								$textAngle, 
								$xOffset, $yOffset, 
								$textColour, 
								$font_path, 
								$string);


	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image produced at "'.$image_path.'" is: ';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);			
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tool_createButton.php">
          <before>&lt;?php

/*		THIS IS TOOL:   tool_createButton.php
*
*		folder:			tools/
*
*		used in:       index.php
*
*		version:    	2   		date: 2010-08-05
*
*		purpose:			FUNCTIONS:
*							createButton - for use in alphaCRM
*
*/		

echo "&lt;script src=\"tools/colourSelectorV3.js\" type=\"text/javascript\"&gt;&lt;/script&gt;";
echo "&lt;div id=\"colourSelectorV3\" class=\"colourSelectorV3\"&gt;&lt;/div&gt;";

$pageStyle = pageStyle();	

		include_once('includes/fn_createButton.php');

	
		$xOffset = $_POST['xOffset'];
		$background = $_POST['background'];
		$textColour = $_POST['textColour'];
		$string = $_POST['string'];
		$fileName = $_POST['fileName'];
		
		if (!empty($xOffset) 
				AND strlen($background)==7 
				AND strlen($textColour)==7
				AND !empty($string) 
				AND !empty($fileName) 	) {
			$p = createButton($xOffset,  $background, $textColour, $string, $fileName);
			echo $p;

		} else {
			$xOffset = 5;
		}


echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";


		echo '&lt;form name="colours" action="index.php?content=toolButtons" method="post"&gt;';	


			echo '&lt;table&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;Left/Right Margin:&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="xOffset" value="'.$xOffset.'" SIZE=3 MAXLENGTH=3&gt;&lt;/P&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;background colour:&lt;/td&gt;';
					echo '&lt;td&gt;'.tForm_Colour("background",$background, "marooon" ).'&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;text colour:&lt;/td&gt;';
					echo '&lt;td&gt;'.tForm_Colour("textColour",$textColour, "marooon" ).'&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;button lable:&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="string" value="'.$string.'"  SIZE=10 MAXLENGTH=20&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;fileName (ne extension):&lt;/td&gt;';
					echo '&lt;td&gt;&lt;INPUT TYPE="text" NAME="fileName" value="'.$fileName.'"  SIZE=20 MAXLENGTH=50&gt;
							   (a   .png  file is created.)&lt;/td&gt;';
				echo '&lt;/tr&gt;';
				echo '&lt;tr&gt;';
					echo '&lt;td&gt;&lt;/td&gt;';
					echo '&lt;td align="right"&gt;&lt;input type="submit"  value="create the button" /&gt;&lt;/td&gt;';
				echo '&lt;/tr&gt;';
			
			echo '&lt;/table&gt;';					
		echo '&lt;/form&gt;';

	function tForm_Colour($fieldID, $initValue, $btnTextColour ) { 

	  $result = "&lt;input type=\"button\" style=\"color: ".$btnTextColour.";\" ";
	  $result .= "onclick=\"selectColour('".$fieldID."','none');\" "; 
	  $result .= "value=\"pick colour\"&gt;";
	  $result .= "&amp;nbsp;";
	  $result .= "&lt;input type=\"text\" id=\"".$fieldID."\" name=\"".$fieldID."\" ";
	  $result .= "value=\"".$initValue."\" "; 
	  $result .= "size=\"7\" ";
	  $result .= "maxlength=\"7\"&gt;";
	  return($result);	
	}
	
	function pageStyle() {
				echo'	
				&lt;style type="text/css"&gt;
				body {
					font-family: Arial, Helvetica, sans-serif;
				}
				td {
					color: maroon;	
				}
				.scriptcolour {
					color: maroon;	
				}
				
				&lt;/style&gt;
				';
	}        

?&gt;</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="examplets">
      <branch title="Functions">
        <leaf type="insert" title="fnTest_args">
          <before>&lt;?php

echo "fnTest_args_01&lt;br /&gt;&lt;br /&gt;";

function twoArgs($x, $y) {
	echo "twoArgs&lt;br /&gt;";
	echo '&lt;p&gt;x : '.$x.'&lt;/p&gt;';
	echo '&lt;p&gt;y : '.$y.'&lt;/p&gt;';	
	echo '&lt;p&gt;z : '.$z.'&lt;/p&gt;';
	echo "------------------&lt;br /&gt;";
}

function optionalArgs($x, $y = 12, $z = 24) {
	echo "optionalArgs&lt;br /&gt;";
	echo '&lt;p&gt;x : '.$x.'&lt;/p&gt;';
	echo '&lt;p&gt;y : '.$y.'&lt;/p&gt;';	
	echo '&lt;p&gt;z : '.$z.'&lt;/p&gt;';
	echo "------------------&lt;br /&gt;";
}


	$p = optionalArgs(2);
	$q = optionalArgs(2, 3);
	$r = optionalArgs(2, 3, 4);
	$r = optionalArgs(2, 3, 4, 5);

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
	
	$p = twoArgs(2);
	$q = twoArgs(2, 3);
	$r = twoArgs(2, 3, 4);
	$r = twoArgs(2, 3, 4, 5);

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fnTest_optArgs">
          <before>&lt;?php

echo "fnTest_optionalArgs_01&lt;br /&gt;&lt;br /&gt;";

function noArgs() {
	echo "function noArgs() &amp;nbsp;&amp;nbsp;&amp;nbsp;";
  if (func_num_args() == 0) {
    return false;
    }
  else {
    for ($i =0; $i &lt; func_num_args(); $i++) {
      $x = func_get_arg($i);
 			echo $x;
      }
    }
  echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

  }


	$p = noArgs(2);
	$q = noArgs(2, 3);
	$r = noArgs(2, "x", 4);
	$r = noArgs(2, "p", 4, "q");

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fnTest_arrayArgs">
          <before>&lt;?php

echo "fnTest_arrayArgs&lt;br /&gt;&lt;br /&gt;";

function noArgs() {
	echo "function arrayArgs() &amp;nbsp;&amp;nbsp;&amp;nbsp;";
	
  $arr = func_get_args();
  $n = sizeof($arr);
  

    for ($i =0; $i &lt; $n; $i++) {
      $x = $arr[$i];
 			echo $x;
      }

  echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

  }


	$p = noArgs(2);
	$q = noArgs(2, 3);
	$r = noArgs(2, "x", 4);
	$r = noArgs(2, "p", 4, "q");

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fnTest_maths">
          <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;

&lt;?php

echo '&lt;p&gt;Examples of php built-in maths functions&lt;/p&gt;';

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString("Absolute value", "abs(-7.5)");
$p = fnTestString("Round fractions up", "ceil(2.49999999)");
$p = fnTestString("Round fractions down", "floor(2.4999999999999999999999)");
$p = fnTestString("Find highest value", "max(2.5, 14, 17, 1, 19)");
$p = fnTestString("Find lowest value", "min(2.5, 14, 17, 1, 19)");
$p = fnTestString("Generate random value", "mt_rand()");
$p = fnTestString("Rounds a float", "round(2.59)");
$p = fnTestString("Square root", "sqrt(81.8)");



function fnTestString($meaning, $fn) {
	
	echo eval('$p = '.$fn.';');
	echo '&lt;p&gt;'.$meaning.':  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span class="scriptcolour"&gt;
		echo '.$fn.'; &lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span style="color: blue"&gt;';
	echo $p;
	echo '&lt;/p&gt;&lt;/span&gt;';
}

?&gt;   </before>
          <after/>
        </leaf>
        <leaf type="insert" title="fnTest_string">
          <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;

&lt;?php
//fnTest_strings.php

echo '&lt;p&gt;Examples of php built-in string functions&lt;/p&gt;';

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('chr(67)', 'Return a specific character');

$p = fnTestString('"*".ltrim(" \t trimmed")', 'Strip whitespace from the beginning of a string');
$p = fnTestString('md5("fred")', 'Calculate the md5 hash of a string');

$p = fnTestString('number_format("7782975.8988",2, ".",",")', 'Format a number with grouped thousands');
$p = fnTestString('ord("f")', 'Return ASCII value of character');

$p = fnTestString('rtrim("trimmed \t ")."*"', 'Strip whitespace (or other characters) from the end of a string');
$p = fnTestString('str_ireplace("x","y","PxPXPxpppx")', 'Case-insensitive version of str_replace.');
$p = fnTestString('str_pad("xyz",10, "0")', 'Pad a string to a certain length with another string');
$p = fnTestString('str_repeat("-",12)', 'Repeat a string');
$p = fnTestString('str_replace("x","y","PxPXPxpppx")', 'Replace all occurrences of the search string with the replacement string');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
$p = fnTestString('strip_tags("*&lt;p&gt;test para&lt;/p&gt;&lt;br /&gt;*")', 'Strip HTML and PHP tags from a string');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
$p = fnTestString('strlen("This is how long?")', 'Get string length');
$p = fnTestString('strpos("abcdefg","d")', 'Find position of first occurrence of a string');
$p = fnTestString('strrev("abcd")', 'Reverse a string');
$p = fnTestString('strtolower("AbCdEfG")', 'Make a string lowercase');
$p = fnTestString('strtoupper("AbCdEfG")', 'Make a string uppercase');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
$p = fnTestString('substr("abcdefghij",2,3)', 'Return part of a string');
$p = fnTestString('substr("abcdefghij",-4)', 'Return part of a string');
$p = fnTestString('substr("abcdefghij", 3)', 'Return part of a string');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
$p = fnTestString('"*".trim(" \t xyz \t ")."*"', 'Strip whitespace (or other characters) from the beginning and end of a string');
$p = fnTestString('ucfirst("mr fred smith")', 'Make a strings first character uppercase');
$p = fnTestString('ucwords("mr fred smith")', 'Uppercase the first character of each word in a string');

function fnTestString($fn, $meaning) {
	
	echo eval('$p = '.$fn.';');
	echo '&lt;p&gt;'.$meaning.':  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span class="scriptcolour"&gt;
		echo '.$fn.'; &lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span style="color: blue"&gt;';
	echo $p;
	echo '&lt;/p&gt;&lt;/span&gt;';
}



?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fnTest_dateTime">
          <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;
&lt;?php

echo '&lt;p&gt;Examples of php built-in date functions&lt;/p&gt;';

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('strtotime("now")', 'format NOW to UNIX format');
$p = fnTestString('time()', 'format NOW to UNIX microtime format');
$p = fnTestString('microtime()', 'format NOW to UNIX microtime format');

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('date("Y-m-d H:i:s", strtotime("now"))', 'format NOW to MySQL format');
$p = fnTestString('date("Y-m-d H:i:s")', 'format NOW to MySQL format');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('date("D j M Y H:i:s", strtotime("+2 hours"))', 'format 2 hours hence to human format');
$p = fnTestString('date("D j M Y H:i:s", strtotime("+7 days"))', 'format 7 days hence to human format');

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('date("D j M Y H:i:s", strtotime("tomorrow"))', 'format tomorrow to human format');
$p = fnTestString('date("D j M Y H:i:s", strtotime("+1 day"))', 'format tomorrow to human format');
echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('date("D j M Y H:i:s", strtotime("yesterday"))', 'format yesterday to human format');
$p = fnTestString('date("D j M Y H:i:s", strtotime("-1 day"))', 'format yesterday to human format');

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

$p = fnTestString('date("g:i A, D j M Y", strtotime("yesterday"))', 'format yesterday to 12 hour format');
$p = fnTestString('date("g:i A, D j M Y", strtotime("-1 day"))', 'format yesterday to 12 hour format');



function fnTestString($fn, $meaning) {
	
	echo eval('$p = '.$fn.';');
	echo '&lt;p&gt;'.$meaning.':  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span class="scriptcolour"&gt;
		echo '.$fn.'; &lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
		&lt;span style="color: blue"&gt;';
	echo $p;
	echo '&lt;/p&gt;&lt;/span&gt;';
}

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="test_arrayFunctions">
          <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;

&lt;?php

		$arrayP[0] = explode(",", "3,Orange");
		$arrayP[1] = explode(",", "4,Apple");
		$arrayP[2] = explode(",", "1,Lemon");

		$arrayQ[0] = explode(",", "19,Grape");
		$arrayQ[1] = explode(",", "7,Banana");
		$arrayQ[2] = explode(",", "6,Melon");
		$arrayQ[3] = explode(",", "9,Peach");
		$arrayQ[4] = explode(",", "2,Pear");
		$arrayQ[5] = explode(",", "6,Melon");
		$arrayQ[7] = explode(",", "15,Peach");
		$arrayQ[8] = explode(",", "10,Apricot");
				
		$arrayW = explode(",", "Grape,Banana,Melon,Peach,Pear,Melon, Pineapple,Apricot");

		$arrayP_name = var_name($arrayP, get_defined_vars());
		$arrayQ_name = var_name($arrayQ, get_defined_vars());
		$arrayW_name = var_name($arrayW, get_defined_vars());
				
		echo "&lt;p&gt;&lt;strong&gt;&lt;u&gt;Array Functions:&lt;/u&gt;&lt;/strong&gt;&lt;/p&gt;";

		//	vvv Test
						
			echo '&lt;p&gt;&lt;strong&gt;In-Built array dump function:&lt;/strong&gt;&lt;/p&gt;';
			echo '&lt;p class="scriptcolour"&gt;$p = print_r($tableData);&lt;/p&gt;';
			$p = print_r($arrayP);
	
		echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
	
			echo '&lt;p&gt;&lt;strong&gt;Custom function to dump array:&lt;/strong&gt;&lt;/p&gt;';
			echo '&lt;p class="scriptcolour"&gt;$p = dumpArray($tableData, $arrName);&lt;/p&gt;';
			$p = dumpArray($arrayP, $arrNameP);

		//	^^^ Test
		
function dumpArray($arr, $arrName){	
		
		foreach ($arr as $key =&gt; $value)
		{
	      echo  $arrName."[",$key."] =&gt; ".$value."&lt;br /&gt;";
	      if (is_array($value)) {
				foreach ($value as $key2 =&gt; $value2)
				{
				      echo  str_repeat("&amp;nbsp;", 8).$arrName."[",$key."][".$key2."] =&gt; ".$value2."&lt;br /&gt;";
				}
			}
	      echo "&lt;br /&gt;";		      
		}
}

function var_name (&amp;$iVar, &amp;$aDefinedVars){
	
    foreach ($aDefinedVars as $k=&gt;$v){
        $aDefinedVars_0[$k] = $v;}
 
    $iVarSave = $iVar;
    $iVar     =!$iVar;
 
    $aDiffKeys = array_keys (array_diff_assoc ($aDefinedVars_0, $aDefinedVars));
    $iVar      = $iVarSave;
 
    return $aDiffKeys[0];
}
 
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt; sorting arrays">
          <before>				echo '&lt;p&gt;&lt;strong&gt;Dump array:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
				echo '&lt;span style="color: maroon;"&gt;$p = dumpArray($arrayP);&lt;/span&gt;&lt;/p&gt;';	
				$p = dumpArray($arrayP, $arrayP_name);
		
				echo "&lt;hr /&gt;";
		
				$sorted = sort($arrayP); 
				$arrayFn= 'sort($arrayP); ';
				
				echo '&lt;p&gt;&lt;strong&gt;sort array:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
				echo '&lt;span style="color: maroon;"&gt;'.$arrayFn.'&lt;/span&gt;&lt;/p&gt;';	
				if ($sorted) {				
					$p = dumpArray($arrayP, $arrayP_name);
				} else {
					echo "&lt;br /&gt;unable to sort&lt;br /&gt;";
				}
		
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt; unique">
          <before>				echo '&lt;p&gt;&lt;strong&gt;Dump array:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
				echo '&lt;span class="scriptcolour"&gt;$p = dumpArray($arrayW);&lt;/span&gt;&lt;/p&gt;';	
				$p = dumpArray($arrayW, $arrayW_name);
		
				echo "&lt;hr /&gt;";
		
				$uniquArray = array_unique($arrayW);
				$arrayFn= '$uniquArray = array_unique($arrayW);';
				$uniquArray_name = var_name($uniquArray, get_defined_vars());
				
				echo '&lt;p&gt;&lt;strong&gt;unique array:&lt;/strong&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
				echo '&lt;span class="scriptcolour"&gt;'.$arrayFn.'&lt;/span&gt;&lt;/p&gt;';	
		
				$p = dumpArray($uniquArray, $uniquArray_name);

</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt;  search">
          <before>						
		echo '&lt;p style="color: maroon;"&gt;$p = dumpArray($tableData, $arrName);&lt;/p&gt;';
		$p = dumpArray($arrayW, $arrayW_name);

		if (in_array("Banana",$arrayW)) {
				echo "&lt;br /&gt;Found Banana in ".$arrayW_name."&lt;br /&gt;";
		}

		if (in_array("Pineapple",$arrayW)) {
				echo "&lt;br /&gt;Found Pineapple&lt;br /&gt;";
		} else {
				echo "&lt;br /&gt;Pineapple NOT found in ".$arrayW_name."&lt;br /&gt;";
		}

		</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt; slice">
          <before>						
		echo '&lt;p style="color: maroon;"&gt;$p = dumpArray($tableData, $arrName);&lt;/p&gt;';
		$p = dumpArray($arrayQ, $arrayQ_name);

		$slice = array_slice($arrayQ, 4);
		$varnameSlice = var_name($slice, get_defined_vars());
		echo '&lt;p style="color: maroon;"&gt;$slice = array_slice($arrayQ, 4);&lt;/p&gt;';
		$p = dumpArray($slice, $varnameSlice);

		$slice = array_slice($arrayQ, 2, 3);
		$varnameSlice = var_name($slice, get_defined_vars());
		echo '&lt;p style="color: maroon;"&gt;$slice = array_slice($arrayQ, 2, 3);&lt;/p&gt;';
		$p = dumpArray($slice, $varnameSlice);

		$slice = array_slice($arrayQ, -2, 3);
		$varnameSlice = var_name($slice, get_defined_vars());
		echo '&lt;p style="color: maroon;"&gt;$slice = array_slice($arrayQ,-2, 3);&lt;/p&gt;';
		$p = dumpArray($slice, $varnameSlice);

		$slice = array_slice($arrayQ, 5, 2);
		$varnameSlice = var_name($slice, get_defined_vars());
		echo '&lt;p style="color: maroon;"&gt;$slice = array_slice($arrayQ, 5, 2);&lt;/p&gt;';
		$p = dumpArray($slice, $varnameSlice);

		$slice = array_slice($arrayQ, 5, 2, TRUE);
		$varnameSlice = var_name($slice, get_defined_vars());
		echo '&lt;p style="color: maroon;"&gt;$slice = array_slice($arrayQ, 5, 2, TRUE);&lt;/p&gt;';
		$p = dumpArray($slice, $varnameSlice);

</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt; merge">
          <before>						
		echo '&lt;p&gt;&lt;strong&gt;Combined Array&lt;/strong&gt;&lt;/p&gt;';

		echo '&lt;p class="scriptcolour"&gt;$combinedArray = array_combine($arrayP, $arrayQ);&lt;/p&gt;';
			

		$combinedArray = array_merge($arrayP, $arrayQ);
		$namecombinedArray = var_name($combinedArray, get_defined_vars());

		sort($combinedArray);
		

		$p = dumpArray($combinedArray, $namecombinedArray);
		
		</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... function super_unique()">
          <before>
function super_unique($array)
{
  $result = array_map("unserialize", array_unique(array_map("serialize", $array)));

  foreach ($result as $key =&gt; $value)
  {
    if ( is_array($value) )
    {
      $result[$key] = super_unique($value);
    }
  }

  return $result;
} 
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... &gt; merge,sort,unique">
          <before>			echo '&lt;p&gt;&lt;strong&gt;Combined Array&lt;/strong&gt;&lt;/p&gt;';
	
			echo '&lt;p class="scriptcolour"&gt;$mergedArray = array_combine($arrayP, $arrayQ);&lt;/p&gt;';
			echo '&lt;p class="scriptcolour"&gt;sort($mergedArray);&lt;/p&gt;';
			echo '&lt;p class="scriptcolour"&gt;$combinedArray = super_unique($mergedArray);&lt;/p&gt;';
				
	
			$mergedArray = array_merge($arrayP, $arrayQ);
			
	
			sort($mergedArray);
			
			$combinedArray = super_unique($mergedArray);
			
			$namecombinedArray = var_name($combinedArray, get_defined_vars());
	
			$p = dumpArray($combinedArray, $namecombinedArray);
			
		</before>
          <after/>
        </leaf>
      </branch>
      <branch title="$_SERVER">
        <leaf type="insert" title="examples">
          <before>
	&lt;style type="text/css"&gt;
		body {
			font-family: Arial, Helvetica, sans-serif;
		}
		.scriptColour {
			color: maroon;	
		}
		.outputColour {
			color: blue;	
		}
	&lt;/style&gt;
	
&lt;?php 
/*
//						TEST server vars
//
*/ 


	displayServerVar("DOCUMENT_ROOT");
	displayServerVar("SERVER_ADDR");
	displayServerVar("SERVER_NAME");
	displayServerVar("HTTP_HOST");
	displayServerVar("HTTP_REFERER");
	displayServerVar("REMOTE_ADDR");
	displayServerVar("REMOTE_HOST");
	displayServerVar("SERVER_PORT");
	displayServerVar("HTTPS");


echo '&lt;a href="http://www.training.tmit.net/tmit/resources/fnTest_serverVars.php"&gt;Test LIVE server&lt;/a&gt;';
	
	function displayServerVar($varString) {
		echo '&lt;span class="scriptColour"&gt;$_SERVER[\''.$varString.'\']&lt;/span&gt;'; 
		echo ' &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;returns: &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
		echo '&lt;span class="outputColour"&gt;'.$_SERVER[$varString].'&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;'; 
		
	}
	
	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="browser detection">
          <before>&lt;?php
	
		function thisBrowser() {
					// echo $_SERVER['HTTP_USER_AGENT'];
					
					$useragent = $_SERVER['HTTP_USER_AGENT'];
					
					if (preg_match('|MSIE ([0-9].[0-9]{1,2})|',$useragent,$matched)) {
					    $browser_version=$matched[1];
					    $browser = 'IE';
					} elseif (preg_match( '|Opera ([0-9].[0-9]{1,2})|',$useragent,$matched)) {
					    $browser_version=$matched[1];
					    $browser = 'Opera';
					} elseif (preg_match( '|Opera/([0-9].[0-9]{1,2})|',$useragent,$matched)) {
					    $browser_version=$matched[1];
					    $browser = 'Opera';
					} elseif(preg_match('|Firefox/([0-9\.]+)|',$useragent,$matched)) {
					        $browser_version=$matched[1];
					        $browser = 'Firefox'; 
					} elseif(preg_match('|Safari/([0-9\.]+)|',$useragent,$matched)) {
					        $browser_version=$matched[1];
					        $browser = 'Safari';
					} else {
					        // browser not recognized!
					    $browser_version = 0;
					    $browser= 'other';  
					}
					
					return $browser." ".$browser_version; 
			}
	
echo $_SERVER['HTTP_USER_AGENT']."&lt;br /&gt;&lt;br /&gt;";

echo thisBrowser();

?&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="File Handling">
        <branch title="text files">
          <leaf type="insert" title="mkdir">
            <before>&lt;?php
	
//   make new directory 

	$newDir = '../fonts'; 

	if(mkdir($newDir)) {
		echo 'New directory "'.$newDir.'" CREATED.&lt;br /&gt;&lt;br /&gt;';	
		if (chmod($newDir, 0666)) {
			echo 'Permissions on "'.$newDir.'" set to "'.convertPermissions($newDir).'".&lt;br /&gt;&lt;br /&gt;';
		} else {
			echo 'Attempt to set permissons on "'.$newDir.'" FAILED.&lt;br /&gt;&lt;br /&gt;';
			
		}		

	} else {
		echo 'Attempt to create new directory "'.$newDir.'" FAILED.&lt;br /&gt;&lt;br /&gt;';
	}		
	

	function convertPermissions($fileOrDirectory) {

				$perms = fileperms ($fileOrDirectory);
				
				if (($perms &amp; 0xC000) == 0xC000) {
				    // Socket
				    $info = 's';
				} elseif (($perms &amp; 0xA000) == 0xA000) {
				    // Symbolic Link
				    $info = 'l';
				} elseif (($perms &amp; 0x8000) == 0x8000) {
				    // Regular
				    $info = '-';
				} elseif (($perms &amp; 0x6000) == 0x6000) {
				    // Block special
				    $info = 'b';
				} elseif (($perms &amp; 0x4000) == 0x4000) {
				    // Directory
				    $info = 'd';
				} elseif (($perms &amp; 0x2000) == 0x2000) {
				    // Character special
				    $info = 'c';
				} elseif (($perms &amp; 0x1000) == 0x1000) {
				    // FIFO pipe
				    $info = 'p';
				} else {
				    // Unknown
				    $info = 'u';
				}
				
				// Owner
				$info .= (($perms &amp; 0x0100) ? 'r' : '-');
				$info .= (($perms &amp; 0x0080) ? 'w' : '-');
				$info .= (($perms &amp; 0x0040) ?
				            (($perms &amp; 0x0800) ? 's' : 'x' ) :
				            (($perms &amp; 0x0800) ? 'S' : '-'));
				
				// Group
				$info .= (($perms &amp; 0x0020) ? 'r' : '-');
				$info .= (($perms &amp; 0x0010) ? 'w' : '-');
				$info .= (($perms &amp; 0x0008) ?
				            (($perms &amp; 0x0400) ? 's' : 'x' ) :
				            (($perms &amp; 0x0400) ? 'S' : '-'));
				
				// World
				$info .= (($perms &amp; 0x0004) ? 'r' : '-');
				$info .= (($perms &amp; 0x0002) ? 'w' : '-');
				$info .= (($perms &amp; 0x0001) ?
				            (($perms &amp; 0x0200) ? 't' : 'x' ) :
				            (($perms &amp; 0x0200) ? 'T' : '-'));
		return $info;
	}            
?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="Plain Text File">
            <before>This is a plain text file called plainTextFile
It comprises several LINES of text
and can be read by php using the fopen() function

//  this is a comment line and can be tested with
//  $isComment = (substr(trim($thisLine),0,2) == "//");

/*   this is the start of a php or css comment
		which could be tested with
		
		$startComment = (substr(trim($thisLine),0,2) == "/*");
		
		and the end of the comment would be tested with
		
		$endComment = (substr(trim($thisLine),-2,2) == "*/");
		
*/


&lt;html&gt;
&lt;head&gt;
&lt;title&gt;This is an example HTML file&lt;/title&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;

&lt;/head&gt;
&lt;body&gt;
This is in the body tags of an HTML script  
&lt;/body&gt;
&lt;/html&gt;
</before>
            <after/>
          </leaf>
          <leaf type="insert" title="testFiles.php (fgets)">
            <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;

&lt;?php
/*

*	File:			testFiles.php
*					/DEMO
*	By:			TMIT
*	Date:		
*
*	This script 
*
*
*=====================================
*/

		// File handling example: 
	
			$file = fopen("plainTextFile", "r"); 		
			$i = 0;
			while(!feof($file))
			  {		  	
				$thisLine = fgets($file);		
				
				echo '&lt;p&gt;&lt;span class="scriptcolour"&gt;Line '.$i.':&lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; '.$thisLine.'&lt;/p&gt;';
				
				$i++; 
			  }
			fclose($file);
			
  

?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title=".... str_replace( &lt; &amp; &gt; ...">
            <before>				$thisLine = str_replace("&lt;","&amp;lt;",$thisLine);
				$thisLine = str_replace("&gt;","&amp;gt;",$thisLine);
</before>
            <after/>
          </leaf>
          <leaf type="insert" title=".... &gt; fwrite">
            <before>		
	{ 		//	Secure Connection Script
			include('../../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}
	
	{	//		SELECT all records in a table 
		$tableName = "tUser";	
		$table_SQLselect = "SELECT * ";
		$table_SQLselect .= "FROM ";
		$table_SQLselect .= $tableName." ";
		$table_SQLselect_Query = mysql_query($table_SQLselect); 	
	}
	
	// File handling example:   fwrite
	$csvFileName = $tableName.".csv";
	$fopenMode = 'a';
	$csvFileHandle = fopen($csvFileName, $fopenMode); 	
		
	if ($csvFileHandle) {
  	 	echo '$csvFileHandle:'.$csvFileHandle.'&lt;br /&gt;&lt;br /&gt;';

		while ($tableRow = mysql_fetch_array($table_SQLselect_Query, MYSQL_ASSOC)) {
	
				$tableRowCSV = implode(",", $tableRow);
				
				$tableRowCSV = str_replace("\n","",$tableRowCSV);
				$tableRowCSV = str_replace("\r","",$tableRowCSV);
				$tableRowCSV = $tableRowCSV."\n";
				
				$fwriteresult = fwrite($csvFileHandle, $tableRowCSV);
				if ($fwriteresult) {
			  	 	echo $fwriteresult.' bytes written for '.$tableRowCSV.'&lt;br /&gt;';		
				} else {
					echo "ERROR writing ".$tableRowCSV." to ".$csvFileName.'&lt;br /&gt;';
				}
		}		
		fclose($csvFileHandle);

	} else {
		echo 'ERROR: fopen('.$csvFileName.', '.$fopenMode.');'.'&lt;br /&gt;';
	}

</before>
            <after/>
          </leaf>
        </branch>
        <branch title="gd - imagecopyresized">
          <leaf type="insert" title="exif_read_data">
            <before>&lt;?php


//	vvv Test


		$imageFile = "http://www.infiniteskills.com/images/logo3.jpg";
		$imageFile = "http://www.training.tmit.net/TMIT_Logo.jpg";
		
		
			$typeTest =  exif_imagetype($imageFile);
		
			echo "TYPE: ".$typeTest;
			
		echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";		
		
			echo 'EXIF info for: '.$imageFile;
			
			echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";		      
		
		
			$exif = exif_read_data($imageFile);
			$exif_name = var_name($exif, get_defined_vars());
		
			$p = dumpArray($exif, $exif_name);


//	^^^ Test




function dumpArray($arr, $arrName){	
		
		foreach ($arr as $key =&gt; $value)
		{
	      echo  $arrName."[",$key."] =&gt; ".$value."&lt;br /&gt;";
	      if (is_array($value)) {
				foreach ($value as $key2 =&gt; $value2)
				{
				      echo  str_repeat("&amp;nbsp;", 8).$arrName."[",$key."][".$key2."] =&gt; ".$value2."&lt;br /&gt;";
				}
			}
	      echo "&lt;br /&gt;";		      
		}
}

function var_name (&amp;$iVar, &amp;$aDefinedVars){
	
    foreach ($aDefinedVars as $k=&gt;$v){
        $aDefinedVars_0[$k] = $v;}
 
    $iVarSave = $iVar;
    $iVar     =!$iVar;
 
    $aDiffKeys = array_keys (array_diff_assoc ($aDefinedVars_0, $aDefinedVars));
    $iVar      = $iVarSave;
 
    return $aDiffKeys[0];
}
	
?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="gdinfo()">
            <before>&lt;style type="text/css"&gt;
body {
	font-family: Arial, Helvetica, sans-serif;
}
.scriptcolour {
	color: maroon;	
}
&lt;/style&gt;

&lt;?php

				
		$arrayW = gd_info();


		$arrayW_name = var_name($arrayW, get_defined_vars());
				

		$p = dumpArray($arrayW, $arrayW_name);

		//	^^^ Test
		
function dumpArray($arr, $arrName){	
		
		foreach ($arr as $key =&gt; $value)
		{
	      echo  $arrName."[",$key."] =&gt; ".$value."&lt;br /&gt;";
	      if (is_array($value)) {
				foreach ($value as $key2 =&gt; $value2)
				{
				      echo  str_repeat("&amp;nbsp;", 8).$arrName."[",$key."][".$key2."] =&gt; ".$value2."&lt;br /&gt;";
				}
			}
	      echo "&lt;br /&gt;";		      
		}
}

function var_name (&amp;$iVar, &amp;$aDefinedVars){
	
    foreach ($aDefinedVars as $k=&gt;$v){
        $aDefinedVars_0[$k] = $v;}
 
    $iVarSave = $iVar;
    $iVar     =!$iVar;
 
    $aDiffKeys = array_keys (array_diff_assoc ($aDefinedVars_0, $aDefinedVars));
    $iVar      = $iVarSave;
 
    return $aDiffKeys[0];
}
 
?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="gd - create image">
            <before>&lt;?php

	//		set size of image
		$imageSizeX = 300;
		$imageSizeY = 300;
		
		$image = imagecreate($imageSizeX, $imageSizeY);

	//		first instance of imagecolorallocate sets background of image.
		$background_teal = imagecolorallocate ($image, 0, 125, 125);
	
	//		now set a colour for the text
		$red =  imagecolorallocate ($image, 255, 0, 0);
		$yellow = imagecolorallocate ($image, 235, 235, 51);
	
		$textColour = $yellow;
		
	//		set a path to the font
		$font_file = 'FreeMonoBoldOblique.ttf';
		$font_path = '../fonts/'.$font_file;
		
	//		the text string
		$string = 'php / MySQL Training';

	//		path and name of image file to be saved	
		$image_file = 'testImage.png';
		$image_path = '../images/'.$image_file;
	
		$fontsize = 18;
		$textAngle = 45;
		$xOffset = 50;
		$yOffset = 270;
		
	//		create the image 
		imagettftext (	$image, $fontsize, 
							$textAngle, 
							$xOffset, $yOffset, 
							$textColour, 
							$font_path, 
							$string);
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	
?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="gd - getimagesize">
            <before>&lt;?php



		$image_file = 'testImage.png';
		$image_path = '../images/'.$image_file;
	
		$getimagesizeArray = getimagesize($image_path);

		$getimagesizeArray_name = var_name($getimagesizeArray, get_defined_vars());

		$p = dumpArray($getimagesizeArray, $getimagesizeArray_name);

function dumpArray($arr, $arrName){	
		
		foreach ($arr as $key =&gt; $value)
		{
	      echo  $arrName."[",$key."] =&gt; ".$value."&lt;br /&gt;";
	      if (is_array($value)) {
				foreach ($value as $key2 =&gt; $value2)
				{
				      echo  str_repeat("&amp;nbsp;", 8).$arrName."[",$key."][".$key2."] =&gt; ".$value2."&lt;br /&gt;";
				}
			}
	      echo "&lt;br /&gt;";		      
		}
}

function var_name (&amp;$iVar, &amp;$aDefinedVars){
	
    foreach ($aDefinedVars as $k=&gt;$v){
        $aDefinedVars_0[$k] = $v;}
 
    $iVarSave = $iVar;
    $iVar     =!$iVar;
 
    $aDiffKeys = array_keys (array_diff_assoc ($aDefinedVars_0, $aDefinedVars));
    $iVar      = $iVarSave;
 
    return $aDiffKeys[0];
}
		
?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="gd - imagecreatefrompng">
            <before>&lt;?php

		$image_file = 'testImage.png';
		$image_path = '../images/'.$image_file;
		
		//		create an image resource from a file 
		$image = imagecreatefrompng($image_path);

		$red =  imagecolorallocate ($image, 255, 0, 0);
		$yellow = imagecolorallocate ($image, 235, 235, 51);
	
		$textColour = $yellow;

		$xCentre = 50;
		$yCentre = 50;
		$width = 50;
		$height = 80;

		$startAngle = 0;
		$endAngle = 360;
				
		$thickness = 5;
		
		//		Set thickness in px for drawing
		imagesetthickness ( $image  ,  $thickness  );
		
		//		Draw the arc		
 		imagearc($image, 
					$xCentre, $yCentre, 
					$width, $height,  
					$startAngle, $endAngle, 
					$red);		
		

	//		path and name of image file to be saved	
		$image_file = 'testImage2.png';
		$image_path = '../images/'.$image_file;
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	

?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="gd - imagecopyresized">
            <before>&lt;?php

		//		path and name of source
		$source_file = 'testImage2.png';
		$source_path = '../images/'.$source_file;

		//		path and name of image to be saved 
		$image_file = 'testImageThumb.png';
		$image_path = '../images/'.$image_file;

		//		resize factor		
		$thumbNailSize = 0.5;
					
		// Get new sizes
		list($width, $height) = getimagesize($source_path);
		
		$newwidth = $width * $thumbNailSize;
		$newheight = $height * $thumbNailSize;
		
		//		create an image resource from source
		$source = imagecreatefrompng($source_path);
	
		// Load
		$image = imagecreate($newwidth, $newheight);

		// Resize
		imagecopyresized($image, $source, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);
		
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	

?&gt;</before>
            <after/>
          </leaf>
        </branch>
        <branch title="uploading">
          <leaf type="insert" title="simple upload">
            <before>&lt;?php

$uploadActivated = $_POST['uploadActivated'];

if (isset($uploadActivated) AND $uploadActivated == 1) {
	
	$uploaddir = '../images/';
	$uploadfile = $uploaddir . basename($_FILES['userfile']['name']);
	

	if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) {
		 chmod($uploadfile, 0666);			//		used for commercial grade systems 		
	    echo "File is valid, and was successfully uploaded.&lt;br /&gt;";

		echo 'The image uploaded was "'.$uploadfile.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
		echo '&lt;img src="'.$uploadfile.'" alt="Test Image uploaded" /&gt;';

	} else {
	    echo "File upload error!&lt;br /&gt;";
	}
		
	unset($uploadActivated);	
		
}

		
echo '
&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;
&lt;form enctype="multipart/form-data" action="uploadtest.php" method="POST"&gt;
    &lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;
    &lt;input type="hidden" name="uploadActivated" value=1 /&gt;
    
    &lt;input type="hidden" name="MAX_FILE_SIZE" value="300000" /&gt;
    &lt;!-- Name of input element determines name in $_FILES array --&gt;
    Send this file: &lt;input name="userfile" type="file" /&gt;
    &lt;input type="submit" value="Upload File" /&gt;
&lt;/form&gt;';
	
	

?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="restrict files">
            <before>&lt;?php

//		File:    restrictedfiles.php


$uploadActivated = $_POST['uploadActivated'];

if (isset($uploadActivated) AND $uploadActivated == 1) {
	
	$uploaddir = '../images/';
	$uploadfile = $uploaddir . basename($_FILES['userfile']['name']);

	$maxFileSize = 300000;
	$fileSizeOK = TRUE;	

	$filesize = $_FILES['userfile']['size'];
	if ($filesize &gt; $maxFileSize)	{ 
		echo "ERROR: File too large.";
		$fileSizeOK = FALSE;		
	}
	
	$fileTypeOK = FALSE;	
		
	$whiteList = array(".jpg", ".png", ".gif");
	foreach ($whiteList as $file)
	{
		if(preg_match("/$file\$/i", $_FILES['userfile']['name']))
		{ $fileTypeOK = TRUE;	} 
	}
	
	if (!$fileTypeOK) { echo 'ERROR: invalid file type.&lt;br /&gt;&lt;br /&gt;'; }
	
	if ($fileTypeOK AND $fileSizeOK) {
		if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) {
			 chmod($uploadfile, 0666);			//		used for commercial grade systems 		
		    echo 'Valid File of size '.$filesize.' successfully uploaded.&lt;br /&gt;';
	
			echo 'The image uploaded was "'.$uploadfile.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$uploadfile.'" alt="Test Image uploaded" /&gt;';
	
		} else {
	
		    echo "File upload error!&lt;br /&gt;";
		}
	}					

}

unset($uploadActivated);	
		
echo '
&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;
&lt;form enctype="multipart/form-data" action="restrictedfiles.php" method="POST"&gt;
    &lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;
    &lt;input type="hidden" name="uploadActivated" value=1 /&gt;
    &lt;!-- Name of input element determines name in $_FILES array --&gt;
    Send this file: &lt;input name="userfile" type="file" /&gt;
    &lt;input type="submit" value="Upload File" /&gt;
&lt;/form&gt;';
	

?&gt;</before>
            <after/>
          </leaf>
        </branch>
        <branch title="file_get_contents">
          <leaf type="insert" title="get HTML file ">
            <before>&lt;?php

//		getFileContents.php


$urlString = 'http://www.training.tmit.net/tmit/tempHTML/toowhoo.html';

$pageContent = file_get_contents($urlString);

				$pageContent = str_replace("&lt;","&amp;lt;",$pageContent);
				$pageContent = str_replace("&gt;","&amp;gt;&lt;br /&gt;",$pageContent);

echo $pageContent;



?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="extract content">
            <before>&lt;?php
//		getFileContents.php


$urlString = 'http://www.training.tmit.net/tmit/tempHTML/toowhoo.html';

echo 'Extract content from:&lt;br /&gt;';
echo $urlString.'&lt;br /&gt;&lt;br /&gt;';

$pageContent = file_get_contents($urlString);

echo 'Title: '.getTextBetweenStrings($pageContent, "&lt;title&gt;", "&lt;/title&gt;").'&lt;br /&gt;';

echo 'eMail: '.getTextBetweenStrings($pageContent, 'eMail: &lt;a href="mailto:', '"&gt;').'&lt;br /&gt;';

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';

		$pageContent = str_replace("&lt;","&amp;lt;",$pageContent);
		$pageContent = str_replace("&gt;","&amp;gt;&lt;br /&gt;",$pageContent);

		echo $pageContent;



function getTextBetweenStrings($source, $leftstring, $rightstring) {
	
	$posLeft = stripos($source, $leftstring);						//		ignore case 
	$posLeft = $posLeft + strlen($leftstring);
	
	$posRight = stripos($source, $rightstring, $posLeft);
	$returnstring = trim(substr($source,$posLeft,  $posRight - $posLeft));

	return ($returnstring);	
}

?&gt;</before>
            <after/>
          </leaf>
          <leaf type="insert" title="multiple files">
            <before>&lt;?php
//		getFileContents.php


	$urlStringPrestring = 'http://www.training.tmit.net/tmit/tempHTML/';
	$fileArray = array('toowhoo.html', 'toowhit.html', 'tooright.html');
	
	foreach ($fileArray as $value) {
		
		$urlString = $urlStringPrestring.$value;
		
		echo 'Extracting content from: '.$value.'&lt;br /&gt;&lt;br /&gt;';
		
		$pageContent = file_get_contents($urlString);
		
		echo 'Title: '.getTextBetweenStrings($pageContent, "&lt;title&gt;", "&lt;/title&gt;").'&lt;br /&gt;';		
		echo 'Product: '.getTextBetweenStrings($pageContent, '&lt;h3&gt;Product:', '&lt;/h3&gt;').'&lt;br /&gt;';
		echo 'eMail: '.getTextBetweenStrings($pageContent, 'eMail: &lt;a href="mailto:', '"&gt;').'&lt;br /&gt;';
		
		echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';		
		
	}



function getTextBetweenStrings($source, $leftstring, $rightstring) {
	
	$posLeft = stripos($source, $leftstring);						//		ignore case 
	$posLeft = $posLeft + strlen($leftstring);
	
	$posRight = stripos($source, $rightstring, $posLeft);
	$returnstring = trim(substr($source,$posLeft,  $posRight - $posLeft));

	return ($returnstring);	
}

?&gt;</before>
            <after/>
          </leaf>
        </branch>
      </branch>
      <branch title="eMail">
        <leaf type="insert" title="php mail">
          <before>&lt;?php
	
//		eMail_test.php

$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];

$SMTPserver = 'smtp.ukonline.co.uk';

$default_FromMail = "noreply@jacasta.com";

$default_ToMail = "test@training.tmit.net";

if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 
			
				$ToMail = $_POST['ToMail'];
				$FromMail = $_POST['FromMail'];
				$subject = $_POST['subject'];
				$message = $_POST['message'];

				$headers =   'From: '.$FromMail."\r\n";
				$headers .=  'Reply-To: '.$FromMail."\r\n";	
				$headers .=  'X-Mailer: PHP/' . phpversion();
		
				ini_set("SMTP",$SMTPserver);
				$mailSent = mail($ToMail, $subject, $message, $headers);
		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';			
				}		
				
				echo '&lt;a href="eMail_test.php"&gt;again...&lt;/a&gt;';
		}
		
} else {
	
		{	//		FORM to get eMail details 

					
				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1/&gt;';
				
				$ToMail_fld = '&lt;input type="text" name="ToMail" value="'.$default_ToMail.'" size="25"/&gt;';
				$FromMail_fld = '&lt;input type="text" name="FromMail" value="'.$default_FromMail.'" size="25"/&gt;';
				
				$subject_fld = '&lt;input type="text" name="subject" size="25"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="eMail_test.php"&gt;';
						echo $sendWasClicked_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To eMail&lt;/td&gt;';
							echo '&lt;td&gt;'.$ToMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From eMail&lt;/td&gt;';
							echo '&lt;td&gt;'.$FromMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Message&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
			//		END: FORM to get eMail details			
		} 
} 
        
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="add cc, bcc ">
          <before>&lt;?php

//		eMail_test_cc.php

$pageStyle = pageStyle();								//		&lt;&lt;&lt;

$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];

$SMTPserver = 'smtp.ukonline.co.uk';

$default_FromMail = "noreply@jacasta.com";

$default_ToMail = "test@training.tmit.net";

					
if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 
			
				$ToMail = $_POST['ToMail'];
				$MailCC = $_POST['MailCC'];								//		&lt;&lt;&lt;
				$MailBCC = $_POST['MailBCC'];								//		&lt;&lt;&lt;
				$FromMail = $_POST['FromMail'];
				$subject = $_POST['subject'];
				$message = $_POST['message'];
		
																	
				$headers =   'From: '.$FromMail."\r\n";
				$headers .=  'Reply-To: '.$FromMail."\r\n";	
				
				$headers .=  'Cc: '.$MailCC."\r\n";							//		&lt;&lt;&lt;
				$headers .=  'BCC: '.$MailBCC."\r\n";							//		&lt;&lt;&lt;
												    
				$headers .=  'Content-Type: text/html'.chr(13).chr(10);
				$headers .=  'X-Mailer: PHP/' . phpversion();
		
				ini_set("SMTP",$SMTPserver);
				$mailSent = mail($ToMail, $subject, $message, $headers);
		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';			
				}		
				
				echo '&lt;a href='.$thisScriptname.'&gt;again...&lt;/a&gt;';
		}
		
} else {
	
		{	//		FORM to get eMail details 

				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1/&gt;';

				$FromMail_fld = '&lt;input type="text" name="FromMail" value="'.$default_FromMail.'" size="25"/&gt;';
				
				$ToMail_fld = '&lt;input type="text" name="ToMail" value="'.$default_ToMail.'" size="25"/&gt;';


		//		vvvvvvvvvvvvv
					$MailCC_fld = '&lt;input type="text" name="MailCC" size="25"/&gt;';
					$MailBCC_fld = '&lt;input type="text" name="MailBCC" size="25"/&gt;';
		//		^^^^^^^^^^^^^^
		
		
				$subject_fld = '&lt;input type="text" name="subject" size="25"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="'.$thisScriptname.'"&gt;';
						echo $sendWasClicked_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To:&lt;/td&gt;';
							echo '&lt;td&gt;'.$ToMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;CC:&lt;/td&gt;';
							echo '&lt;td&gt;'.$MailCC_fld.'&lt;/td&gt;';			//		&lt;&lt;&lt;
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;BCC:&lt;/td&gt;';
							echo '&lt;td&gt;'.$MailBCC_fld.'&lt;/td&gt;';			//		&lt;&lt;&lt;
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td&gt;'.$FromMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject:&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td valign="top"&gt;Message:&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
			//		END: FORM to get eMail details			
		} 
} 

function pageStyle() {
			echo'	
			&lt;style type="text/css"&gt;
			body {
				font-family: Arial, Helvetica, sans-serif;
			}
			td {
				color: maroon;	
			}
			.scriptcolour {
				color: maroon;	
			}
			
			&lt;/style&gt;
			';
}        
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="add HTML">
          <before>&lt;?php

//		eMail_test_html.php

$pageStyle = pageStyle();							

$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];

$SMTPserver = 'smtp.ukonline.co.uk';

$thisScriptname = 'eMail_test_html.php';

$default_FromMail = "noreply@jacasta.com";

$default_ToMail = "test@training.tmit.net";

$templateURL = 'eMailTemplate.html';						//		&lt;&lt;&lt;

if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 

							
				$ToMail = $_POST['ToMail'];
				$MailCC = $_POST['MailCC'];								
				$MailBCC = $_POST['MailBCC'];							
				$FromMail = $_POST['FromMail'];
				$subject = $_POST['subject'];
				$message = $_POST['message'];

				
				//    get template:													vvvvvv		
												
					$templateString = file_get_contents($templateURL);
		
					$htmlMessage = str_replace("[%content]",$message, $templateString); 
	
					echo $htmlMessage;	
				//		^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^		
																				

				$headers =   'From: '.$FromMail."\r\n";

				//    check valid eMails												vvvvvv						
					if (check_email($email)) { $headers .=  'CC: '.$MailCC."\r\n"; }
					if (check_email($MailBCC)) { $headers .=  'BCC: '.$MailBCC."\r\n"; }
				//		^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^		
							    
				$headers .=  'Reply-To: '.$FromMail."\r\n";

				//    Content-Type:																			
					$headers .=  'Content-Type: text/html'."\r\n";			//		&lt;&lt;&lt;

					$headers .=  'X-Mailer: PHP/' . phpversion();


				if (check_email($ToMail)) { 
					ini_set("SMTP",$SMTPserver);
					$mailSent = mail($ToMail, $subject, $htmlMessage, $headers);
			
					if ($mailSent) {
						echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					} else {
						echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';			
					}		
					
					echo '&lt;a href='.$thisScriptname.'&gt;again...&lt;/a&gt;';
				} else {
					echo "Invalid 'To:' address.&lt;br /&gt;&lt;br /&gt;";	
					echo '&lt;a href='.$thisScriptname.'&gt;try again...&lt;/a&gt;';
				}
		}
		
} else {
	
		{	//		FORM to get eMail details 

					
				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1/&gt;';

				$FromMail_fld = '&lt;input type="text" name="FromMail" value="'.$default_FromMail.'" size="25"/&gt;';
				
				$ToMail_fld = '&lt;input type="text" name="ToMail" value="'.$default_ToMail.'" size="25"/&gt;';
				//		vvvvvvvvvvvvv
					$MailCC_fld = '&lt;input type="text" name="MailCC" size="25"/&gt;';
					$MailBCC_fld = '&lt;input type="text" name="MailBCC" size="25"/&gt;';
		
		
				$subject_fld = '&lt;input type="text" name="subject" size="25"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="'.$thisScriptname.'"&gt;';
						echo $sendWasClicked_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To:&lt;/td&gt;';
							echo '&lt;td&gt;'.$ToMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;CC:&lt;/td&gt;';
							echo '&lt;td&gt;'.$MailCC_fld.'&lt;/td&gt;';			
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;BCC:&lt;/td&gt;';
							echo '&lt;td&gt;'.$MailBCC_fld.'&lt;/td&gt;';			
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td&gt;'.$FromMail_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject:&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td valign="top"&gt;Message:&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
			//		END: FORM to get eMail details			
		} 
} 

function pageStyle() {
			echo'	
			&lt;style type="text/css"&gt;
			body {
				font-family: Arial, Helvetica, sans-serif;
			}
			td {
				color: maroon;	
			}
			.scriptcolour {
				color: maroon;	
			}
			
			&lt;/style&gt;
			';
}  

function check_email($email) {  
 	if( (preg_match('/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/', $email)) || 
 		(preg_match('/^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/',$email)) ) { 
		 return true;
 	} else {
		 return false;
	}    	
 }
      
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... eMail Template">
          <before>&lt;html&gt;&#xD;
&lt;head&gt;&#xD;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;&#xD;
&lt;title&gt;TMIT - the database experts!&lt;/title&gt;
&lt;!-- eMail Template   eMailTemplate.html --&gt;&#xD;
&lt;style type="text/css"&gt;&#xD;
&lt;!--&#xD;

#body {
	margin: 0; 
	padding: 0;
	
}

&#xD;
.tmitLogo{
	position:absolute;
	top: 20px;
	left: 20px;&#xD;
	height: 150px;	
	width:200px;&#xD;
	background:url("http://www.TMIT.net/TMIT_eLogo_w150.png") top left no-repeat;
	z-index:9;
&#xD;
}&#xD;
&#xD;
.strip1 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top:0;&#xD;
	background-color: #7CA3CE;&#xD;
	height: 5.2em;	&#xD;
}&#xD;
&#xD;
.strip2 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top: 5.2em;	&#xD;
	background-color: #D9E2EB;&#xD;
	height: 1.5em;&#xD;
}&#xD;

.striptail {&#xD;
	width:100%;&#xD;
	background-color: #D9E2EB;&#xD;
	height: 1em;&#xD;
}&#xD;
&#xD;


.header{
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 2em;&#xD;
	font-weight: bold;&#xD;
	color:#005064;&#xD;
	margin-top:0.3em;&#xD;
	margin-left:3em;&#xD;
}&#xD;
&#xD;
.strapline{&#xD;
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#FFFF33;&#xD;
	margin-left:8em;&#xD;
	margin-top:-1em;&#xD;
	font-style: italic;&#xD;
}&#xD;
&#xD;
.straptail{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#005064;&#xD;
	font-style: none;&#xD;
&#xD;
}&#xD;
&#xD;
.strapinfo{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#092049;&#xD;
	font-style: none;&#xD;
&#xD;
}

.indentLetter{
	margin-top: 8em;
	width: 90%;&#xD;
	text-align:left;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 1em;&#xD;
	font-weight: normal;&#xD;
	color:#000000;&#xD;
	font-style: none;&#xD;
	margin-left:2em;	
	background:url("http://www.TMIT.net/fsb_w100.png") top right no-repeat;
}&#xD;
--&gt;&#xD;
&lt;/style&gt;&#xD;
&#xD;
&lt;/head&gt;&#xD;
&lt;body&gt;&#xD;
		&lt;div&gt;
					&lt;div class="strip1"&gt; &#xD;
					  	&lt;p class="header"&gt;TMIT - the database experts&lt;/p&gt;&#xD;
					  	&lt;p class="strapline"&gt;specialists in web 2.0 applications&lt;/p&gt;
					&lt;/div&gt;
					&lt;div class="strip2"&gt;&lt;/div&gt;&#xD;
					&lt;div class="tmitLogo"&gt;	&lt;/div&gt;
		&lt;/div&gt;
		&lt;div class="indentLetter"&gt;
		&lt;span class="fsb"&gt;&lt;/span&gt;
					
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					[%content]&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;

			
					Regards&lt;br/&gt;
					Principal&lt;br/&gt;
					TMIT World Limited&lt;br/&gt;
					&lt;br/&gt;
					Tel:&amp;nbsp;&amp;nbsp;01869&amp;nbsp;322665					
					&lt;br/&gt;
		&lt;/div&gt;
		&lt;div class="striptail"&gt;&#xD;
		  &lt;p class="straptail"&gt;Leaders in business information systems,
      content management and process design - 
      Business information delivered to your browser.&lt;/p&gt;&#xD;
		&lt;/div&gt;&#xD;
		&lt;div class="strapinfo"&gt;&#xD;
		&lt;br/&gt;&#xD;
		  &lt;a href="http://www.tmitworld.com/index.php?option=com_content&amp;view=category&amp;id=90&amp;Itemid=120"&gt;
            If you use the web for anything then you need to know about &lt;strong&gt;ACID3&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;
		  
&lt;/body&gt;&#xD;
&lt;/html&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... HTML eMail snippet">
          <before>&lt;h4 style="color: blue;"&gt;php mail() provides facilities to:&lt;/h4&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;strong&gt;embed HTML&lt;/strong&gt; in mail content or templates&lt;/li&gt;
	&lt;li&gt;use variables to &lt;strong&gt;repeat addresses&lt;/strong&gt;&lt;/li&gt;
	&lt;li&gt;use variables to &lt;strong&gt;personalise bulk mail&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="OO model">
        <leaf type="insert" title="dbClasses.php">
          <before>&lt;?php

/*		THIS IS INCLUDE FILE:   dbClasses.php
*
*		folder:			classes/
*
*		used in:       index.php
*
*		version:    	1303   date: 2010-07-06
*
*		classes:			DBconnection	-		connect to and select DB 
*
*
*	=================================================================
*/		

class DBconnection{

		//	public properties
			public $errorMsg;
			public $errorCode;

		//	public methods
			public function __construct($hostname, $username, $password, $database) {
				$this-&gt;connection = @mysql_connect($hostname,$username,$password);
				
				if (!$this-&gt;connection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					return false;
				}

				$this-&gt;selection = @mysql_select_db($database,$this-&gt;connection);
	
				if (!$this-&gt;selection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					@mysql_close($this-&gt;connection);
					return false;
				}
				echo "THIS CONNECTION: ".$this-&gt;connection."&lt;br /&gt;&lt;br /&gt;";
			}			
			public function getConnectionID() {
				return $this-&gt;connection;	
			}
													
//	END:  		class DBconnection	
}			

	

?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... ooDBexampleA.php">
          <before>&lt;?php

//	File:   ooDBexampleA.php
//	folder:			DEMO

include('../../htconfig/dbConfig.php'); 
include('../classes/dbClasses.php'); 

$connectDB = new DBconnection(	$db['hostname'],
											$db['username'],
											$db['password'],
											$db['database']	);
											
$connectionID = $connectDB-&gt;getConnectionID();

echo "New connectionID  is $connectionID";

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";



?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="dbClasses [rev. 1303_02]">
          <before>&lt;?php

/*		THIS IS INCLUDE FILE:   dbClasses.php
*
*		folder:			classes/
*
*		used in:       index.php
*
*		version:    	1303_02   date: 2010-07-06
*
*		classes:			DBconnection	-		connect to and select DB 
*										methods:   __construct($hostname, $username, $password, $database)
*														getConnectionID()
*														
*							cTable			-		table meta info
*										methods:   __construct($tableName)
*														getRecordCount ()
*
*	=================================================================
*/		

class DBconnection{

		//	public properties
			public $errorMsg;
			public $errorCode;

		//	public methods
			public function __construct($hostname, $username, $password, $database) {
				$this-&gt;connection = @mysql_connect($hostname,$username,$password);
				
				if (!$this-&gt;connection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					return false;
				}

				$this-&gt;selection = @mysql_select_db($database,$this-&gt;connection);
	
				if (!$this-&gt;selection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					@mysql_close($this-&gt;connection);
					return false;
				}
			}			

			public function getConnectionID() {
				return $this-&gt;connection;	
			}
													
//	END:  		class DBconnection	
}			

class cTable{
		//	properties
			public $errorMsg;
			public $errorCode;

		// methods
			public function __construct($tableName) {
				$this-&gt;tableName = $tableName;	
			}

			public function getRecordCount () {
		 		$countSQL = "SELECT COUNT(ID) AS countID FROM ".$this-&gt;tableName;
				$this-&gt;countQuery = @mysql_query($countSQL);		
						
				$this-&gt;recordArray = @mysql_fetch_array($this-&gt;countQuery, MYSQL_ASSOC);
				return $this-&gt;recordArray['countID'];
			} 

//	END:  		class cTable
}		


?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... ooDBexampleB.php">
          <before>&lt;?php

//	File:   ooDBexampleB.php
//	folder:			DEMO

include('../../htconfig/dbConfig.php'); 
include('../classes/dbClasses.php'); 

	$connectDB = new DBconnection(	$db['hostname'],
												$db['username'],
												$db['password'],
												$db['database']	);
												
	$connectionID = $connectDB-&gt;getConnectionID();
	
	echo "New connectionID  is $connectionID";

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	$tableName = "tPerson";
	$tableObject = new cTable($tableName);
	
	echo "Number of records in ".$tableName." is: ".$tableObject-&gt;getRecordCount();	 
	
	echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
	
	$tableName = "tCompany";
	$tableObject = new cTable($tableName);

	echo "Number of records in ".$tableName." is: ".$tableObject-&gt;getRecordCount();	 

echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="dbClasses [rev. 1303_03]">
          <before>&lt;?php

/*		THIS IS INCLUDE FILE:   dbClasses.php
*
*		folder:			classes/
*
*		used in:       index.php
*
*		version:    	1303_03   date: 2010-07-06
*
*		classes:			DBconnection	-		connect to and select DB 
*										methods:   __construct($hostname, $username, $password, $database)
*														getConnectionID()
*														
*							cTable			-		table meta info
*										methods:   __construct($tableName)
*														getRecordCount ()
*														getAll ()
*
*							cRecord			-		DB record data
*										methods:   __construct($tableName, $recordID)
*														function getRecord
*
*
*	=================================================================
*/		
class DBconnection{

		//	public properties
			public $errorMsg;
			public $errorCode;

		//	constructor method           
			public function __construct($hostname, $username, $password, $database) {
				$this-&gt;connection = @mysql_connect($hostname,$username,$password);
				
				if (!$this-&gt;connection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					return false;
				}

				$this-&gt;selection = @mysql_select_db($database,$this-&gt;connection);
	
				if (!$this-&gt;selection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					@mysql_close($this-&gt;connection);
					return false;
				}
			}		
				
		//	helper methods           
			public function getConnectionID() {
				return $this-&gt;connection;	
			}
													
//	END:  		class DBconnection	
}			

class cTable{
		//	properties
			public $errorMsg;
			public $errorCode;
			public $countQuery;
			public $recordArray;

		//	constructor method          
			public function __construct($tableName) {
				$this-&gt;tableName = $tableName;	
			}

		//	helper methods           
			public function getRecordCount () {
		 		$countSQL = "SELECT COUNT(ID) AS countID FROM ".$this-&gt;tableName;
				$this-&gt;countQuery = @mysql_query($countSQL);		
						
				$this-&gt;recordArray = @mysql_fetch_array($this-&gt;countQuery, MYSQL_ASSOC);
				return $this-&gt;recordArray['countID'];
			} 
			
			public function getAll () {
		 		$SQL = "SELECT * FROM ".$this-&gt;tableName;
				$this-&gt;query = @mysql_query($SQL);		

				while ($row = mysql_fetch_array($this-&gt;query, MYSQL_ASSOC)) {
					$this-&gt;recordArray[] = $row;
				}				
				return $this-&gt;recordArray;
			} 
		

//	END:  		class cTable
}		

class cRecord{
		//	public properties
			public $errorMsg;
			public $errorCode;
			public $query;
			public $found;
			public $recordArray;
			public $countQuery;

		// constructor method    
			public function __construct($tableName, $recordID) {
				$this-&gt;tableName = $tableName;			
				$this-&gt;recordID = $recordID;			
			}
		
			public function getRecord () { 
		 		$SQL = "SELECT * FROM ".$this-&gt;tableName." ";
				$SQL .= "WHERE ID = ".$this-&gt;recordID;
	
				$this-&gt;query = @mysql_query($SQL);
				
				if ($this-&gt;query) {
					$this-&gt;found = @mysql_num_rows($this-&gt;query);
				
					if ($this-&gt;found &gt; 0) {	
						$this-&gt;recordArray = @mysql_fetch_array($this-&gt;query, MYSQL_ASSOC);
						echo $SQL.'&lt;br /&gt;';	
						echo $this-&gt;recordArray['preName'];
						return $this-&gt;recordArray;
							
					} else {
						$this-&gt;errorMsg  = "0 records";
						$this-&gt;errorCode  = "0";
						return FALSE;
					}					
				} else {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();		
					return FALSE;		
				//	END: 		if (!$this-&gt;query) 			
				}
			//	END: 		function getRecord ()			
			}
//	END:  		class cRecord
}			

	

?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... ooDBexampleC.php">
          <before>&lt;?php

//	File:   ooDBexampleC.php
//	folder:			DEMO

include('../../htconfig/dbConfig.php'); 
include('../classes/dbClasses.php'); 

	{ 	//   class DBconnection example 
			$connectDB = new DBconnection(	$db['hostname'],
														$db['username'],
														$db['password'],
														$db['database']	);
														
			$connectionID = $connectDB-&gt;getConnectionID();
			
			echo "New connectionID  is $connectionID";
		
			echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";
	
	}

	{ 	//   class cTable example 
	
		$tableName = "tCompany";
		$tableObject = new cTable($tableName);
		$recordCount = $tableObject-&gt;getRecordCount();	 
		
		echo "Number of records in ".$tableName." is: ".$recordCount;
		
		echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	}
	
	{ 	//   class cTable example 2

		$companyObject = new cTable($tableName);

		$company = $companyObject-&gt;getAll();

		for ($ii = 0; $ii &lt; $recordCount; $ii++) {
			$id = $company[$ii]['ID'];
			$coName = $company[$ii]['Name'];
			echo "company ".$id." = ".$coName."&lt;br /&gt;";
		}

		echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	}
	
	{ 	//   class cRecord example 

		$personObject = new cRecord("tPerson", 5);
		$person = $personObject-&gt;getRecord();
		
		echo trim($person['Salutation']." ".$person['FirstName']." ".$person['LastName']);
		echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	}
	

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="dbClasses - indexVersion">
          <before>&lt;?php

/*		THIS IS INCLUDE FILE:   dbClasses_tp.php
*
*		folder:			classes/
*
*		used in:       index.php
*
*		version:    	1303_04   date: 2010-07-06
*
*		Revision:		version of dbClasses for use in index.php
*
*		classes:			DBconnection	-		connect to and select DB 
*										methods:   __construct($hostname, $username, $password, $database)
*														getConnectionID()
*
*		code:				API - $dbSuccess;
*
*							deleted - example classes
*
*	=================================================================
*/		
class DBconnection{

		//	public properties
			public $errorMsg;
			public $errorCode;

		//	constructor method           
			public function __construct($hostname, $username, $password, $database) {
				$this-&gt;connection = @mysql_connect($hostname,$username,$password);
				
				if (!$this-&gt;connection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					return false;
				}

				$this-&gt;selection = @mysql_select_db($database,$this-&gt;connection);
	
				if (!$this-&gt;selection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					@mysql_close($this-&gt;connection);
					return false;
				}
			}		
				
		//	helper methods           
			public function getConnectionID() {
				return $this-&gt;connection;	
			}
													
//	END:  		class DBconnection	
}			

	include('../htconfig/dbConfig.php'); 
	
	{ 	//   Actual DBconnection 
			$connectDB = new DBconnection(	$db['hostname'],
														$db['username'],
														$db['password'],
														$db['database']	);
														
			$dbSuccess = $connectDB-&gt;getConnectionID();

	}

?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="include('classes/dbClasses_tp.php');">
          <before>/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Version:		2
*	Date:			2010-07-06
*
*	Revisions:	2		ooModel connection Script
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/

include('classes/dbClasses_tp.php');
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="CMS">
        <leaf type="insert" title="Joomla! - index.php">
          <before>&lt;?php
/**
			 * Bespoke Joomla Template by TMITworld.co.uk
			 * Author www.TMITworld.co.uk
			 
			 * Template name = tmit_min
 */

// no direct access
defined( '_JEXEC' ) or die( 'Restricted access' );
JHTML::_('behavior.modal');
?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="
&lt;?php echo $this-&gt;language; ?&gt;" lang="&lt;?php echo $this-&gt;language; ?&gt;" &gt;
&lt;head&gt;
&lt;jdoc:include type="head" /&gt;
&lt;?php
	//	setup MetaTags
	$document =&amp; JFactory::getDocument();
	$document-&gt;setMetaData('robots', 'noindex, nofollow');

	$document-&gt;setMetaData('generator', 'TMIT implementation of Joomla!');
	$document-&gt;setMetaData('Author', 'TMIT - web 2.0 applications and datebase experts. www.TMITworld.com');
	$document-&gt;setMetaData('copyright', 'TMIT World Limited');
	$document-&gt;setMetaData('date', '2010-06-15');

	// end MetaTags

?&gt;
&lt;META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/system/css/system.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/system/css/general.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/&lt;?php echo $this-&gt;template ?&gt;/css/t_min_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/&lt;?php echo $this-&gt;template ?&gt;/css/t_min_format.css" type="text/css" /&gt;

&lt;!--[if lte IE 7]&gt;
&lt;link href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/&lt;?php echo $this-&gt;template ?&gt;/css/t_min_IE7.css" rel="stylesheet" type="text/css" /&gt;
&lt;![endif]--&gt;

&lt;!--[if lte IE 6]&gt;
&lt;link href="&lt;?php echo $this-&gt;baseurl ?&gt;/templates/&lt;?php echo $this-&gt;template ?&gt;/css/t_min_IE6.css" rel="stylesheet" type="text/css" /&gt;
&lt;![endif]--&gt;



&lt;/head&gt;
&lt;body&gt;

&lt;div id="header"&gt;    &lt;!-- begin header --&gt;

				&lt;div id="headerLeft"&gt;&lt;!-- begin headerLeft --&gt;
					&lt;jdoc:include type="modules" name="modposTopLeft" /&gt;
				&lt;/div&gt;&lt;!-- end headerLeft --&gt;

				&lt;div id="headerRight"&gt;&lt;!-- begin headerRight --&gt;
					&lt;jdoc:include type="modules" name="modposTopRight" /&gt;				
				&lt;/div&gt;&lt;!-- end headerRight --&gt;

					&lt;?php  if($this-&gt;countModules('top')) : ?&gt;
						&lt;div id="topmodules" class="float"&gt;
							&lt;jdoc:include type="modules" name="modposTop" /&gt;
						&lt;/div&gt;     
					&lt;?php endif; ?&gt;
	
	
	
&lt;/div&gt;    &lt;!-- end header --&gt;

&lt;div id="wrapper1"&gt;&lt;!-- sets background to white and creates full length leftcol--&gt;
	
	&lt;div id="wrapper2"&gt;&lt;!-- sets background to white and creates full length rightcol--&gt;
	
		&lt;div id="maincol"&gt;&lt;!-- begin main content area --&gt;
				
			&lt;div id="leftcol"&gt;&lt;!-- begin leftcol --&gt;
				&lt;div class="leftModuleOffset"&gt;
					&lt;jdoc:include type="modules" name="modposLeftCol" /&gt;	
				&lt;/div&gt;
			&lt;/div&gt;&lt;!-- end leftcol --&gt;


			&lt;?php  if($this-&gt;countModules('right')) : ?&gt;
				&lt;div id="rightcol"&gt;&lt;!-- begin rightcol --&gt;
						&lt;jdoc:include type="modules" name="modposRightCol" /&gt;
				&lt;/div&gt;&lt;!-- end righttcol --&gt;     
			&lt;?php endif; ?&gt;


			
			&lt;div id="centercol"&gt;&lt;!-- begin centercol --&gt;
				&lt;jdoc:include type="component" /&gt;								
			&lt;/div&gt;&lt;!-- end centercol --&gt;
				
		&lt;/div&gt;&lt;!-- END id="maincol" - main content area --&gt;
				
		&lt;div id="modposFooter"&gt;&lt;!-- begin footer --&gt;
				&lt;?php echo "Copyright &#xA9; 2009-";
				echo date("Y")."&amp;nbsp;&amp;nbsp;&amp;nbsp&amp;nbsp;";
				echo $this-&gt;params-&gt;get('OwnerName');
				// echo ", TMIT World Limited. "
				echo ".&amp;nbsp;&amp;nbsp;&amp;nbsp&amp;nbsp;&amp;nbsp;&amp;nbsp;Hosted, Powered &amp;amp; Maintained by";?&gt; 
				&lt;a href="http://www.tmitservices.co.uk/vf/websites/" target="_TMIT"&gt;TMIT World&lt;/a&gt;

		&lt;/div&gt;&lt;!-- end footer --&gt;
	
	&lt;/div&gt;    &lt;!-- end wrapper2 --&gt;

&lt;/div&gt;    &lt;!-- end wrapper1 --&gt;


&lt;/body&gt;
&lt;/html&gt;
&lt;?php 

/**
 * @copyright	Copyright (C) 2005 - 2008 Open Source Matters. All rights reserved.
 * @license		GNU/GPL, see LICENSE.php
 * Joomla! is free software. This version may have been modified pursuant
 * to the GNU General Public License, and as distributed it includes or
 * is derivative of works licensed under the GNU General Public License or
 * other free or open source software licenses.
 * See COPYRIGHT.php for copyright notices and details.
 ----------------------------------------------------------------------------------
 * Bespoke Joomla! Template by TMITworld.co.uk
 * Author www.TMITworld.co.uk
 */
?&gt;
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="CRM">
        <leaf type="insert" title="vTiger - reset admin PW">
          <before>UPDATE vtiger_users SET user_password = 'adpexzg3FUZAk', crypt_type=' ' WHERE id=1;</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="exercises">
      <branch title="Functions">
        <leaf type="insert" title="NEW* fn_tPerson_SQL.php (1010)">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1010   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*
*		revision  1010
*							validates eMail addresses
*
*	===========================================================================
*/		

	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		//		revision:    1010

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

			if (!empty($eMail)) {
				if (!check_email($eMail)) { 
					$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
				} else {
					if (!check_email_mx($eMail)) { 
						$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
					}
				}
			}				
		}

		if (empty($errorMsg)) {
			$tPerson_SQLinsert = "INSERT INTO tPerson (";			
			$tPerson_SQLinsert .=  "Salutation, ";
			$tPerson_SQLinsert .=  "FirstName, ";
			$tPerson_SQLinsert .=  "LastName, ";
			$tPerson_SQLinsert .=  "Tel, ";	
			$tPerson_SQLinsert .=  "eMail, ";	
			$tPerson_SQLinsert .=  "companyID ";
			$tPerson_SQLinsert .=  ") ";
			
			$tPerson_SQLinsert .=  "VALUES (";
			$tPerson_SQLinsert .=  "'".$Salutation."', ";
			$tPerson_SQLinsert .=  "'".$FirstName."', ";
			$tPerson_SQLinsert .=  "'".$LastName."', ";
			$tPerson_SQLinsert .=  "'".$Tel."', ";	
			$tPerson_SQLinsert .=  "'".$eMail."', ";	
			$tPerson_SQLinsert .=  "'".$companyID."' ";
			$tPerson_SQLinsert .=  ") ";
	

			if (!mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = dataError("FAILED to add new person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {


		if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

		if (!empty($eMail)) {
			if (!check_email($eMail)) { 
				$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
			} else {
				if (!check_email_mx($eMail)) { 
					$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
				}
			}
		}				

		if (empty($errorMsg)) {
		
			$tPerson_SQLupdate = "UPDATE tPerson SET ";			
			$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
			
			$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
			$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
			$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
			$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
			$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
			$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
		
			if (!mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = dataError("FAILED to update person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="... rev: tp_personAddForm.php (1010)">
          <before>	
	//	Revisions 1010 - place at END of file before php tag
	if (!empty($insertMsg)) {
		echo $insertMsg;
	}

</before>
          <after/>
        </leaf>
      </branch>
      <branch title="File Handling">
        <leaf type="insert" title="btnEdit.php">
          <before>&lt;?php

	//		File btnEdit.php
	
	//		set size of image
		$imageSizeX = 50;
		$imageSizeY = 16;
		
		$image = imagecreate($imageSizeX, $imageSizeY);

	//		first instance of imagecolorallocate sets background of image.
		$background_teal = imagecolorallocate ($image, 0, 125, 125);
	
	//		now set a colour for the text
		$yellow = imagecolorallocate ($image, 235, 235, 51);
	
		$textColour = $yellow;
		
	//		set a path to the font
		$font_file = 'FreeSansBold.ttf';
		$font_path = '../fonts/'.$font_file;
		
	//		the text string
		$string = 'edit';

	//		path and name of image file to be saved	
		$image_file = 'btnEdit.png';
		$image_path = '../images/'.$image_file;
	
		$fontsize = 12;
		$textAngle = 0;
		$xOffset = 12;
		$yOffset = 14;
		
	//		create the image 
		imagettftext (	$image, $fontsize, 
							$textAngle, 
							$xOffset, $yOffset, 
							$textColour, 
							$font_path, 
							$string);
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... btnEdit &gt; tp_co..Pe..Edit">
          <before>				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="eMail">
        <leaf type="insert" title="ex1 - eMailTemplateONE">
          <before>&lt;html&gt;&#xD;
&lt;head&gt;&#xD;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;&#xD;
&lt;title&gt;The Quiche Company&lt;/title&gt;
&lt;!-- eMail Template   eMailTemplateONE.html --&gt;&#xD;
&lt;style type="text/css"&gt;&#xD;
&lt;!--&#xD;

#body {
	margin: 0; 
	padding: 0;
	
}

&#xD;
.tmitLogo{
	position:absolute;
	top: 20px;
	left: 20px;&#xD;
	height: 150px;	
	width:200px;&#xD;
	z-index:9;
&#xD;
}&#xD;
&#xD;
.strip1 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top:0;&#xD;
	background-color: #731600;&#xD;
	height: 5.2em;	&#xD;
}&#xD;
&#xD;
.strip2 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top: 5.2em;	&#xD;
	background-color: #FF9C2A;&#xD;
	height: 1.5em;&#xD;
}&#xD;

.striptail {&#xD;
	width:100%;&#xD;
	background-color: #FF9C2A;&#xD;
	height: 1em;&#xD;
}&#xD;
&#xD;


.header{
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 2em;&#xD;
	font-weight: bold;&#xD;
	color:#A2C100;&#xD;
	margin-top:0.3em;&#xD;
	margin-left:3em;&#xD;
}&#xD;
&#xD;
.strapline{&#xD;
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#FFFF33;&#xD;
	margin-left:8em;&#xD;
	margin-top:-1em;&#xD;
	font-style: italic;&#xD;
}&#xD;
&#xD;
.straptail{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#005064;&#xD;
	font-style: none;&#xD;
&#xD;
}&#xD;
&#xD;
.strapinfo{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#092049;&#xD;
	font-style: none;&#xD;
&#xD;
}

.indentLetter{
	margin-top: 8em;
	width: 90%;&#xD;
	text-align:left;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 1em;&#xD;
	font-weight: normal;&#xD;
	color:#000000;&#xD;
	font-style: none;&#xD;
	margin-left:2em;	
}&#xD;
--&gt;&#xD;
&lt;/style&gt;&#xD;
&#xD;
&lt;/head&gt;&#xD;
&lt;body&gt;&#xD;
		&lt;div&gt;
					&lt;div class="strip1"&gt; &#xD;
					  	&lt;p class="header"&gt;Template Example ONE&lt;/p&gt;&#xD;
					  	&lt;p class="strapline"&gt; - for exercise 1 of chapter 'eMail with php'&lt;/p&gt;
					&lt;/div&gt;
					&lt;div class="strip2"&gt;&lt;/div&gt;&#xD;
					&lt;div class="tmitLogo"&gt;	&lt;/div&gt;
		&lt;/div&gt;
		&lt;div class="indentLetter"&gt;
		&lt;span class="fsb"&gt;&lt;/span&gt;
					
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					[%content]&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;

			
					Your obedient, modest and humble servant, &lt;br/&gt;
					MegaBoss and Intergalactic SuperStar&lt;br/&gt;
					The Quiche Company&lt;br/&gt;
					&lt;br/&gt;
					&lt;br/&gt;
		&lt;/div&gt;
		&lt;div class="striptail"&gt;&#xD;
		  &lt;p class="straptail"&gt;Leaders in Quiche.&lt;/p&gt;&#xD;
		&lt;/div&gt;&#xD;
		&lt;div class="strapinfo"&gt;&#xD;
		&lt;br/&gt;&#xD;
		  Squishy quiche is a dishy dish.&lt;/div&gt;
		  
&lt;/body&gt;&#xD;
&lt;/html&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... ex1 - eMailTemplateTWO">
          <before>&lt;html&gt;&#xD;
&lt;head&gt;&#xD;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;&#xD;
&lt;title&gt;The Pie Company&lt;/title&gt;
&lt;!-- eMail Template   eMailTemplateTWO.html --&gt;&#xD;
&lt;style type="text/css"&gt;&#xD;
&lt;!--&#xD;

#body {
	margin: 0; 
	padding: 0;
	
}

&#xD;
.tmitLogo{
	position:absolute;
	top: 20px;
	left: 20px;&#xD;
	height: 150px;	
	width:200px;&#xD;
	z-index:9;
&#xD;
}&#xD;
&#xD;
.strip1 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top:0;&#xD;
	background-color: #FFF82A;&#xD;
	height: 5.2em;	&#xD;
}&#xD;
&#xD;
.strip2 {&#xD;
	width:99%;&#xD;
	position:absolute;&#xD;
	top: 5.2em;	&#xD;
	background-color: #FF9C2A;&#xD;
	height: 1.5em;&#xD;
}&#xD;

.striptail {&#xD;
	width:100%;&#xD;
	background-color: #FF9C2A;&#xD;
	height: 1em;&#xD;
}&#xD;
&#xD;


.header{
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 2em;&#xD;
	font-weight: bold;&#xD;
	color:#005064;&#xD;
	margin-top:0.3em;&#xD;
	margin-left:3em;&#xD;
}&#xD;
&#xD;
.strapline{&#xD;
	width:90%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#FFFF33;&#xD;
	margin-left:8em;&#xD;
	margin-top:-1em;&#xD;
	font-style: italic;&#xD;
}&#xD;
&#xD;
.straptail{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#005064;&#xD;
	font-style: none;&#xD;
&#xD;
}&#xD;
&#xD;
.strapinfo{&#xD;
	width:100%;&#xD;
	text-align:center;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 0.8em;&#xD;
	font-weight: bold;&#xD;
	color:#092049;&#xD;
	font-style: none;&#xD;
&#xD;
}

.indentLetter{
	margin-top: 8em;
	width: 90%;&#xD;
	text-align:left;&#xD;
	font-family: Arial, Helvetica, sans-serif;&#xD;
	font-size: 1em;&#xD;
	font-weight: normal;&#xD;
	color:#000000;&#xD;
	font-style: none;&#xD;
	margin-left:2em;	
}&#xD;
--&gt;&#xD;
&lt;/style&gt;&#xD;
&#xD;
&lt;/head&gt;&#xD;
&lt;body&gt;&#xD;
		&lt;div&gt;
					&lt;div class="strip1"&gt; &#xD;
					  	&lt;p class="header"&gt;Template Example TWO&lt;/p&gt;&#xD;
					  	&lt;p class="strapline"&gt; - for exercise 1 of chapter 'eMail with php'&lt;/p&gt;
					&lt;/div&gt;
					&lt;div class="strip2"&gt;&lt;/div&gt;&#xD;
					&lt;div class="tmitLogo"&gt;	&lt;/div&gt;
		&lt;/div&gt;
		&lt;div class="indentLetter"&gt;
		&lt;span class="fsb"&gt;&lt;/span&gt;
					
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xD;
					[%content]&#xD;
					&lt;p&gt;&amp;nbsp;&lt;/p&gt;

			
					Regards&lt;br/&gt;
					The Boss&lt;br/&gt;
					The Pie Company&lt;br/&gt;
				
					&lt;br/&gt;
		&lt;/div&gt;
		&lt;div class="striptail"&gt;&#xD;
		  &lt;p class="straptail"&gt;Leaders in Pies.&lt;/p&gt;&#xD;
		&lt;/div&gt;&#xD;
		&lt;div class="strapinfo"&gt;&#xD;
		&lt;br/&gt;&#xD;
		  A pie without sauce is a naked pie.&lt;/div&gt;
		  
&lt;/body&gt;&#xD;
&lt;/html&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... ex1 - table: tMailTemplates">
          <before>CREATE TABLE alphacrm.tMailTemplates (
ID INT NOT NULL AUTO_INCREMENT ,
description VARCHAR( 255 ) NOT NULL ,
html TEXT NOT NULL ,
PRIMARY KEY ( ID )
) </before>
          <after/>
        </leaf>
        <leaf type="insert" title="ex2 - btnEmailALL">
          <before>&lt;?php

	//		File btnEmailALL.php
	
	//		set size of image
		$imageSizeX = 85;
		$imageSizeY = 16;
		
		$image = imagecreate($imageSizeX, $imageSizeY);

	//		first instance of imagecolorallocate sets background of image.
		$background_orange = imagecolorallocate ($image, 240, 140, 50);
	
	//		now set a colour for the text
		$blue = imagecolorallocate ($image, 0, 0, 255);
	
		$textColour = $blue;
		
	//		set a path to the font
		$font_file = 'FreeSansBold.ttf';
		$font_path = '../fonts/'.$font_file;
		
	//		the text string
		$string = 'eMail ALL';

	//		path and name of image file to be saved	
		$image_file = 'btnEmailALL.png';
		$image_path = '../images/'.$image_file;
	
		$fontsize = 12;
		$textAngle = 0;
		$xOffset = 5;
		$yOffset = 14;
		
	//		create the image 
		imagettftext (	$image, $fontsize, 
							$textAngle, 
							$xOffset, $yOffset, 
							$textColour, 
							$font_path, 
							$string);
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... btnEditALL &gt; tp_co..Pe..Edit (0991)">
          <before>				// revision    0991  -  eMail ALL 
				$eMailAllLink = '&lt;a href="index.php
						?content=eMailAllLink
						&amp;companyID='.$companyID.'"&gt;
						&lt;img src="images/btnEmailAll.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
						
				echo '&lt;tr&gt;
							&lt;td colspan="5" align="right"&gt;';
				echo 
				echo 	   '&lt;/td&gt;
							&lt;td&gt;&lt;/td&gt;
						&lt;/tr&gt;	';	
				// END:  ^^^^^ revision    0991  -  eMail ALL ^^^^ 
				
				
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... &gt; switch case &gt; index.php">
          <before>				    //	revision  1294:   eMailFormAll as link in tp_companyPeopleEdit.php
				    //							opens   tp_eMailCompanyAll.php
				    case "eMailAllLink":
				        $contentFile = "includes/tp_eMailCompanyAll.php";
				        break;
 
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... tp_eMailCompanyAll">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_eMailCompanyAll.php
*
*		folder:			includes/
*
*		used in:       tp_companyPeopleEdit.php
*
*		version:    	1294   date: 2010-07-03
*
*		purpose:		   send eMail to all email addresses in selected tCompany
*
*	===========================================================================
*/


$companyID = $_POST["companyID"];
if(!isset($companyID)) {$companyID = $_GET["companyID"]; }

{	//  Get the eMail addresses of tPerson where CompanyID = $CompanyID

		$tPerson_SQLselect = "SELECT eMail ";
		$tPerson_SQLselect .= "FROM ";
		$tPerson_SQLselect .= "tPerson ";
		$tPerson_SQLselect .= "WHERE CompanyID = '".$companyID."' ";
		
		$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
		
		//		collect all addresses as BCC as we never (!!) want to send
		//		eMail addresses to other people
		$MailBCC = "";
		while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {

			$eMail = $row['eMail'];	
			if (!empty($eMail)) {
				$MailBCC .= $eMail.",";
			}

		}
		//		remove the LAST comma 
		$MailBCC = trim($MailBCC, ",");
		$MailBCCdisplayList = str_replace(",","&lt;br /&gt;",$MailBCC)."&lt;br /&gt;".str_repeat("-",15);
		
}
	
{	//  Get the SMTP server	and default FROM address				
		
$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];
if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 

				$ToMail = "noreply@training.tmit.net";
				
				$FromMail = "noreply@training.tmit.net";
				
				$subject = $_POST['subject'];
				$message = $_POST['message'];
		
				$headers =   'From: '.$FromMail."\r\n";
				$headers .=  'Reply-To: '.$FromMail."\r\n";	
				
				$headers .=  'BCC: '.$MailBCC."\r\n";			// &lt;&lt;&lt;&lt;  key step here 
												    
				$headers .=  'Content-Type: text/html'.chr(13).chr(10);
				$headers .=  'X-Mailer: PHP/' . phpversion();
				
				ini_set("SMTP",$SMTPserver);		
				$mailSent = mail($ToMail, $subject, $message, $headers);
						
				//		vvvvvvvvvvvvvvvvvvvvv  eMail SENT HERE vvvvvvvvvvvvvvvvvvvvvvvvv		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					$msg = eMailSentLog("C", $CompanyID, 1, 0, $subject, $message);
					//		&gt;&gt;   error trap here if needed ^^^^^
					
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';	
				}		
				//    ^^^^^^^^^^^^^^^^^^^^^^^   eMail Out ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
		}
		
} else {
			

		{	//		FORM to get eMail details 

				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1&gt;';
				$CompanyID_fld = '&lt;input type="hidden" name="companyID" value='.$companyID.'&gt;';	
				
				$subject_fld = '&lt;input type="text" name="subject" size="43"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="index.php?content=eMailAllLink"&gt;';
						echo $sendWasClicked_fld;
						echo $CompanyID_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td valign="top"&gt;To:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$MailBCCdisplayList.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$FromMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Message&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
		//		END: FORM to get eMail details			
		} 
		
} 

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$companyID.'"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="ex 3 - btnEmail.php ">
          <before>&lt;?php

	//		File btnEmail.php
	
	//		set size of image
		$imageSizeX = 50;
		$imageSizeY = 16;
		
		$image = imagecreate($imageSizeX, $imageSizeY);

	//		first instance of imagecolorallocate sets background of image.
		$background_orange = imagecolorallocate ($image, 240, 140, 50);
	
	//		now set a colour for the text
		$blue = imagecolorallocate ($image, 0, 0, 255);
	
		$textColour = $blue;
		
	//		set a path to the font
		$font_file = 'FreeSans.ttf';
		$font_path = '../fonts/'.$font_file;
		
	//		the text string
		$string = 'eMail';

	//		path and name of image file to be saved	
		$image_file = 'btnEmail.png';
		$image_path = '../images/'.$image_file;
	
		$fontsize = 12;
		$textAngle = 0;
		$xOffset = 5;
		$yOffset = 14;
		
	//		create the image 
		imagettftext (	$image, $fontsize, 
							$textAngle, 
							$xOffset, $yOffset, 
							$textColour, 
							$font_path, 
							$string);
	
	//		save the image (MAKE SURE PERMISSIONS of the target directory are set to 'WRITE')
		if (imagepng ( $image, $image_path)) {
			chmod($image_path, 0666);			//		used for commercial grade systems 		
			echo 'The image is "'.$image_path.'"&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;';	
			echo '&lt;img src="'.$image_path.'" alt="Test Image from GD Library" /&gt;';
		} else {
			echo "Failed to create image.";
		}

	//		release the memory used by the image 
		imagedestroy($image);
	
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... &gt; ..... btnEmail &gt; tp_co..Pe..Edit">
          <before>				
				//	revision 1291:    convert eMail link to button
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;
						&lt;img src="images/btnEmail.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1291:                 $eMailFormLink

</before>
          <after/>
        </leaf>
      </branch>
      <branch title="Notes in tPerson">
        <leaf type="insert" title="SQL">
          <before>ALTER TABLE `tPerson` ADD `notes` TEXT NOT NULL </before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1302   date: 2010-07-03
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*							personSuspend - make records as suspended
*
*		revisions  
*						1010 validates eMail addresses
*						1301 suspendRecord($tableName ,$recordID)
*						1302 restoreRecord($tableName ,$recordID)
*						1303 add fld notes to personUpdate
*
*	===========================================================================
*/		
	function restoreRecord($tableName ,$recordID) {

			$delUserID = $_COOKIE["userID"];
			$delTime = date("Y-m-d H:i:s",strtotime("now"));

			$suspend_SQL = "UPDATE ".$tableName." SET ";			
			$suspend_SQL .=  "delUserID = NULL , "; 		
			$suspend_SQL .=  "delTime = 0 ";

			$suspend_SQL .=  "WHERE ID = '".$recordID."' "; 	
		
			if (mysql_query($suspend_SQL))  {
				$errorMsg = "Record Restored.";							
			} else {
				$errorMsg =  dataError("FAILED to restore record.");
			}
			
			return $errorMsg;
					
	}

	function suspendRecord($tableName ,$recordID) {

			$delUserID = $_COOKIE["userID"];
			$delTime = date("Y-m-d H:i:s",strtotime("now"));

			$suspend_SQL = "UPDATE ".$tableName." SET ";			
			$suspend_SQL .=  "delUserID = '".$delUserID."', "; 		
			$suspend_SQL .=  "delTime = '".$delTime."' ";

			$suspend_SQL .=  "WHERE ID = '".$recordID."' "; 	
		
			if (mysql_query($suspend_SQL))  {
				$errorMsg = "Record Deleted.";							
			} else {
				$errorMsg =  dataError("FAILED to delete record.");
			}
			
			return $errorMsg;
					
	}
	
	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		//		revision:    1010

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

			if (!empty($eMail)) {
				if (!check_email($eMail)) { 
					$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
				} else {
					if (!check_email_mx($eMail)) { 
						$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
					}
				}
			}				
		}

		if (empty($errorMsg)) {
			$tPerson_SQLinsert = "INSERT INTO tPerson (";			
			$tPerson_SQLinsert .=  "Salutation, ";
			$tPerson_SQLinsert .=  "FirstName, ";
			$tPerson_SQLinsert .=  "LastName, ";
			$tPerson_SQLinsert .=  "Tel, ";	
			$tPerson_SQLinsert .=  "eMail, ";		
			$tPerson_SQLinsert .=  "companyID ";
			$tPerson_SQLinsert .=  ") ";
			
			$tPerson_SQLinsert .=  "VALUES (";
			$tPerson_SQLinsert .=  "'".$Salutation."', ";
			$tPerson_SQLinsert .=  "'".$FirstName."', ";
			$tPerson_SQLinsert .=  "'".$LastName."', ";
			$tPerson_SQLinsert .=  "'".$Tel."', ";	
			$tPerson_SQLinsert .=  "'".$eMail."', ";		
			$tPerson_SQLinsert .=  "'".$companyID."' ";
			$tPerson_SQLinsert .=  ") ";
	

			if (!mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = dataError("FAILED to add new person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $notes, $companyID) {


		if (empty($LastName)) { $errorMsg = "Cannot add person with no Lastname.&lt;br /&gt;"; }

		if (!empty($eMail)) {
			if (!check_email($eMail)) { 
				$errorMsg = "Invalid eMail address format.&lt;br /&gt;";
			} else {
				if (!check_email_mx($eMail)) { 
					$errorMsg = "No MX server detected for that eMail address.&lt;br /&gt;";
				}
			}
		}				

		if (empty($errorMsg)) {
		
			$tPerson_SQLupdate = "UPDATE tPerson SET ";			
			$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
			
			$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
			$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
			$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
			$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
			$tPerson_SQLupdate .=  "eMail = '".$eMail."', ";
			$tPerson_SQLupdate .=  "notes = '".$notes."' ";
			$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
		
			if (!mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = dataError("FAILED to update person.");
			}
		
		} 	else {
			$errorMsg = dataError($errorMsg)."&lt;br /&gt;";
		}
			
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_personEditForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personEditForm.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	1303   date: 2010-07-05
*
*		purpose:			1302 - add notes field
*							
*
*	===========================================================================
*/		

		{	//		Get the details of the person selected 
			$personID = $_GET["personID"];	
					
			$tPerson_SQLselect = "SELECT * ";
			$tPerson_SQLselect .= "FROM ";
			$tPerson_SQLselect .= "tPerson ";
			$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
			
			$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
			
			while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
				$current_Salutation = $row['Salutation'];
				$current_FirstName = $row['FirstName'];
				$current_LastName = $row['LastName'];
				$current_Tel = $row['Tel'];
				$current_eMail = $row['eMail'];
				$current_notes = $row['notes'];				//			&lt;&lt;&lt;&lt;&lt;   1302
				
				$companyID = $row['CompanyID'];

				 
			}
			
		//  END: Get the details of the person selected 
		}

		{	//		Create form fields 
			$fld_personID = '&lt;input type="hidden" name="personID" value="'.$personID.'"/&gt;';
			$fld_personEdited = '&lt;input type="hidden" name="personEdited" value="1"/&gt;';
	
			$fld_FirstName = '&lt;input type="text" name="FirstName" value="'.$current_FirstName.'"/&gt;';
			$fld_LastName = '&lt;input type="text" name="LastName" value="'.$current_LastName.'"/&gt;';
			$fld_Tel = '&lt;input type="text" name="Tel" value="'.$current_Tel.'"/&gt;';
			$fld_eMail = '&lt;input type="text" name="eMail" value="'.$current_eMail.'"/&gt;';

			$fld_notes = '&lt;textarea name="notes" rows="9" cols="50" &gt;';
			$fld_notes .= $current_notes;
			$fld_notes .= '&lt;/textarea&gt;';									//			&lt;&lt;&lt;&lt;&lt;   1302

		//  END: Create form fields 
		}

		{	//	create the Company DROPDOWN  FIELD 
			$companyList_SQL =  "SELECT ID, prename, Name, RegType FROM tCompany ";
			$companyList_SQL .= "ORDER By Name ";
			
			$companyList_SQL_Query = mysql_query($companyList_SQL);	

			$fld_companyID = '&lt;select name="companyID"&gt;';
	 	
				while ($row = mysql_fetch_array($companyList_SQL_Query, MYSQL_ASSOC)) {
				    $dd_companyID = $row['ID'];
				    $dd_preName = $row['preName'];
				    $dd_companyName = $row['Name'];
				    $dd_RegType = $row['RegType'];
				    
				    $fullCoyName = trim($dd_preName." ".$dd_companyName." ".$dd_RegType);
				    
				    if ($dd_companyID == $companyID) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_companyID .= '&lt;option value="'.$dd_companyID.'"';
				    $fld_companyID .= $selectedFlag.'&gt;'.$fullCoyName.'&lt;/option&gt;';
				}
			
				mysql_free_result($companyList_SQL_Query);		
	
			$fld_companyID .= '&lt;/select&gt;';
			
		//	END: create the Company DROPDOWN  FIELD 
		}	
		{	//	create the Selection DROPDOWN  FIELD 
			$salut_SQL =  "SELECT lookupValue FROM tLookup ";
			$salut_SQL .= "WHERE lookupType = 'Salutation' ";
			$salut_SQL .= "ORDER By lookupOrder ";
			
			$salut_SQL_Query = mysql_query($salut_SQL);	

			$fld_Salutation = '&lt;select name="Salutation"&gt;';
	 	
				while ($row = mysql_fetch_array($salut_SQL_Query, MYSQL_ASSOC)) {
				    $salutValue = $row['lookupValue'];
				    if ($current_Salutation == $salutValue) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_Salutation .= '&lt;option'.$selectedFlag.'&gt;'.$salutValue.'&lt;/option&gt;';
				}
			
				mysql_free_result($salut_SQL_Query);		
	
			$fld_Salutation .= '&lt;/select&gt;';
			
		//	END: create the Selection DROPDOWN  FIELD 
		}	
		{	//	render the FORM 

			$saveButton = '&lt;input type="submit"  value="Save" /&gt;';
			
			echo '&lt;form name="postPerson" action="index.php?content=companyPeopleEdit" method="post"&gt;';
			echo $fld_personEdited;
				echo $fld_personID;
				echo $fld_saveClicked;
	
	
			$innerTable = '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;Salutation&lt;/td&gt;
						&lt;td&gt;'.$fld_Salutation.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;First Name&lt;/td&gt;
						&lt;td&gt;'.$fld_FirstName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Last Name&lt;/td&gt;
						&lt;td&gt;'.$fld_LastName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Telephone&lt;/td&gt;
						&lt;td&gt;'.$fld_Tel.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;tr&gt;
						&lt;td&gt;eMail&lt;/td&gt;
						&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;td&gt;Company&lt;/td&gt;&#xD;
						&lt;td&gt;'.$fld_companyID.'&lt;/td&gt;&#xD;
					&lt;/tr&gt;			
				&lt;/table&gt;
				';	
		
				echo '&lt;table&gt;';
					echo '&lt;tr valign="top"&gt;';
						echo '&lt;td&gt;'.$innerTable.'&lt;/td&gt;';
						echo '&lt;td&gt;Notes:&lt;br /&gt;'.$fld_notes.'&lt;/td&gt;';
					echo '&lt;/tr&gt;';
					echo '&lt;tr&gt;';
						echo '&lt;td&gt;&lt;/td&gt;';
						echo '&lt;td align="right"&gt;'.$saveButton.'&lt;/td&gt;';
					echo '&lt;/tr&gt;';
				echo '&lt;/table&gt;';	
					
					

					
			echo '&lt;/form&gt;';
		//		END: render the FORM 
		}

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$companyID.'"&gt;Back to Company/People List&lt;/a&gt;';
echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. fn &gt; tp_companyPeopleEdit.php">
          <before>				$notes = $_POST["notes"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, 
													$Tel, $eMail, $notes, $companyID);			//	&lt;&lt;&lt; 1302
													
</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="snapshots">
      <leaf type="insert" title="11_END_tp_companyPeopleEdit.php">
        <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($insertMsg)) {
					echo $insertMsg;
				}
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
	
					//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';
									
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['eMail'].'&amp;nbsp;&lt;/td&gt;';

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="1205_end_tp_companyPeopleEdit.php">
        <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*							1202 - add email opened by clicking eMail address 
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];

				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';

				//	revision 1202:                 $eMailFormLink
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;eMail&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1202:                 $eMailFormLink

					
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$eMailFormLink.'&amp;nbsp;&lt;/td&gt;';	//	revision 1202

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="1299_end_tp_companyPeopleEdit.php">
        <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*		revision:		1191 - add edit button 
*							1204 - add email opened by clicking eMail address 
*							1291 - (email ex 2)  add row email all &gt; p_eMailCompanyAll.php
*							1292 - (email ex 3)  convert link to a button
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE CompanyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];

				//	revision   1191  - add edit button 
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;
					&lt;img src="images/btnEdit.png" border="0" alt="edit button" /&gt;
					&lt;/a&gt;';

				
				//	revision 1291:    convert eMail link to button
					if (!empty($personArray[$indx]['eMail'])) {
						$eMailFormLink = '&lt;a href="index.php
						?content=eMailFormLink
						&amp;personID='.$thisPersonID.'"&gt;
						&lt;img src="images/btnEmail.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
					} else {
						$eMailFormLink = '';
					}
				//	END:  	revision 1291:                 $eMailFormLink

					
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$eMailFormLink.'&amp;nbsp;&lt;/td&gt;';	//	revision 1202

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
				
				// revision    0991  -  eMail ALL 
				$eMailAllLink = '&lt;a href="index.php
						?content=eMailAllLink
						&amp;companyID='.$companyID.'"&gt;
						&lt;img src="images/btnEmailAll.png" border="0" alt="eMail button" /&gt;
						&lt;/a&gt;';
						
				echo '&lt;tr&gt;
							&lt;td colspan="5" align="right"&gt;';
				echo $eMailAllLink;
				echo 	   '&lt;/td&gt;
							&lt;td&gt;&lt;/td&gt;
						&lt;/tr&gt;	';	
				// END:  ^^^^^ revision    0991  -  eMail ALL ^^^^ 
				
								
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="1204_tp_eMailForm.php">
        <before>&lt;?php

/*		INCLUDE FILE:   tp_eMailForm.php
*
*		folder:			includes/
*
*		used in:       tp_companyPeopleEdit.php
*
*		version:    	1202   date: 2010-07-03
*
*		purpose:		   send eMail to email address in tPerson
*
*	===========================================================================
*/


$personID = $_POST["personID"];
if(!isset($personID)) {$personID = $_GET["personID"]; }

{	//  Get the details of tPerson where ID = $personID

		$tPerson_SQLselect = "SELECT * ";
		$tPerson_SQLselect .= "FROM ";
		$tPerson_SQLselect .= "tPerson ";
		$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
		
		$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
		
		while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {

			$Salutation = $row['Salutation'];
			$FirstName = $row['FirstName'];
			$LastName = $row['LastName'];
			$Tel = $row['Tel'];
			$eMail = $row['eMail'];	
			$CompanyID = $row['CompanyID'];	
		}
}
	
{	//  Get the SMTP server	and default FROM address	
		$tLookup_SQLselect = "SELECT * ";
		$tLookup_SQLselect .= "FROM tLookup ";
		$tLookup_SQLselect .= "WHERE lookupType LIKE 'eMail_%' ";
		
		$tLookup_SQLselect_Query = mysql_query($tLookup_SQLselect);	
		
		while ($row = mysql_fetch_array($tLookup_SQLselect_Query, MYSQL_ASSOC)) {
			if ($row['lookupType'] == "eMail_server") { 
				$SMTPserver= $row['lookupValue'];
			}		
			if ($row['lookupType'] == "eMail_fromAddress") { 
				$FromMail= $row['lookupValue'];
			}				 
		}
}			
		
$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];
if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 

				$ToMail = $POST['eMail'];
				
				$FromMail = $_POST['FromMail'];
				
				$subject = $_POST['subject'];
				$message = $_POST['message'];
		
				$headers =   'From: '.$FromMail."\r\n" .
							    'Reply-To: '.$FromMail."\r\n" .
							    'X-Mailer: PHP/' . phpversion();
				
				ini_set("SMTP",$SMTPserver);		
				$mailSent = mail($ToMail, $subject, $message, $headers);
						
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';	
					$backLink = 'index.php?content=eMailFormLink&amp;personID='.$personID;
					echo '&lt;a href="'.$backLink.'"&gt;try again...&lt;/a&gt;';		
				}		
		}
		
} else {
			

		{	//		FORM to get eMail details 

				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1&gt;';
				$personID_fld = '&lt;input type="hidden" name="personID" value='.$personID.'&gt;';	
				
				$subject_fld = '&lt;input type="text" name="subject" size="43"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="index.php?content=eMailFormLink"&gt;';
						echo $sendWasClicked_fld;
						echo $personID_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$eMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$FromMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Message&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
		//		END: FORM to get eMail details			
		} 
		
} 

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$CompanyID.'"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="12_end_tp_eMailForm.php">
        <before>&lt;?php

/*		INCLUDE FILE:   tp_eMailForm.php
*
*		folder:			includes/
*
*		used in:       tp_companyPeopleEdit.php
*
*		version:    	1202   date: 2010-07-03
*
*		purpose:		   send eMail to email address in tPerson
*
*	===========================================================================
*/


$personID = $_POST["personID"];
if(!isset($personID)) {$personID = $_GET["personID"]; }

{	//  Get the details of tPerson where ID = $personID

		$tPerson_SQLselect = "SELECT * ";
		$tPerson_SQLselect .= "FROM ";
		$tPerson_SQLselect .= "tPerson ";
		$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
		
		$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
		
		while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {

			$Salutation = $row['Salutation'];
			$FirstName = $row['FirstName'];
			$LastName = $row['LastName'];
			$Tel = $row['Tel'];
			$eMail = $row['eMail'];					
			$CompanyID = $row['CompanyID'];	
		}
}
	
{	//  Get the SMTP server	and default FROM address	
		$tLookup_SQLselect = "SELECT * ";
		$tLookup_SQLselect .= "FROM tLookup ";
		$tLookup_SQLselect .= "WHERE lookupType LIKE 'eMail_%' ";
		
		$tLookup_SQLselect_Query = mysql_query($tLookup_SQLselect);	
		
		while ($row = mysql_fetch_array($tLookup_SQLselect_Query, MYSQL_ASSOC)) {
			if ($row['lookupType'] == "eMail_server") { 
				$SMTPserver= $row['lookupValue'];
			}		
			if ($row['lookupType'] == "eMail_fromAddress") { 
				$FromMail= $row['lookupValue'];
			}				 
		}
}			
		
$sendWasClicked = 0;
$sendWasClicked = $_POST['sendWasClicked'];
if (isset($sendWasClicked) AND $sendWasClicked == 1) {
	
		{	//		if $sendWasClicked 

				$ToMail = $POST['eMail'];
				
				$FromMail = $_POST['FromMail'];
				
				$subject = $_POST['subject'];
				$message = $_POST['message'];
		
				$headers =   'From: '.$FromMail."\r\n" .
							    'Reply-To: '.$FromMail."\r\n" .
							    'X-Mailer: PHP/' . phpversion();
				
				ini_set("SMTP",$SMTPserver);		
				$mailSent = mail($ToMail, $subject, $message, $headers);

			//		vvvvvvvvvvvvvvvvvvvvv  eMail SENT HERE vvvvvvvvvvvvvvvvvvvvvvvvv		
				if ($mailSent) {
					echo 'Mail SENT.&lt;br /&gt;&lt;br /&gt;';
					$msg = eMailSentLog("P", $personID, 1, 0, $subject, $message);
					//		&gt;&gt;   error trap here if needed ^^^^^
					
				} else {
					echo 'Mail FAILED.&lt;br /&gt;&lt;br /&gt;';	
					$backLink = 'index.php?content=eMailFormLink&amp;personID='.$personID;
					echo '&lt;a href="'.$backLink.'"&gt;try again...&lt;/a&gt;';		
				}		
				//    ^^^^^^^^^^^^^^^^^^^^^^^   eMail Out ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
	
		}
		
} else {
			

		{	//		FORM to get eMail details 

				$sendWasClicked_fld = '&lt;input type="hidden" name="sendWasClicked" value=1&gt;';
				$personID_fld = '&lt;input type="hidden" name="personID" value='.$personID.'&gt;';	
				
				$subject_fld = '&lt;input type="text" name="subject" size="43"/&gt;';
				$message_fld = '&lt;textarea name="message" cols="50" rows="10"&gt;&lt;/textarea&gt;';
		
				$submit_fld = '&lt;input type="submit" value="Send"/&gt;';
						
				echo '&lt;form method="post" action="index.php?content=eMailFormLink"&gt;';
						echo $sendWasClicked_fld;
						echo $personID_fld;
						echo '&lt;table&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;To:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$eMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;From:&lt;/td&gt;';
							echo '&lt;td class="textEmph"&gt;'.$FromMail.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
		
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Subject&lt;/td&gt;';
							echo '&lt;td&gt;'.$subject_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;Message&lt;/td&gt;';
							echo '&lt;td&gt;'.$message_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
						echo '&lt;tr&gt;';
							echo '&lt;td&gt;&lt;/td&gt;';
							echo '&lt;td align="right"&gt;'.$submit_fld.'&lt;/td&gt;';
						echo '&lt;/tr&gt;';
				
						echo '&lt;/table&gt;		';
				echo '&lt;/form&gt;';
				
		//		END: FORM to get eMail details			
		} 
		
} 

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$CompanyID.'"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="12_END_index">
        <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/

	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');
		include_once('includes/fn_strings.php');
		include_once('includes/fn_formatting.php');
		include_once('includes/fn_eMailLog.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
						
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  DO SOMETHING depending on the $contentCode.  
				//		update code:   0905 Content management 
				switch ($contentCode) {
				    case "companyList":
				        $contentFile = "includes/tp_companyList.php";
				        break;
				    case "insertCompany":
				        $contentFile = "includes/tp_companyInsert.php";
				        break;
				    case "editCompany":
				        $contentFile = "includes/tp_companyEditForm.php";
				        break;
				    case "insertUser":					
 				        $contentFile = "includes/tp_userInsert.php";
				        break;
				    case "companyPeopleEdit":						
 				         $contentFile = "includes/tp_companyPeopleEdit.php";
				        break;
				    case "personEditForm":
				        $contentFile = "includes/tp_personEditForm.php";
				        break;
				        
				    //	revision  1202:   eMailForm as link in tp_companyPeopleEdit.php
				    //							opens   tp_eMailForm.php
				    case "eMailFormLink":
				        $contentFile = "includes/tp_eMailForm.php";
				        break;
 
				    //	revision  1294:   eMailFormAll as link in tp_companyPeopleEdit.php
				    //							opens   tp_eMailCompanyAll.php
				    case "eMailAllLink":
				        $contentFile = "includes/tp_eMailCompanyAll.php";
				        break;
 
     
				        
				}							
			}
		
		} else {
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
						
		}

	} else {
			$contentMsg = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;


&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
&lt;/head&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;
  
			 &lt;div id="header"&gt;
		    	&lt;p class="todGreeting"&gt;
			    	&lt;?php 
		    			if ($loginAuthorised) { 
			    			echo todGreeting();
		    			} 
			    	?&gt;
		    	&lt;/p&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;				
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php if (file_exists($menuFile)) { include($menuFile); } 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;?php 
      					if (file_exists($contentFile)) { include($contentFile); } 
		      			if (!empty($contentMsg)) {
		      				echo $contentMsg;
		      			}
      			?&gt;
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
			 &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;



&lt;/body&gt;
&lt;/html&gt;</before>
        <after/>
      </leaf>
      <leaf type="insert" title="1303_01_dbClasses.php">
        <before>&lt;?php

/*		THIS IS INCLUDE FILE:   dbClasses.php
*
*		folder:			classes/
*
*		used in:       index.php
*
*		version:    	1303   date: 2010-07-06
*
*		classes:			DBconnection	-		connect to and select DB 
*
*
*	=================================================================
*/		

class DBconnection{

		//	public properties
			public $errorMsg;
			public $errorCode;

		//	public methods
			public function __construct($hostname, $username, $password, $database) {
				$this-&gt;connection = @mysql_connect($hostname,$username,$password);
				
				if (!$this-&gt;connection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					return false;
				}

				$this-&gt;selection = @mysql_select_db($database,$this-&gt;connection);
	
				if (!$this-&gt;selection) {
					$this-&gt;errorMsg  = mysql_error();
					$this-&gt;errorCode  = mysql_errno();
					@mysql_close($this-&gt;connection);
					return false;
				}
				echo "THIS CONNECTION: ".$this-&gt;connection."&lt;br /&gt;&lt;br /&gt;";
			}			
			public function getConnectionID() {
				return $this-&gt;connection;	
			}
													
//	END:  		class DBconnection	
}			

	

?&gt;
</before>
        <after/>
      </leaf>
    </branch>
  </branch>
</snippets>
