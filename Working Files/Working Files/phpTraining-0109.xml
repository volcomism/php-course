<?xml version="1.0"?>
<snippets>
  <branch title="phpTraining-0109">
    <branch title="project">
      <branch title="index">
        <leaf type="insert" title="index.php 0901_01">
          <before>&lt;?php

	//		php processing here
	//			BEFORE any rendering
	
?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;!-- HTML Headers and Links to CSS --&gt;

&lt;/head&gt;
&lt;body&gt;

	&lt;!-- HTML or php rendering here --&gt;
	&lt;?php
		// can contain most php code - except header()function
	?&gt;


&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + docs, connection &amp; trap">
          <before>
/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {

	} else {
			$contentText = 'No database connection.';
	}	

</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + HTML headers">
          <before>	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-26T15:23:42+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + HTML layout ">
          <before>  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;header&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
        			&lt;p&gt;content&lt;/p&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;footer&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. header">
          <before>		      &lt;p&gt;alpha CRM application&lt;/p&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. footer">
          <before>		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
	</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. include($menuFile)">
          <before>      			&lt;br /&gt;
      			&lt;?php      				
      				if (file_exists($menuFile)) {include($menuFile);} 
      			?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title=".. include($contentFile)">
          <before>      			&lt;br /&gt;
      			&lt;?php       				
      				if (file_exists($contentFile)) {include($contentFile);} 
      			?&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="if ($dbSuccess - step 1">
          <before>
		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
				
			$contentFile = 'includes/tp_loginForm.php';
		
		}
		</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + test POSTed login">
          <before>			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + include fn_authorise.php">
          <before>		include_once('includes/fn_authorise.php');
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + if ($loginAuthorised ...">
          <before>			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  DO SOMETHING depending on the $contentCode.   eg
				
				$contentMsg = $contentCode;

			}
		
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="content Column - update">
          <before>  	      			
						if (!empty($contentMsg)) { echo $contentMsg; }
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="switch 0905">
          <before>				//  SWITCH processing on $contentCode.  
				//		update code:   0905 Content management 
				switch ($contentCode) {
				    case "companyList":
				        $contentMsg = $contentCode;
				        break;
				    case "insertCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "editCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "insertUser":
				        $contentMsg = $contentCode;
				        break;
				}			
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + tp_companyList">
          <before>				        $contentFile = "includes/tp_companyList.php";
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + tp_companyPeopleEdit">
          <before>				    case "companyPeopleEdit":						
 				         $contentFile = "includes/tp_companyPeopleEdit.php";
				        break;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + tp_personEditForm">
          <before>				    case "personEditForm":
				        $contentFile = "includes/tp_personEditForm.php";
				        break;
</before>
          <after/>
        </leaf>
      </branch>
      <branch title="includes (tp or fn)">
        <leaf type="insert" title="tp_crmMenu.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_crmMenu.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:		MENU for the TEMPLATE version of alpha CRM
*
*	===========================================================================
*/		
	//	List Companies 
	echo '&lt;a href="index.php?content=companyList"&gt;
			&lt;span class="mainMenuItem"&gt;List Companies&lt;/span&gt;
			&lt;/a&gt;';
	echo '&lt;br /&gt;&lt;br /&gt;';

	//	Restricted - Editor Only menu items
	if (isset($accessLevel) AND $accessLevel &gt;= 21) {
	
		echo '&lt;a href="index.php?content=insertCompany"&gt;
				&lt;span class="mainMenuItem"&gt;Create Company&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';

		echo '&lt;a href="index.php?content=editCompany"&gt;
				&lt;span class="mainMenuItem"&gt;Edit company&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';
		
	}

	//	Restricted - Admin Only menu items
	if (isset($accessLevel) AND $accessLevel &gt;= 99) {	
		echo '&lt;a href="index.php?content=insertUser"&gt;
				&lt;span class="mainMenuItem"&gt;create NEW USER&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';
	}

	//	Logout menu item 
	echo '&lt;a href="index.php?status=logout"&gt;
			&lt;span class="mainMenuItem"&gt;Logout&lt;/span&gt;
			&lt;/a&gt;';
	echo '&lt;br /&gt;&lt;br /&gt;';


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_loginForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_loginForm.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:		login FORM for teh TEMPLATE version of alpha CRM
*
*	===========================================================================
*/


		echo '&lt;p&gt;Login Form alphaCRM&lt;/p&gt;';

		echo '&lt;form name="postLoginHid" action="index.php" method="post"&gt;';	
				echo '
					&lt;P&gt;User name: 
					&lt;INPUT TYPE=text NAME=username value="" SIZE=12 MAXLENGTH=16&gt;&lt;/P&gt;
					&lt;P&gt;Password: 
					&lt;INPUT TYPE=password NAME=password value="" SIZE=12 MAXLENGTH=16&gt;&lt;/P&gt;
					&lt;input type="submit"  value="Login" /&gt;
				';
		echo '&lt;/form&gt;';
	

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_authorise.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_authorise.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:		test $username, $password for authorisation
*
*	===========================================================================
*/		

	function userAuthorised($username, $password) {

			$md5Password = md5($password);
			$tUser_SQLselect = "SELECT ID, password, accessLevel FROM tUser ";
			$tUser_SQLselect .= "WHERE username = '".$username."' ";	

			$tUser_SQLselect_Query = mysql_query($tUser_SQLselect); 	
			while ($row = mysql_fetch_array($tUser_SQLselect_Query, MYSQL_ASSOC)) {
			    $userID = $row['ID'];
			    $passwordRetrieved = $row['password'];
			    $accessLevel = $row['accessLevel'];
			}
		
			mysql_free_result($tUser_SQLselect_Query);
						
			if (!empty($passwordRetrieved) AND ($md5Password == $passwordRetrieved)) {
	
					setcookie("accessLevel", $accessLevel, time()+7200, "/");	
					setcookie("userID", $userID, time()+7200, "/");	
					setcookie("loginAuthorised", "loginAuthorised", time()+7200, "/");
					
					$returnCode = true;
					
					$sessionLogged = insertLogin($userID);
					if (!$sessionLogged) {
						setcookie("sessionLogging", "failed", time()+300, "/");
					}				
			} else {
				$returnCode = false;			
			}
			
		return $returnCode;
	}


	function insertLogin($userID) {
		$success = false;
		//	Get current date-time in MySQL format
		$nowTimeStamp = date("Y-m-d H:i:s");
		//	Get user's IP address
		$userIP = $_SERVER['REMOTE_ADDR'];
	
		$insertLogin_SQL = 'INSERT INTO tAccessLog (
										userID, 
										timeLogin, 
										IPaddress
									) VALUES (
										'.$userID.',
										"'.$nowTimeStamp.'",
										"'.$userIP.'"
									)';
									
			if (mysql_query($insertLogin_SQL))  {	
				$success = true;
			} else {
				$success = $insertLogin_SQL."&lt;br /&gt;".mysql_error();		
			}	
			
		return $success;	
	}



?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_companyList.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyList.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list companies from table tCompany
*
*	===========================================================================
*/		

//include_once('../includes/stringFunctions.php');
// ^^^^     include this in index.php 
 
//	external style sheet 
//echo '&lt;link rel="stylesheet" href="../css/alphacrm.css" type="text/css" /&gt;';
//  ^^^^  delete

//$thisScriptName = 'companyListOrder.php';
$thisScriptName = 'index.php?content=companyList';

//		Get the sortorder with GET but default to Name
$orderClause = $_GET["orderClause"];	
if (!isset($orderClause)) {$orderClause = "Name"; }

{	//		SELECT all companies in Name order and execute 
	$tCompany_SQLselect = "SELECT * ";
	$tCompany_SQLselect .= "FROM ";
	$tCompany_SQLselect .= "tCompany ";	
	$tCompany_SQLselect .= "ORDER BY ";
	$tCompany_SQLselect .= "tCompany.".$orderClause;

	$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect); 	

}

{	//		Output 

//		make each header a link to $thisScriptName and ADD the  querystring for orderclause 
$header_ID = '&lt;a href="'.$thisScriptName.'&amp;orderClause=ID"&gt;&lt;span class="tableHeader"&gt;ID&lt;/span&gt;&lt;/a&gt;';
$header_Name = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Name"&gt;&lt;span class="tableHeader"&gt;Company&lt;/span&gt;&lt;/a&gt;';
$header_Town = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Town"&gt;&lt;span class="tableHeader"&gt;Town&lt;/span&gt;&lt;/a&gt;';
$header_County = '&lt;a href="'.$thisScriptName.'&amp;orderClause=County"&gt;&lt;span class="tableHeader"&gt;County&lt;/span&gt;&lt;/a&gt;';
$header_Postcode = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Postcode"&gt;&lt;span class="tableHeader"&gt;Postcode&lt;/span&gt;&lt;/a&gt;';
$header_COUNTRY = '&lt;a href="'.$thisScriptName.'&amp;orderClause=COUNTRY"&gt;&lt;span class="tableHeader"&gt;COUNTRY&lt;/span&gt;&lt;/a&gt;';

//{	//		create a div for the whole rendering 
//echo '&lt;div class="textNormal"&gt;';

	echo '&lt;h2&gt;Company List&lt;/h2&gt;';
				
	echo '&lt;table border="1"&gt;';	
		echo '&lt;tr class="tableHeader" height="40px"&gt;';		
			echo '&lt;td&gt;'.$header_ID.'&lt;/td&gt;';
			echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Name.'&lt;/td&gt;';
			echo '&lt;td&gt;Address&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Town.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_County.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Postcode.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_COUNTRY.'&lt;/td&gt;';

		echo '&lt;/tr&gt;';

		$indx = 0;		//		count the rows to give alternating style 
		while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
			
			$ID = $row['ID'];
			$preName = $row['preName'];
			$CompanyName = $row['Name'];
			$regType = $row['RegType'];				
			
             $CompanyFullName = shortCoName($CompanyName, $regType);

			$StreetA = $row['StreetA'];
			$StreetB = $row['StreetB'];
			$StreetC = $row['StreetC'];			        

             $CompanyAddress = coAddress($StreetA, $StreetB, $StreetC);
				
		   $Town = $row['Town'];
		   $County = $row['County'];
		   $Postcode = $row['Postcode'];
		   $COUNTRY = $row['COUNTRY'];
	
			//		Link to companyPeopleEdit.php?companyID=$ID
			//    $linkToList = '&lt;a href="companyPeopleEdit.php?companyID='.$ID.'"&gt;'.$ID.'&lt;/a&gt;';
			//	Link to index.php?content=companyPeopleEdit
			$linkToList = '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$ID.'"&gt;'.$ID.'&lt;/a&gt;';
			
			//		Set row style
			if (($indx % 2) == 1) {$rowClass = 'class="trOdd"'; } else { $rowClass = 'class="trEven"'; }
			echo '&lt;tr '.$rowClass.'&gt;';
			
				echo '&lt;td&gt;'.$linkToList.'&amp;nbsp;&lt;/td&gt;'; 
				echo '&lt;td&gt;'.$preName.'&amp;nbsp;&lt;/td&gt;'; 
				echo '&lt;td&gt;'.$CompanyFullName.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$CompanyAddress.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Town.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$County.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Postcode.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$COUNTRY.'&amp;nbsp;&lt;/td&gt;';
		
			echo '&lt;/tr&gt;';
	  
	  		$indx++;
	   //	END: while
		}

	echo '&lt;/table&gt;';	
	echo ' &amp;nbsp;&amp;nbsp;^ click ID to edit record';

//echo '&lt;/div&gt;';
//		END: create a div for the whole rendering 
//}

}	//		END: //		Output 

//mysql_free_result($tCompany_SQLselect_Query);	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_companyPeopleEdit.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($insertMsg)) {
					echo $insertMsg;
				}
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
					
				//	$personEditLink = '&lt;a href="personEditForm.php?personID='.$thisID.'"&gt;Edit&lt;/a&gt;';
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;Edit&lt;/a&gt;';
					
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['eMail'].'&amp;nbsp;&lt;/td&gt;';

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*
*	===========================================================================
*/		

	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {

		$tPerson_SQLinsert = "INSERT INTO tPerson (";			
		$tPerson_SQLinsert .=  "Salutation, ";
		$tPerson_SQLinsert .=  "FirstName, ";
		$tPerson_SQLinsert .=  "LastName, ";
		$tPerson_SQLinsert .=  "Tel, ";	
		$tPerson_SQLinsert .=  "eMail, ";	
		$tPerson_SQLinsert .=  "companyID ";
		$tPerson_SQLinsert .=  ") ";
		
		$tPerson_SQLinsert .=  "VALUES (";
		$tPerson_SQLinsert .=  "'".$Salutation."', ";
		$tPerson_SQLinsert .=  "'".$FirstName."', ";
		$tPerson_SQLinsert .=  "'".$LastName."', ";
		$tPerson_SQLinsert .=  "'".$Tel."', ";	
		$tPerson_SQLinsert .=  "'".$eMail."', ";	
		$tPerson_SQLinsert .=  "'".$companyID."' ";
		$tPerson_SQLinsert .=  ") ";

		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new person.";
			}
		} else {
			$errorMsg = "Cannot add person with no Lastname.";
		}		
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		$tPerson_SQLupdate = "UPDATE tPerson SET ";			
		$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
		
		$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
		$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
		$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
		$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
		$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
		$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
	
		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update person.";
			}
		} else {
			$errorMsg = "Cannot make Lastname empty.";
		}		
		
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_personAddForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personAddForm.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*	===========================================================================
*/		

	{	//		Create the personAdd form fields
	$fld_FirstName = '&lt;input type="text" name="FirstName"  size="10" maxlength="50"/&gt;';
	$fld_LastName = '&lt;input type="text" name="LastName"  size="10" maxlength="50"/&gt;';
	$fld_Tel = '&lt;input type="text" name="Tel"  size="10" maxlength="50"/&gt;';			
	$fld_eMail = '&lt;input type="text" name="eMail"  size="10" maxlength="50"/&gt;';			
	//		END: Create the personAdd form fields
	}			
	{	//	create the Salutation DROPDOWN  FIELD 
		$salut_SQL =  "SELECT lookupValue FROM tLookup ";
		$salut_SQL .= "WHERE lookupType = 'Salutation' ";
		$salut_SQL .= "ORDER By lookupOrder ";
		
		$salut_SQL_Query = mysql_query($salut_SQL);	

		$fld_Salutation = '&lt;select name="Salutation"&gt;';
			//$fld_Salutation .= '&lt;option selected="selected"&gt;&lt;/option&gt;';
 	
			while ($row = mysql_fetch_array($salut_SQL_Query, MYSQL_ASSOC)) {
			    $salutValue = $row['lookupValue'];
			    if ($current_Salutation == $salutValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $fld_Salutation .= '&lt;option'.$selectedFlag.'&gt;'.$salutValue.'&lt;/option&gt;';
			}

		$fld_Salutation .= '&lt;/select&gt;';
		
	//	END: create the Salutation DROPDOWN  FIELD 
	}	
		
	echo '&lt;form action="index.php?content=companyPeopleEdit" method="post"&gt;';
		echo '&lt;input type="hidden" name="companyID" value="'.$companyID.'" /&gt;';
		echo '&lt;input type="hidden" name="newPersonInserted" value="1" /&gt;';
		
		echo '&lt;table&gt;';		
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;hr /&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td&gt;Salutation&lt;/td&gt;
						&lt;td&gt;FirstName&lt;/td&gt;
						&lt;td&gt;LastName&lt;/td&gt;
						&lt;td&gt;Telelphone&lt;/td&gt;
						&lt;td&gt;eMail&lt;/td&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;/tr&gt;	';												
				echo '&lt;tr&gt;
						&lt;td&gt;'.$fld_Salutation.'&lt;/td&gt;
						&lt;td&gt;'.$fld_FirstName.'&lt;/td&gt;
						&lt;td&gt;'.$fld_LastName.'&lt;/td&gt;
						&lt;td&gt;'.$fld_Tel.'&lt;/td&gt;
						&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
						&lt;td&gt;&lt;input type="submit" value="Add" /&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
		echo '&lt;/table&gt;';
	echo '&lt;/form&gt;';
	//		END: FORM to INSERT person	

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_personEditForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personEditForm.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			EDIT FORM for selected tPerson
*
*	===========================================================================
*/		

		{	//		Get the details of the person selected 
			$personID = $_GET["personID"];	
					
			$tPerson_SQLselect = "SELECT * ";
			$tPerson_SQLselect .= "FROM ";
			$tPerson_SQLselect .= "tPerson ";
			$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
			
			$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
			
			while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
				$current_Salutation = $row['Salutation'];
				$current_FirstName = $row['FirstName'];
				$current_LastName = $row['LastName'];
				$current_Tel = $row['Tel'];
				$current_eMail = $row['eMail'];
				
				$companyID = $row['CompanyID'];
				 
			}
			
		//  END: Get the details of the person selected 
		}

		{	//		Create form fields 
			$fld_personID = '&lt;input type="hidden" name="personID" value="'.$personID.'"/&gt;';
			$fld_personEdited = '&lt;input type="hidden" name="personEdited" value="1"/&gt;';
	
			$fld_FirstName = '&lt;input type="text" name="FirstName" value="'.$current_FirstName.'"/&gt;';
			$fld_LastName = '&lt;input type="text" name="LastName" value="'.$current_LastName.'"/&gt;';
			$fld_Tel = '&lt;input type="text" name="Tel" value="'.$current_Tel.'"/&gt;';
			$fld_eMail = '&lt;input type="text" name="eMail" value="'.$current_eMail.'"/&gt;';
		//  END: Create form fields 
		}

		{	//	create the Company DROPDOWN  FIELD 
			$companyList_SQL =  "SELECT ID, prename, Name, RegType FROM tCompany ";
			$companyList_SQL .= "ORDER By Name ";
			
			$companyList_SQL_Query = mysql_query($companyList_SQL);	

			$fld_companyID = '&lt;select name="companyID"&gt;';
	 	
				while ($row = mysql_fetch_array($companyList_SQL_Query, MYSQL_ASSOC)) {
				    $dd_companyID = $row['ID'];
				    $dd_preName = $row['preName'];
				    $dd_companyName = $row['Name'];
				    $dd_RegType = $row['RegType'];
				    
				    $fullCoyName = trim($dd_preName." ".$dd_companyName." ".$dd_RegType);
				    
				    if ($dd_companyID == $companyID) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_companyID .= '&lt;option value="'.$dd_companyID.'"';
				    $fld_companyID .= $selectedFlag.'&gt;'.$fullCoyName.'&lt;/option&gt;';
				}
			
				mysql_free_result($companyList_SQL_Query);		
	
			$fld_companyID .= '&lt;/select&gt;';
			
		//	END: create the Company DROPDOWN  FIELD 
		}	
		{	//	create the Selection DROPDOWN  FIELD 
			$salut_SQL =  "SELECT lookupValue FROM tLookup ";
			$salut_SQL .= "WHERE lookupType = 'Salutation' ";
			$salut_SQL .= "ORDER By lookupOrder ";
			
			$salut_SQL_Query = mysql_query($salut_SQL);	

			$fld_Salutation = '&lt;select name="Salutation"&gt;';
	 	
				while ($row = mysql_fetch_array($salut_SQL_Query, MYSQL_ASSOC)) {
				    $salutValue = $row['lookupValue'];
				    if ($current_Salutation == $salutValue) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_Salutation .= '&lt;option'.$selectedFlag.'&gt;'.$salutValue.'&lt;/option&gt;';
				}
			
				mysql_free_result($salut_SQL_Query);		
	
			$fld_Salutation .= '&lt;/select&gt;';
			
		//	END: create the Selection DROPDOWN  FIELD 
		}	
		{	//	render the FORM 

			echo '&lt;form name="postPerson" action="index.php?content=companyPeopleEdit" method="post"&gt;';
			echo $fld_personEdited;
		
				echo $fld_personID;
				echo $fld_saveClicked;
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;Salutation&lt;/td&gt;
						&lt;td&gt;'.$fld_Salutation.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;First Name&lt;/td&gt;
						&lt;td&gt;'.$fld_FirstName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Last Name&lt;/td&gt;
						&lt;td&gt;'.$fld_LastName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Telephone&lt;/td&gt;
						&lt;td&gt;'.$fld_Tel.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;tr&gt;
						&lt;td&gt;eMail&lt;/td&gt;
						&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;td&gt;Company&lt;/td&gt;&#xD;
						&lt;td&gt;'.$fld_companyID.'&lt;/td&gt;&#xD;
					&lt;/tr&gt;&#xD;					&lt;tr&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;					
				&lt;/table&gt;
				';
					
			echo '&lt;/form&gt;';
		//		END: render the FORM 
		}

	
echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$companyID.'"&gt;Back to Company/People List&lt;/a&gt;';
echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="css">
        <leaf type="insert" title="alphacrm_layout.css">
          <before>/*		StyleSheet file = alphacrm_layout.css

			*
			* Bespoke  Template Stylesheet by TMITworld.co.uk
			* Author www.TMITworld.co.uk
			*
			*		used in php/MySQL Training Course
			*		for Infinite Skill Inc.
			*
			* StyleSheet name = alphacrm_layout.css
			 			
*/

#header {
 	text-align: center;
 	font-size: 18pt;	
}    

#outerWrapper {
    border-spacing: 10px;
    display: table;
    
}

#innerWrapper {
    border-spacing: 10px;
    display: table;
}

#menuColumn{
    display: table-cell;
    border: 1px solid #094700;
    padding: 10px;
    vertical-align: top;
    background-color: #DDFFBB;
    min-width: 140px;
}
    
#contentColumn {
    display: table-cell;
    border: 1px solid #094700;
    padding: 10px;
	 vertical-align: top;
	 background-color: #FCFFCD;
	 min-width: 700px;
}

#footer {
 	text-align: center;	
}    


/*		DELIVERY:


  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;header&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
        			&lt;p&gt;content&lt;/p&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;footer&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;
  
*/

</before>
          <after/>
        </leaf>
        <leaf type="insert" title="alphacrm_style.css">
          <before>/*		StyleSheet file = alphacrm_style.css

			*
			* Bespoke  Template Stylesheet by TMITworld.co.uk
			* Author www.TMITworld.co.uk
			*
			*		used in php/MySQL Training Course
			*		for Infinite Skill Inc.
			*
			* StyleSheet name = alphacrm_style.css
			 			
*/

body {
	font-family: arial, helvetica, sans-serif;
	color:#0000FF;
	text-decoration: none;
}

a {
	color:#0000FF;
	text-decoration: none;
	
}

a:hover {
	border-bottom:2px solid;
	color:maroon;
	
}

a .tableHeader {
	background-color: #000000;	
	color: white;	
	font-weight: bold;
	border-bottom:1px solid;	
}


a:hover .tableHeader {
	background-color: #000000;	
	color: red;	
	font-weight: bold;
	border-bottom:1px solid;	
}

.trOdd {
	background-color: #BFFFCF;	
}

.trEven {
	background-color: #FCCDFF;	
}

.textNormal {
	font-family: arial, helvetica, sans-serif;
	color: black;	
}

.textEmph {
	color: maroon;	
}
.tableHeader {
	background-color: #000000;	
	color: white;	
}
	
.pad60 {
	margin-left: 60px;	
}

.pad120 {
	margin-left: 120px;	
}

.mainMenuItem {
	font-family: arial, helvetica, sans-serif;
	color: maroon;	
}

a:hover .mainMenuItem {
	color: blue;	
	font-weight: bold;
	border-bottom:1px solid;	
}

</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="snapshots">
      <branch title="index">
        <leaf type="insert" title="0901_01_index.php">
          <before>&lt;?php

/*					
*		INCLUDE FILE:        includes/inc_footer.php
*
*			used in:          index.php
*
*			Version:    		0901  date: 2010-07-01
*/

	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {

	} else {
			$contentText = 'No database connection.';
	}	

	
?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;


&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
&lt;meta name="author" content="ks106" &gt;
&lt;meta name="date" content="2010-07-27T14:15:44+0100" &gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
&lt;/head&gt;


&lt;/head&gt;
&lt;body&gt;


  &lt;div id="outerWrapper"&gt;

        &lt;p&gt;header&lt;/p&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
        			&lt;p&gt;content&lt;/p&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;footer&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;



&lt;/body&gt;
&lt;/html&gt;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0902_end_index.php">
          <before>&lt;?php

/*	File:			index.php

	{ 		//	Secure Connection Script
	if ($dbSuccess) {

	} else {
			$contentText = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-26T15:23:42+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;header&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
        			&lt;p&gt;content&lt;/p&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;footer&lt;/p&gt;		
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0903_01_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'forms/tp_loginForm.php';
			}
						
		}

	} else {
			$contentMsg = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;


&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
&lt;meta name="author" content="ks106" &gt;
&lt;meta name="date" content="2010-07-27T16:26:14+0100" &gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
&lt;/head&gt;

&lt;/head&gt;
&lt;body&gt;


  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;				
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php include($menuFile); ?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;?php include($contentFile); ?&gt;
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
			 &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;



&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0903_end_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
				
			$contentFile = 'includes/tp_loginForm.php';
		
		}
		
	} else {
			$contentText = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-28T15:12:04+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php      				
      				if (file_exists($menuFile)) {include($menuFile);} 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;br /&gt;
      			&lt;?php       				
      				if (file_exists($contentFile)) {include($contentFile);} 
      			?&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0904_01_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
				
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
		
		}
		
	} else {
			$contentText = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-28T15:12:04+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php      				
      				if (file_exists($menuFile)) {include($menuFile);} 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;br /&gt;
      			&lt;?php       				
      				if (file_exists($contentFile)) {include($contentFile);} 
      			?&gt;        
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0904_end_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
						
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  DO SOMETHING depending on the $contentCode.   eg
				
				$contentMsg = $contentCode;

			}
		
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
				
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
		
		}
		
	} else {
			$contentText = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-28T15:19:50+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php      				
      				if (file_exists($menuFile)) {include($menuFile);} 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;br /&gt;
      			&lt;?php       				
      				if (file_exists($contentFile)) {include($contentFile);} 
  	      			
						if (!empty($contentMsg)) { echo $contentMsg; }
     				?&gt;        

      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="near_end_09_index.php">
          <before>&lt;?php

	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	
	if ($dbSuccess) {
		include_once('includes/functions_accessLog.php');
		include_once('includes/functions_loginForm.php');
		include_once('includes/stringFunctions.php');	
			
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");
		if ($loginAuthorised) {
			
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				$loginAuthorised = false;
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/inc_crmMenu_tp.php';
				$footerMenu = 'includes/inc_footer.php';
				
				$contentCode = $_GET['content'];
				if ($contentCode == 1) {
					$orderClause = $_GET["orderClause"];	 
					$contentFile = 'forms/tp_companyListOrder.php'; 
				}
			}
		
		} else {
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'forms/tp_loginForm.php';
			}
		}

	} else {
			$contentText = 'No database connection.';
	}	

	
?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
&lt;meta name="author" content="ks106" &gt;
&lt;meta name="date" content="2010-07-26T15:43:36+0100" &gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/layout_alphCRM.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;



  &lt;div id="outerWrapper"&gt;

         &lt;div id="header"&gt;&lt;/p&gt;
         php MySQL Training - a course by TMIT World&lt;br /&gt;
			&lt;/div&gt;&lt;!-- end header --&gt;
			
    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
      			&lt;p&gt;Menu&lt;/p&gt;		
      			&lt;br /&gt;&lt;br /&gt;
      			&lt;?php include($menuFile); ?&gt;
			
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;?php include($contentFile); ?&gt;
     
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;?php include_once($footerMenu); ?&gt;
		      &lt;br /&gt;&lt;br /&gt;
		      &amp;copy; 2010, TMIT World Ltd.
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;
  
  
  

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0905_01_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
			
						
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  SWITCH processing on $contentCode.  
				//		update code:   0905 Content management 
				switch ($contentCode) {
				    case "listCompanies":
				        $contentMsg = $contentCode;
				        break;
				    case "insertCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "editCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "insertUser":
				        $contentMsg = $contentCode;
				        break;
				}			

			}
		
			$menuFile = 'includes/tp_crmMenu.php';
		
		} else {
				
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
		
		}
		
	} else {
			$contentText = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;

	&lt;title&gt;php MySQL Training&lt;/title&gt;
	&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
	&lt;meta name="author" content="ks106" &gt;
	&lt;meta name="date" content="2010-07-28T16:15:23+0100" &gt;
	&lt;meta name="copyright" content="TMIT World Limited"&gt;
	&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
	&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
	&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;

&lt;/head&gt;
&lt;body&gt;

  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php      				
      				if (file_exists($menuFile)) {include($menuFile);} 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;br /&gt;
      			&lt;?php       				
      				if (file_exists($contentFile)) {include($contentFile);} 
  	      			
						if (!empty($contentMsg)) { echo $contentMsg; }
     				?&gt;        

      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
		    &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;

&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0905_end_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/


	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');
		include_once('includes/stringFunctions.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
						
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  DO SOMETHING depending on the $contentCode.  
				//		update code:   0905 Content management 
				switch ($contentCode) {
				    case "companyList":
				        $contentFile = "includes/tp_companyList.php";
				        break;
				    case "insertCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "editCompany":
				        $contentMsg = $contentCode;
				        break;
				    case "insertUser":
				        $contentMsg = $contentCode;
				        break;
				    case "companyPeopleEdit":						
 				         $contentFile = "includes/tp_companyPeopleEdit.php";
				        break;
				    case "personEditForm":
				        $contentFile = "includes/tp_personEditForm.php";
				        break;
				}							
			}
		
		} else {
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'forms/tp_loginForm.php';
			}
						
		}

	} else {
			$contentMsg = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;


&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
&lt;meta name="author" content="ks106" &gt;
&lt;meta name="date" content="2010-07-28T10:42:43+0100" &gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
&lt;/head&gt;

&lt;/head&gt;
&lt;body&gt;


 &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;				
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php if (file_exists($menuFile)) { include($menuFile); } 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;?php 
      					if (file_exists($contentFile)) { include($contentFile); } 
		      			if (!empty($contentMsg)) {
		      				echo $contentMsg;
		      			}
      			?&gt;
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
			 &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;


&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_index.php">
          <before>&lt;?php

/*	File:			index.php
*
*	Folder:		root (htdocs)	
*	By:			TMIT
*	Date:		2010-06-01
*
*	This script is the HOMEPAGE for alphaCRM
*
*
*============================================================
*/

	{ 		//	Secure Connection Script
			include('../htconfig/dbConfig.php'); 
			$dbSuccess = false;
			$dbConnected = mysql_connect($db['hostname'],$db['username'],$db['password']);
			
			if ($dbConnected) {		
				$dbSelected = mysql_select_db($db['database'],$dbConnected);
				if ($dbSelected) {
					$dbSuccess = true;
				} 	
			}
			//	END	Secure Connection Script
	}

	if ($dbSuccess) {
		include_once('includes/fn_authorise.php');
		include_once('includes/stringFunctions.php');

		$menuFile = '';
		$contentFile = '';
		$contentMsg = '';
		
		$loginAuthorised = ($_COOKIE["loginAuthorised"] == "loginAuthorised");

		if ($loginAuthorised) {
						
			$accessLevel = $_COOKIE["accessLevel"];
			$userID = $_COOKIE["userID"];
					
			$status = $_GET['status'];
			if (isset($status) AND ($status == "logout")) {
				setcookie("loginAuthorised", "", time()-7200);	
				header("Location: index.php");
			} else {
				
				//		This is where we manage CONTENT for LOGGED-IN users
				$menuFile = 'includes/tp_crmMenu.php';
				
				$contentCode = $_GET['content'];
				
				//  DO SOMETHING depending on the $contentCode.  
				//		update code:   0905 Content management 
				switch ($contentCode) {
				    case "companyList":
				        $contentFile = "includes/tp_companyList.php";
				        break;
				    case "insertCompany":
				        $contentFile = "includes/tp_companyInsert.php";
				        break;
				    case "editCompany":
				        $contentFile = "includes/tp_companyEditForm.php";
				        break;
				    case "insertUser":					
 				        $contentFile = "includes/tp_userInsert.php";
				        break;
				    case "companyPeopleEdit":						
 				         $contentFile = "includes/tp_companyPeopleEdit.php";
				        break;
				    case "personEditForm":
				        $contentFile = "includes/tp_personEditForm.php";
				        break;
				}							
			}
		
		} else {
			$username = $_POST['username'];
			$password = $_POST['password'];
			if (userAuthorised($username, $password)) {
				header("Location: index.php");
			} else {
				
				$contentFile = 'includes/tp_loginForm.php';
			}
						
		}

	} else {
			$contentMsg = 'No database connection.';
	}	

?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;


&lt;title&gt;php MySQL Training&lt;/title&gt;
&lt;meta name="generator" content="Bluefish 2.0.0" &gt;
&lt;meta name="author" content="ks106" &gt;
&lt;meta name="date" content="2010-07-29T12:52:46+0100" &gt;
&lt;meta name="copyright" content="TMIT World Limited"&gt;
&lt;meta name="keywords" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="description" content="Infinite Skills - php/MySQL Training"&gt;
&lt;meta name="ROBOTS" content="NOINDEX, NOFOLLOW"&gt;
&lt;link rel="stylesheet" href="css/alphacrm_layout.css" type="text/css" /&gt;
&lt;link rel="stylesheet" href="css/alphacrm_style.css" type="text/css" /&gt;
&lt;/head&gt;

&lt;/head&gt;
&lt;body&gt;


  &lt;div id="outerWrapper"&gt;

		    &lt;div id="header"&gt;
		      &lt;p&gt;alpha CRM application&lt;/p&gt;				
		    &lt;/div&gt;&lt;!-- end header --&gt;

    		&lt;div id="innerWrapper"&gt;
    		
      		&lt;div id="menuColumn"&gt;
					&lt;p&gt;Menu&lt;/p&gt;					
      			&lt;br /&gt;
      			&lt;?php if (file_exists($menuFile)) { include($menuFile); } 
      			?&gt;
		      &lt;/div&gt;&lt;!-- end menuColumn --&gt;

      		&lt;div id="contentColumn"&gt;
      			&lt;?php 
      					if (file_exists($contentFile)) { include($contentFile); } 
		      			if (!empty($contentMsg)) {
		      				echo $contentMsg;
		      			}
      			?&gt;
      		&lt;/div&gt;&lt;!-- end contentColumn --&gt;
      		
    		&lt;/div&gt;&lt;!-- end innerWrapper --&gt;

		    &lt;div id="footer"&gt;
		      &lt;p&gt;&amp;copy; 2010, &lt;a href="http://www.TMITworld.com" target="_TMIT"&gt;
		      TMIT World - the database experts
		      &lt;/a&gt;&lt;/p&gt;
			 &lt;/div&gt;&lt;!-- end footer --&gt;
    
  &lt;/div&gt;&lt;!-- end outerWrapper --&gt;



&lt;/body&gt;
&lt;/html&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="tp">
        <leaf type="insert" title="0905_end_tp_companyList">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyList.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list companies from table tCompany
*
*	===========================================================================
*/		
$thisScriptName = 'index.php?content=companyList';

//		Get the sortorder with GET but default to Name
$orderClause = $_GET["orderClause"];	
if (!isset($orderClause)) {$orderClause = "Name"; }

{	//		SELECT all companies in Name order and execute 
	$tCompany_SQLselect = "SELECT * ";
	$tCompany_SQLselect .= "FROM ";
	$tCompany_SQLselect .= "tCompany ";	
	$tCompany_SQLselect .= "ORDER BY ";
	$tCompany_SQLselect .= "tCompany.".$orderClause;

	$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect); 	

}

{	//		Output 

//		make each header a link to $thisScriptName and ADD the  querystring for orderclause 
$header_ID = '&lt;a href="'.$thisScriptName.'&amp;orderClause=ID"&gt;&lt;span class="tableHeader"&gt;ID&lt;/span&gt;&lt;/a&gt;';
$header_Name = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Name"&gt;&lt;span class="tableHeader"&gt;Company&lt;/span&gt;&lt;/a&gt;';
$header_Town = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Town"&gt;&lt;span class="tableHeader"&gt;Town&lt;/span&gt;&lt;/a&gt;';
$header_County = '&lt;a href="'.$thisScriptName.'&amp;orderClause=County"&gt;&lt;span class="tableHeader"&gt;County&lt;/span&gt;&lt;/a&gt;';
$header_Postcode = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Postcode"&gt;&lt;span class="tableHeader"&gt;Postcode&lt;/span&gt;&lt;/a&gt;';
$header_COUNTRY = '&lt;a href="'.$thisScriptName.'&amp;orderClause=COUNTRY"&gt;&lt;span class="tableHeader"&gt;COUNTRY&lt;/span&gt;&lt;/a&gt;';

	echo '&lt;h2&gt;Company List&lt;/h2&gt;';
				
	echo '&lt;table border="1"&gt;';	
		echo '&lt;tr class="tableHeader" height="40px"&gt;';		
			echo '&lt;td&gt;'.$header_ID.'&lt;/td&gt;';
			echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Name.'&lt;/td&gt;';
			echo '&lt;td&gt;Address&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Town.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_County.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Postcode.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_COUNTRY.'&lt;/td&gt;';

		echo '&lt;/tr&gt;';

		$indx = 0;		//		count the rows to give alternating style 
		while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
			
			$ID = $row['ID'];
			$preName = $row['preName'];
			$CompanyName = $row['Name'];
			$regType = $row['RegType'];				
			
             $CompanyFullName = shortCoName($CompanyName, $regType);

			$StreetA = $row['StreetA'];
			$StreetB = $row['StreetB'];
			$StreetC = $row['StreetC'];			        

             $CompanyAddress = coAddress($StreetA, $StreetB, $StreetC);
				
		   $Town = $row['Town'];
		   $County = $row['County'];
		   $Postcode = $row['Postcode'];
		   $COUNTRY = $row['COUNTRY'];
	
			//	Link to index.php?content=companyPeopleEdit
			$linkToList = '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$ID.'"&gt;'.$ID.'&lt;/a&gt;';
			
			//		Set row style
			if (($indx % 2) == 1) {$rowClass = 'class="trOdd"'; } else { $rowClass = 'class="trEven"'; }
			echo '&lt;tr '.$rowClass.'&gt;';
			
				echo '&lt;td&gt;'.$linkToList.'&amp;nbsp;&lt;/td&gt;'; 
				echo '&lt;td&gt;'.$preName.'&amp;nbsp;&lt;/td&gt;'; 
				echo '&lt;td&gt;'.$CompanyFullName.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$CompanyAddress.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Town.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$County.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Postcode.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$COUNTRY.'&amp;nbsp;&lt;/td&gt;';
		
			echo '&lt;/tr&gt;';
	  
	  		$indx++;
	   //	END: while
		}

	echo '&lt;/table&gt;';	
	echo ' &amp;nbsp;&amp;nbsp;^ click ID to list PEOPLE in this company.';

//		END:Output 
}


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="0905_end_tpCompanyPeopleEdit">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*	===========================================================================
*/		

$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
include_once('includes/fn_tPerson_SQL.php');

$companyID = $_POST["companyID"];
if(!isset($companyID)) {$companyID = $_GET["companyID"]; }

$personID = $_POST["personID"];
if(!isset($personID)) {$personID = $_GET["personID"]; }

$newPersonInserted = $_POST["newPersonInserted"];
if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }

$personEdited = $_POST["personEdited"];
if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($insertMsg)) {
					echo $insertMsg;
				}
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}


		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

	
						{	//		Table to render tCompany detail	
						echo 	  '&lt;table&gt;
										&lt;tr valign="top"&gt;								
											&lt;td style=" font-size: 24; 
															font-weight: bold;" 
															&gt;
													'.$fullCoyName.'
											&lt;/td&gt;
											
											&lt;td align="right" width="400"&gt;
													'.$CompanyFullAddress.'			
											&lt;/td&gt;
										&lt;/tr&gt;
									&lt;/table&gt;';
						//		END: Table to render tCompany detail
						}
														
			
						{	//		Table of tPerson records
						echo '&lt;table border="1" padding="5"&gt;';
							echo '&lt;tr&gt;
										&lt;td&gt;Salutation&lt;/td&gt;
										&lt;td&gt;FirstName&lt;/td&gt;
										&lt;td&gt;LastName&lt;/td&gt;
										&lt;td&gt;Telephone&lt;/td&gt;
										&lt;td&gt;eMail&lt;/td&gt;';
										
							//		update code:   coPeopleEdit 0807_13_restrict_21
							if (isset($accessLevel) AND $accessLevel &gt;= 21) {
								echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
							}
							echo '&lt;/tr&gt;	';	
																	
							for ($indx = 0; $indx &lt; $numPersons; $indx++) {
								$thisPersonID = $personArray[$indx]['ID'];
								$personEditLink = '&lt;a href="index.php
								?content=personEditForm
								&amp;personID='.$thisPersonID.'"&gt;Edit&lt;/a&gt;';
								
	        					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
	 
								echo '&lt;tr '.$rowClass.' height="20"&gt;
								
											&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
											
											&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;
	
											&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;
	
											&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
											
											&lt;td&gt;'.$personArray[$indx]['eMail'].'&amp;nbsp;&lt;/td&gt;';
			
								if (isset($accessLevel) AND $accessLevel &gt;= 21) {
										echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
								}
								echo '&lt;/tr&gt;	';	
	     
							}
						echo '&lt;/table&gt;';
						//		END:  Table of tPerson records
						}	
																			
						if (isset($accessLevel) AND $accessLevel &gt;= 21) {

							include_once('includes/tp_personAddForm.php');
							
						}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_crmMenu.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_crmMenu.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:		MENU for the TEMPLATE version of alpha CRM
*
*	===========================================================================
*/		
	//	List Companies 
	echo '&lt;a href="index.php?content=companyList"&gt;
			&lt;span class="mainMenuItem"&gt;List Companies&lt;/span&gt;
			&lt;/a&gt;';
	echo '&lt;br /&gt;&lt;br /&gt;';

	//	Restricted - Editor Only menu items
	if (isset($accessLevel) AND $accessLevel &gt;= 21) {
	
		echo '&lt;a href="index.php?content=insertCompany"&gt;
				&lt;span class="mainMenuItem"&gt;Create Company&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';
		
	}

	//	Restricted - Admin Only menu items
	if (isset($accessLevel) AND $accessLevel &gt;= 99) {	
		echo '&lt;a href="index.php?content=insertUser"&gt;
				&lt;span class="mainMenuItem"&gt;create NEW USER&lt;/span&gt;
				&lt;/a&gt;';
		echo '&lt;br /&gt;&lt;br /&gt;';
	}

	//	Logout menu item 
	echo '&lt;a href="index.php?status=logout"&gt;
			&lt;span class="mainMenuItem"&gt;Logout&lt;/span&gt;
			&lt;/a&gt;';
	echo '&lt;br /&gt;&lt;br /&gt;';


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_companyList.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyList.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list companies from table tCompany
*
*	===========================================================================
*/		
$thisScriptName = 'index.php?content=companyList';

//		Get the sortorder with GET but default to Name
$orderClause = $_GET["orderClause"];	
if (!isset($orderClause)) {$orderClause = "Name"; }

{	//		SELECT all companies in Name order and execute 
	$tCompany_SQLselect = "SELECT * ";
	$tCompany_SQLselect .= "FROM ";
	$tCompany_SQLselect .= "tCompany ";	
	$tCompany_SQLselect .= "ORDER BY ";
	$tCompany_SQLselect .= "tCompany.".$orderClause;

	$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect); 	

}

{	//		Output 

//		make each header a link to $thisScriptName and ADD the  querystring for orderclause 
$header_ID = '&lt;a href="'.$thisScriptName.'&amp;orderClause=ID"&gt;&lt;span class="tableHeader"&gt;ID&lt;/span&gt;&lt;/a&gt;';
$header_Name = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Name"&gt;&lt;span class="tableHeader"&gt;Company&lt;/span&gt;&lt;/a&gt;';
$header_Town = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Town"&gt;&lt;span class="tableHeader"&gt;Town&lt;/span&gt;&lt;/a&gt;';
$header_County = '&lt;a href="'.$thisScriptName.'&amp;orderClause=County"&gt;&lt;span class="tableHeader"&gt;County&lt;/span&gt;&lt;/a&gt;';
$header_Postcode = '&lt;a href="'.$thisScriptName.'&amp;orderClause=Postcode"&gt;&lt;span class="tableHeader"&gt;Postcode&lt;/span&gt;&lt;/a&gt;';
$header_COUNTRY = '&lt;a href="'.$thisScriptName.'&amp;orderClause=COUNTRY"&gt;&lt;span class="tableHeader"&gt;COUNTRY&lt;/span&gt;&lt;/a&gt;';

	echo '&lt;h2&gt;Company List&lt;/h2&gt;';
				
	echo '&lt;table border="1"&gt;';	
		echo '&lt;tr class="tableHeader" height="40px"&gt;';		
			echo '&lt;td&gt;'.$header_ID.'&lt;/td&gt;';
			echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Name.'&lt;/td&gt;';
			echo '&lt;td&gt;Address&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Town.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_County.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_Postcode.'&lt;/td&gt;';
			echo '&lt;td&gt;'.$header_COUNTRY.'&lt;/td&gt;';

		echo '&lt;/tr&gt;';

		$indx = 0;		//		count the rows to give alternating style 
		while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
			
			$ID = $row['ID'];
			$preName = $row['preName'];
			$CompanyName = $row['Name'];
			$regType = $row['RegType'];				
			
             $CompanyFullName = shortCoName($CompanyName, $regType);

			$StreetA = $row['StreetA'];
			$StreetB = $row['StreetB'];
			$StreetC = $row['StreetC'];			        

             $CompanyAddress = coAddress($StreetA, $StreetB, $StreetC);
				
		   $Town = $row['Town'];
		   $County = $row['County'];
		   $Postcode = $row['Postcode'];
		   $COUNTRY = $row['COUNTRY'];
	
			//	Link to index.php?content=companyPeopleEdit
			$linkToList = '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$ID.'"&gt;'.$ID.'&lt;/a&gt;';

			$linkToEditCompany = '&lt;a href="index.php?content=editCompany&amp;companyID='.$ID.'"&gt;'
										.$CompanyFullName.'&lt;/a&gt;';
			
			//		Set row style
			if (($indx % 2) == 1) {$rowClass = 'class="trOdd"'; } else { $rowClass = 'class="trEven"'; }
			echo '&lt;tr '.$rowClass.'&gt;';
			
				echo '&lt;td&gt;'.$linkToList.'&amp;nbsp;&lt;/td&gt;'; 
				echo '&lt;td&gt;'.$preName.'&amp;nbsp;&lt;/td&gt;'; 
	//			echo '&lt;td&gt;'.$CompanyFullName.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$linkToEditCompany.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$CompanyAddress.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Town.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$County.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$Postcode.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$COUNTRY.'&amp;nbsp;&lt;/td&gt;';
		
			echo '&lt;/tr&gt;';
	  
	  		$indx++;
	   //	END: while
		}

	echo '&lt;/table&gt;';	
	echo ' &amp;nbsp;&amp;nbsp;^ click ID to list PEOPLE in this company.';

//		END:Output 
}


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_companyEditForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyEditForm.php
*
*		folder:			includes/
*
*		used in:       tp_companyList.php
*
*		version:    	0907   date: 2010-07-01
*
*		purpose:			EDIT FORM for tCompany record selected  
*							by clicking company Name in tp_companyList.php
*
*	===========================================================================
*/	
	include_once('includes/fn_tLookup_SQL.php');
	include_once('includes/fn_tCompany_SQL.php');

	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }

	$thisScriptName = 'index.php?content=editCompany&amp;companyID='.$companyID;
	
		$companyEdited = $_POST["companyEdited"];
		if(!isset($companyEdited)) {$companyEdited = $_GET["companyEdited"]; }
	
	
	{	//		Update tCompany Record
		if(isset($companyEdited) AND $companyEdited == '1'){
			
			$preName = $_POST["preName"];	
			$companyName = $_POST["companyName"];	
			$RegType = $_POST["RegType"];	
			$StreetA = $_POST["StreetA"];	
			$StreetB = $_POST["StreetB"];	
			$StreetC = $_POST["StreetC"];	
			$Town = $_POST["Town"];	
			$County = $_POST["County"];	
			$Postcode = $_POST["Postcode"];	
			$COUNTRY = $_POST["COUNTRY"];	

			$insertMsg = companyUpdate($companyID, $preName, $companyName, $RegType, $StreetA, 
								$StreetB, $StreetC, $Town, $County,
								$Postcode, $COUNTRY);

								
			if (empty($insertMsg)) {
				$fullCoName = fullCoName('1', $preName, $companyName, $RegType);
				echo "Company &lt;strong&gt;".$fullCoName."&lt;/strong&gt; was successfully updated.&lt;br /&gt;&lt;br /&gt;";						
			} else {
				echo $insertMsg;
			}
			
			unset($companyInserted);
		}		
	//		END:  Update tCompany Record
	}

	{	//  Get the details of the company selected 

			$tCompany_SQLselect = "SELECT * ";
			$tCompany_SQLselect .= "FROM ";
			$tCompany_SQLselect .= "tCompany ";
			$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
			
			$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
			
			while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
				$current_preName = $row['preName'];
				$current_Name = $row['Name'];
				$current_RegType = $row['RegType'];
				
				$current_StreetA = $row['StreetA'];
				$current_StreetB = $row['StreetB'];
				$current_StreetC = $row['StreetC'];
				$current_Town = $row['Town'];
				$current_County = $row['County'];
				$current_Postcode = $row['Postcode'];
				$current_COUNTRY = $row['COUNTRY'];
				 
			}
	}

	//		FORM vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
	{	//		Create form fields 
		$fld_ID = '&lt;input type="hidden" name="companyID" value="'.$companyID.'"/&gt;';
		$fld_companyEdited = '&lt;input type="hidden" name="companyEdited" value="1"/&gt;';

		$fld_preName = '&lt;input type="text" name="preName" value="'.$current_preName.'"/&gt;';
		$fld_companyName = '&lt;input type="text" name="companyName" value="'.$current_Name.'"/&gt;';
		
		$fld_RegType = dropdownCoRegTypes($current_RegType);
		
		$fld_StreetA = '&lt;input type="text" name="StreetA" value="'.$current_StreetA.'"/&gt;';
		$fld_StreetB = '&lt;input type="text" name="StreetB" value="'.$current_StreetB.'"/&gt;';
		$fld_StreetC = '&lt;input type="text" name="StreetC" value="'.$current_StreetC.'"/&gt;';
		$fld_Town = '&lt;input type="text" name="Town" value="'.$current_Town.'"/&gt;';
		$fld_County = '&lt;input type="text" name="County" value="'.$current_County.'"/&gt;';
		$fld_Postcode = '&lt;input type="text" name="Postcode" value="'.$current_Postcode.'"/&gt;';

		
		$fld_COUNTRY = dropdownCountries($current_COUNTRY);

	//  END: Create form fields 
	}
		
	{	//		render FORM postCompany 
		echo '&lt;form name="postCompany" action="index.php?content=editCompany" method="post"&gt;';

			
				echo $fld_ID.$fld_companyEdited;	
				echo '&lt;input type="hidden" name="companyID" value="'.$companyID.'"/&gt;';
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;pre Name&lt;/td&gt;
						&lt;td&gt;'.$fld_preName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Company Name&lt;/td&gt;
						&lt;td&gt;'.$fld_companyName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Reg Type&lt;/td&gt;
						&lt;td&gt;'.$fld_RegType.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Address&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetA.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetB.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetC.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Town&lt;/td&gt;
						&lt;td&gt;'.$fld_Town.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;County&lt;/td&gt;
						&lt;td&gt;'.$fld_County.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Postcode&lt;/td&gt;
						&lt;td&gt;'.$fld_Postcode.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;COUNTRY&lt;/td&gt;
						&lt;td&gt;'.$fld_COUNTRY.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
				';
					
		echo '&lt;/form&gt;';
	}
	

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_companyPeopleEdit.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyPeopleEdit.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*	===========================================================================
*/		

	{	//	 NEW in tp_companyPeopleEdit.php
	$thisScriptName = 'index.php?content=companyPeopleEdit&amp;companyID='.$companyID;
	include_once('includes/fn_tPerson_SQL.php');
	
	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }
	
	$personID = $_POST["personID"];
	if(!isset($personID)) {$personID = $_GET["personID"]; }
	
	$newPersonInserted = $_POST["newPersonInserted"];
	if(!isset($newPersonInserted)) {$newPersonInserted = $_GET["newPersonInserted"]; }
	
	$personEdited = $_POST["personEdited"];
	if(!isset($personEdited)) {$personEdited = $_GET["personEdited"]; }


		{	//		Insert New Person Record
			if(isset($newPersonInserted) AND $newPersonInserted == '1'){
				
				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				
				$insertMsg = personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($insertMsg)) {
					echo $insertMsg;
				}
				
				unset($newPersonInserted);
			}		
		//		END:  Insert New Person Record		
		}

		{	//		UPDATE Person Record
			if(isset($personEdited) AND $personEdited == '1'){

				$Salutation = $_POST["Salutation"];	
				$FirstName = $_POST["FirstName"];	
				$LastName = $_POST["LastName"];	
				$Tel = $_POST["Tel"];	
				$eMail = $_POST["eMail"];	
				$companyID = $_POST["companyID"];	
				
				$updateMsg = personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID);
				if (!empty($updateMsg)) {
					echo $updateMsg;
				}
				
				unset($personEdited);
			}		
		//		END:  Insert New Person Record		
		}

	}

		{	//  Get the details of the company selected 
									
				$tCompany_SQLselect = "SELECT * ";
				$tCompany_SQLselect .= "FROM ";
				$tCompany_SQLselect .= "tCompany ";
				$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
				
				$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
				
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
					$preName = $row['preName'];
					$companyName = $row['Name'];
					$RegType = $row['RegType'];
					
					$fullCoyName = trim($preName." ".$companyName." ".$RegType);
					
					$StreetA = $row['StreetA'];
					$StreetB = $row['StreetB'];
					$StreetC = $row['StreetC'];
					$Town = $row['Town'];
					$County = $row['County'];
					$Postcode = $row['Postcode'];
					$COUNTRY = $row['COUNTRY'];
	
	 				$CompanyFullAddress = $StreetA;
			
						if (!empty($StreetB)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetB; }
						if (!empty($StreetC)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$StreetC; }
						if (!empty($Town)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$Town; }
						if (!empty($County)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$County; } 
						if (!empty($Postcode)) { $CompanyFullAddress .=  "&amp;nbsp;&amp;nbsp;&amp;nbsp; ".$Postcode; }			
						if (!empty($COUNTRY)) { $CompanyFullAddress .=  "&lt;br /&gt; ".$COUNTRY; }										 
				}					
		}
		
		{	//  Get the details of all associated Person records
			//		and store in array:  personArray  with key &gt;$indx
			 
				$indx = 0;
			
				$tPerson_SQLselect = "SELECT * ";
				$tPerson_SQLselect .= "FROM ";
				$tPerson_SQLselect .= "tPerson ";
				$tPerson_SQLselect .= "WHERE companyID = '".$companyID."' ";
				
				$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
				
				while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
					
					//		we need this to pass to personEdit.php
					$personArray[$indx]['ID'] = $row['ID'];
					//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
					
					$personArray[$indx]['Salutation'] = $row['Salutation'];
					$personArray[$indx]['FirstName'] = $row['FirstName'];
					$personArray[$indx]['LastName'] = $row['LastName'];
					$personArray[$indx]['Tel'] = $row['Tel'];
					$personArray[$indx]['eMail'] = $row['eMail'];
						
					$indx++;			 
				}
	
				$numPersons = sizeof($personArray);
		}
	
		{	//		Output 

			{	//		Table to render tCompany detail	
			echo 	  '&lt;table&gt;
							&lt;tr valign="top"&gt;								
								&lt;td style=" font-size: 24; 
												font-weight: bold;" 
												&gt;
										'.$fullCoyName.'
								&lt;/td&gt;
								
								&lt;td align="right" width="400"&gt;
										'.$CompanyFullAddress.'			
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;';
			//		END: Table to render tCompany detail
			}
											

			{	//		Table of tPerson records
			echo '&lt;table border="1" padding="5"&gt;';
				echo '&lt;tr&gt;
							&lt;td&gt;Salutation&lt;/td&gt;
							&lt;td&gt;FirstName&lt;/td&gt;
							&lt;td&gt;LastName&lt;/td&gt;
							&lt;td&gt;Telephone&lt;/td&gt;
							&lt;td&gt;eMail&lt;/td&gt;';
							
				//		update code:   coPeopleEdit 0807_13_restrict_21
				if (isset($accessLevel) AND $accessLevel &gt;= 21) {
					echo '&lt;td&gt;&amp;nbsp;&lt;/td&gt;';
				}
				echo '&lt;/tr&gt;	';	
														
				for ($indx = 0; $indx &lt; $numPersons; $indx++) {
					$thisPersonID = $personArray[$indx]['ID'];
					
				//	$personEditLink = '&lt;a href="personEditForm.php?personID='.$thisID.'"&gt;Edit&lt;/a&gt;';
					$personEditLink = '&lt;a href="index.php
					?content=personEditForm
					&amp;personID='.$thisPersonID.'"&gt;Edit&lt;/a&gt;';
					
  					if (($indx % 2) == 1) {$rowClass = $tdOdd; } else { $rowClass = $tdEven; }  
 
					echo '&lt;tr '.$rowClass.' height="20"&gt;
					
								&lt;td&gt;'.$personArray[$indx]['Salutation'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['FirstName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['LastName'].'&amp;nbsp;&lt;/td&gt;

								&lt;td&gt;'.$personArray[$indx]['Tel'].'&amp;nbsp;&lt;/td&gt;
								
								&lt;td&gt;'.$personArray[$indx]['eMail'].'&amp;nbsp;&lt;/td&gt;';

					if (isset($accessLevel) AND $accessLevel &gt;= 21) {
							echo '&lt;td&gt;'.$personEditLink.'&amp;nbsp;&lt;/td&gt;';
					}
					echo '&lt;/tr&gt;	';	
  
				}
			echo '&lt;/table&gt;';
			//		END:  Table of tPerson records
			}	
																
			if (isset($accessLevel) AND $accessLevel &gt;= 21) {

				//include_once('includes/inc_personAddForm.php');
				include_once('includes/tp_personAddForm.php');
				
			}
																							
		//		END: Output section 
		}
				

unset($personID);
unset($companyID);

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_personEditForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personEditForm.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			EDIT FORM for selected tPerson
*
*	===========================================================================
*/		

		{	//		Get the details of the person selected 
			$personID = $_GET["personID"];	
					
			$tPerson_SQLselect = "SELECT * ";
			$tPerson_SQLselect .= "FROM ";
			$tPerson_SQLselect .= "tPerson ";
			$tPerson_SQLselect .= "WHERE ID = '".$personID."' ";
			
			$tPerson_SQLselect_Query = mysql_query($tPerson_SQLselect);	
			
			while ($row = mysql_fetch_array($tPerson_SQLselect_Query, MYSQL_ASSOC)) {
				$current_Salutation = $row['Salutation'];
				$current_FirstName = $row['FirstName'];
				$current_LastName = $row['LastName'];
				$current_Tel = $row['Tel'];
				$current_eMail = $row['eMail'];
				
				$companyID = $row['CompanyID'];
				 
			}
			
		//  END: Get the details of the person selected 
		}

		{	//		Create form fields 
			$fld_personID = '&lt;input type="hidden" name="personID" value="'.$personID.'"/&gt;';
			$fld_personEdited = '&lt;input type="hidden" name="personEdited" value="1"/&gt;';
	
			$fld_FirstName = '&lt;input type="text" name="FirstName" value="'.$current_FirstName.'"/&gt;';
			$fld_LastName = '&lt;input type="text" name="LastName" value="'.$current_LastName.'"/&gt;';
			$fld_Tel = '&lt;input type="text" name="Tel" value="'.$current_Tel.'"/&gt;';
			$fld_eMail = '&lt;input type="text" name="eMail" value="'.$current_eMail.'"/&gt;';
		//  END: Create form fields 
		}

		{	//	create the Company DROPDOWN  FIELD 
			$companyList_SQL =  "SELECT ID, prename, Name, RegType FROM tCompany ";
			$companyList_SQL .= "ORDER By Name ";
			
			$companyList_SQL_Query = mysql_query($companyList_SQL);	

			$fld_companyID = '&lt;select name="companyID"&gt;';
	 	
				while ($row = mysql_fetch_array($companyList_SQL_Query, MYSQL_ASSOC)) {
				    $dd_companyID = $row['ID'];
				    $dd_preName = $row['preName'];
				    $dd_companyName = $row['Name'];
				    $dd_RegType = $row['RegType'];
				    
				    $fullCoyName = trim($dd_preName." ".$dd_companyName." ".$dd_RegType);
				    
				    if ($dd_companyID == $companyID) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_companyID .= '&lt;option value="'.$dd_companyID.'"';
				    $fld_companyID .= $selectedFlag.'&gt;'.$fullCoyName.'&lt;/option&gt;';
				}
			
				mysql_free_result($companyList_SQL_Query);		
	
			$fld_companyID .= '&lt;/select&gt;';
			
		//	END: create the Company DROPDOWN  FIELD 
		}	
		{	//	create the Selection DROPDOWN  FIELD 
			$salut_SQL =  "SELECT lookupValue FROM tLookup ";
			$salut_SQL .= "WHERE lookupType = 'Salutation' ";
			$salut_SQL .= "ORDER By lookupOrder ";
			
			$salut_SQL_Query = mysql_query($salut_SQL);	

			$fld_Salutation = '&lt;select name="Salutation"&gt;';
	 	
				while ($row = mysql_fetch_array($salut_SQL_Query, MYSQL_ASSOC)) {
				    $salutValue = $row['lookupValue'];
				    if ($current_Salutation == $salutValue) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $fld_Salutation .= '&lt;option'.$selectedFlag.'&gt;'.$salutValue.'&lt;/option&gt;';
				}
			
				mysql_free_result($salut_SQL_Query);		
	
			$fld_Salutation .= '&lt;/select&gt;';
			
		//	END: create the Selection DROPDOWN  FIELD 
		}	
		{	//	render the FORM 

			echo '&lt;form name="postPerson" action="index.php?content=companyPeopleEdit" method="post"&gt;';
			echo $fld_personEdited;
		
				echo $fld_personID;
				echo $fld_saveClicked;
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;Salutation&lt;/td&gt;
						&lt;td&gt;'.$fld_Salutation.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;First Name&lt;/td&gt;
						&lt;td&gt;'.$fld_FirstName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Last Name&lt;/td&gt;
						&lt;td&gt;'.$fld_LastName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Telephone&lt;/td&gt;
						&lt;td&gt;'.$fld_Tel.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;tr&gt;
						&lt;td&gt;eMail&lt;/td&gt;
						&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;&#xD;
					&lt;td&gt;Company&lt;/td&gt;&#xD;
						&lt;td&gt;'.$fld_companyID.'&lt;/td&gt;&#xD;
					&lt;/tr&gt;&#xD;					&lt;tr&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;					
				&lt;/table&gt;
				';
					
			echo '&lt;/form&gt;';
		//		END: render the FORM 
		}

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyPeopleEdit&amp;companyID='.$companyID.'"&gt;Back to Company/People List&lt;/a&gt;';
echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_personAddForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personAddForm.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			list of people associated with company selected in 
*							tp_companyList.php
*
*	===========================================================================
*/		

	{	//		Create the personAdd form fields
	$fld_FirstName = '&lt;input type="text" name="FirstName"  size="10" maxlength="50"/&gt;';
	$fld_LastName = '&lt;input type="text" name="LastName"  size="10" maxlength="50"/&gt;';
	$fld_Tel = '&lt;input type="text" name="Tel"  size="10" maxlength="50"/&gt;';			
	$fld_eMail = '&lt;input type="text" name="eMail"  size="10" maxlength="50"/&gt;';			
	//		END: Create the personAdd form fields
	}			
	{	//	create the Salutation DROPDOWN  FIELD 
		$salut_SQL =  "SELECT lookupValue FROM tLookup ";
		$salut_SQL .= "WHERE lookupType = 'Salutation' ";
		$salut_SQL .= "ORDER By lookupOrder ";
		
		$salut_SQL_Query = mysql_query($salut_SQL);	

		$fld_Salutation = '&lt;select name="Salutation"&gt;';
			//$fld_Salutation .= '&lt;option selected="selected"&gt;&lt;/option&gt;';
 	
			while ($row = mysql_fetch_array($salut_SQL_Query, MYSQL_ASSOC)) {
			    $salutValue = $row['lookupValue'];
			    if ($current_Salutation == $salutValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $fld_Salutation .= '&lt;option'.$selectedFlag.'&gt;'.$salutValue.'&lt;/option&gt;';
			}

		$fld_Salutation .= '&lt;/select&gt;';
		
	//	END: create the Salutation DROPDOWN  FIELD 
	}	
		
	echo '&lt;form action="index.php?content=companyPeopleEdit" method="post"&gt;';
		echo '&lt;input type="hidden" name="companyID" value="'.$companyID.'" /&gt;';
		echo '&lt;input type="hidden" name="newPersonInserted" value="1" /&gt;';
		
		echo '&lt;table&gt;';		
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;hr /&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td colspan="6"&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
				echo '&lt;tr&gt;
						&lt;td&gt;Salutation&lt;/td&gt;
						&lt;td&gt;FirstName&lt;/td&gt;
						&lt;td&gt;LastName&lt;/td&gt;
						&lt;td&gt;Telelphone&lt;/td&gt;
						&lt;td&gt;eMail&lt;/td&gt;
						&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;/tr&gt;	';												
				echo '&lt;tr&gt;
						&lt;td&gt;'.$fld_Salutation.'&lt;/td&gt;
						&lt;td&gt;'.$fld_FirstName.'&lt;/td&gt;
						&lt;td&gt;'.$fld_LastName.'&lt;/td&gt;
						&lt;td&gt;'.$fld_Tel.'&lt;/td&gt;
						&lt;td&gt;'.$fld_eMail.'&lt;/td&gt;
						&lt;td&gt;&lt;input type="submit" value="Add" /&gt;&lt;/td&gt;
					&lt;/tr&gt;	';	
		echo '&lt;/table&gt;';
	echo '&lt;/form&gt;';
	//		END: FORM to INSERT person	

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_companyInsert.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyInsert.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FORM to enter new company details
*							POST fields to itself via index.php?content=insertCompany
*							invoke function companyInsert(...) [from file fn_tCompany_SQL.php]
*
*	=====================================================================================
*/		


		include_once('includes/fn_tCompany_SQL.php');
		include_once('includes/fn_tLookup_SQL.php');
							
		$companyInserted = $_POST["companyInserted"];
		if(!isset($companyInserted)) {$companyInserted = $_GET["companyInserted"]; }
		
		{	//		Insert New tCompany Record
			if(isset($companyInserted) AND $companyInserted == '1'){
				
				$preName = $_POST["preName"];	
				$companyName = $_POST["companyName"];	
				$RegType = $_POST["RegType"];	
				$StreetA = $_POST["StreetA"];	
				$StreetB = $_POST["StreetB"];	
				$StreetC = $_POST["StreetC"];	
				$Town = $_POST["Town"];	
				$County = $_POST["County"];	
				$Postcode = $_POST["Postcode"];	
				$COUNTRY = $_POST["COUNTRY"];	
					
				$insertMsg = companyInsert($preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY)	;
									
				if (!empty($insertMsg)) {
					echo $insertMsg;
				} else {
					$fullCoName = fullCoName('1', $preName, $companyName, $RegType);
					echo "Company &lt;strong&gt;".$fullCoName."&lt;/strong&gt; was successfully inserted.&lt;br /&gt;&lt;br /&gt;";	
				}
				
				unset($companyInserted);
			}		
		//		END:  Insert New tCompany Record		
		}
		

		$fld_companyInserted = '&lt;input type="hidden" name="companyInserted" value="1"/&gt;';
		$fld_COUNTRY = dropdownCountries('');
		
		{	//	FORM postCompany 
		//echo '&lt;form name="postCompany" action="companySave.php" method="post"&gt;';
		echo '&lt;form name="postCompany" action="index.php?content=insertCompany" method="post"&gt;';
				echo $fld_companyInserted;
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;pre Name&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="preName" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Company Name&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="companyName" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Reg Type&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="RegType" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Address&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetA" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetB" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetC" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Town&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="Town" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;County&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="County" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Postcode&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="Postcode" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;COUNTRY&lt;/td&gt;
						&lt;td&gt;'.$fld_COUNTRY.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
				';
					
		echo '&lt;/form&gt;';
		//	END: FORM postCompany 
		}		
		
	echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	echo '&lt;a href="../index.php"&gt;homepage&lt;/a&gt;';
	echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
	echo '&lt;a href="index.php?content=companyList"&gt;Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_userInsert.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_userInsert.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FORM to enter new user details
*							POST fields to itself via index.php?content=insertCompany
*							invoke function companyInsert(...) [from file fn_tCompany_SQL.php]
*
*	=====================================================================================
*/		

		include_once('includes/fn_tLookup_SQL.php');
		include_once('includes/fn_tUser_SQL.php');

		{  //   collect the data with $_POST
			$username = $_POST["username"];	
			$password = $_POST["password"];	
			$passwordValidate = $_POST["passwordValidate"];	
			$eMail = $_POST["eMail"];	
			$accessLevel = $_POST["accessLevel"];	
							
			$userInserted = $_POST["userInserted"];

		}
		
		{	//		Insert New tUser Record
			if(isset($userInserted) AND $userInserted == '1'){
				
				$insertMsg = userInsert($username, $password, $passwordValidate, $eMail, $accessLevel);
					
				if (empty($insertMsg)) {
					echo "User &lt;strong&gt;".$username."&lt;/strong&gt; was successfully inserted.&lt;br /&gt;&lt;br /&gt;";
				} else {
					echo $insertMsg;
				}
				
				unset($userInserted);
			}		
		//		END:  Insert New tUser Record		
		}
		
		$fld_userInserted = '&lt;input type="hidden" name="userInserted" value="1"/&gt;';
		$fld_access = dropdownUserAccess('');
		
			{	//	FORM postUser
			echo '&lt;form name="postUser" action="index.php?content=insertUser" method="post"&gt;';
					echo $fld_userInserted;
					echo '
					&lt;table&gt;
						&lt;tr&gt;
							&lt;td&gt;username&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="username" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;password&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="password" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;retype password&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="passwordValidate" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;eMail&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="eMail" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;access level&lt;/td&gt;
							&lt;td&gt;'.$fld_access.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;&lt;/td&gt;
							&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
					&lt;/table&gt;
					';
						
			echo '&lt;/form&gt;';
			//	END: FORM postUser 
			}			
		
		
	echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	echo '&lt;a href="../index.php"&gt;homepage&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="fn">
        <leaf type="insert" title="fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*
*	===========================================================================
*/		

	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {

		$tPerson_SQLinsert = "INSERT INTO tPerson (";			
		$tPerson_SQLinsert .=  "Salutation, ";
		$tPerson_SQLinsert .=  "FirstName, ";
		$tPerson_SQLinsert .=  "LastName, ";
		$tPerson_SQLinsert .=  "Tel, ";	
		$tPerson_SQLinsert .=  "eMail, ";	
		$tPerson_SQLinsert .=  "companyID ";
		$tPerson_SQLinsert .=  ") ";
		
		$tPerson_SQLinsert .=  "VALUES (";
		$tPerson_SQLinsert .=  "'".$Salutation."', ";
		$tPerson_SQLinsert .=  "'".$FirstName."', ";
		$tPerson_SQLinsert .=  "'".$LastName."', ";
		$tPerson_SQLinsert .=  "'".$Tel."', ";	
		$tPerson_SQLinsert .=  "'".$eMail."', ";	
		$tPerson_SQLinsert .=  "'".$companyID."' ";
		$tPerson_SQLinsert .=  ") ";

		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new person.";
			}
		} else {
			$errorMsg = "Cannot add person with no Lastname.";
		}		
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		$tPerson_SQLupdate = "UPDATE tPerson SET ";			
		$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
		
		$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
		$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
		$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
		$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
		$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
		$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
	
		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update person.";
			}
		} else {
			$errorMsg = "Cannot make Lastname empty.";
		}		
		
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_tPerson_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tPerson_SQL.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FUNCTIONS:
*							personInsert - INSERTS new tPerson record
*							personUpdate - UPDATES edits from tp_personEditForm.php
*
*	===========================================================================
*/		

	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {

		$tPerson_SQLinsert = "INSERT INTO tPerson (";			
		$tPerson_SQLinsert .=  "Salutation, ";
		$tPerson_SQLinsert .=  "FirstName, ";
		$tPerson_SQLinsert .=  "LastName, ";
		$tPerson_SQLinsert .=  "Tel, ";	
		$tPerson_SQLinsert .=  "eMail, ";	
		$tPerson_SQLinsert .=  "companyID ";
		$tPerson_SQLinsert .=  ") ";
		
		$tPerson_SQLinsert .=  "VALUES (";
		$tPerson_SQLinsert .=  "'".$Salutation."', ";
		$tPerson_SQLinsert .=  "'".$FirstName."', ";
		$tPerson_SQLinsert .=  "'".$LastName."', ";
		$tPerson_SQLinsert .=  "'".$Tel."', ";	
		$tPerson_SQLinsert .=  "'".$eMail."', ";	
		$tPerson_SQLinsert .=  "'".$companyID."' ";
		$tPerson_SQLinsert .=  ") ";

		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new person.";
			}
		} else {
			$errorMsg = "Cannot add person with no Lastname.";
		}		
		return $errorMsg;
	}	

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		$tPerson_SQLupdate = "UPDATE tPerson SET ";			
		$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
		
		$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
		$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
		$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
		$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
		$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
		$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
	
		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update person.";
			}
		} else {
			$errorMsg = "Cannot make Lastname empty.";
		}		
		
		return $errorMsg;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_tUser_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tUser_SQL.php
*
*		folder:			includes/
*
*		used in:       anywhere
*
*		version:    	0907   date: 2010-07-01
*
*		purpose:			SQL commands for tUser, tAccessLog and tAccessControl
*
*		content:			function userInsert($username, $password, $eMail, $accessLevel)
*
*
*	===========================================================================
*/		

	function userInsert($username, $password, $passwordValidate, $eMail, $accessLevel) {

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (strlen($username) &lt; 5) { $errorMsg = "Username cannot be less than 5 characters&lt;br /&gt;"; }
			if (strlen($password) &lt; 5) { $errorMsg .= "Password cannot be less than 5 characters&lt;br /&gt;"; }
			if ($password &lt;&gt; $passwordValidate) { $errorMsg .= "Password retype does not match.&lt;br /&gt;"; }
		}
		
		if (empty($errorMsg)) {
			
			$md5Password = md5($password);
			
			{  //   SQL:     $tUser_SQLinsert			
				$tUser_SQLinsert = "INSERT INTO tUser (";			
				$tUser_SQLinsert .=  "username, ";
				$tUser_SQLinsert .=  "password, ";
				$tUser_SQLinsert .=  "eMail, ";
				$tUser_SQLinsert .=  "accessLevel ";
				$tUser_SQLinsert .=  ") ";
				
				$tUser_SQLinsert .=  "VALUES (";
				$tUser_SQLinsert .=  "'".$username."', ";
				$tUser_SQLinsert .=  "'".$md5Password."', ";	
				$tUser_SQLinsert .=  "'".$eMail."', ";	
				$tUser_SQLinsert .=  "'".$accessLevel."' ";
				$tUser_SQLinsert .=  ") ";
			}
			
			if (mysql_query($tUser_SQLinsert))  {	
					$errorMsg = "";
			} else {
					$errorMsg = "FAILED to add new person.";
			}		
		} 		
		return $errorMsg;
		//		END: function userInsert()
	 }  
		

	
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_tLookup_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tLookup_SQL.php
*
*		folder:			includes/
*
*		used in:       anywhere
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			dropdowns of lookup values from tables:
*							tAccessControl and tLookup
*
*	===========================================================================
*/		

	function dropdownCountries($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'country' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="COUNTRY"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}		
		
		
	function dropdownCoRegTypes($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'RegType' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="RegType"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}		
		
		
	function dropdownUserAccess($currentValue) {

		$lookup_SQL =  "SELECT accessLevel, userType FROM tAccessControl ";
		$lookup_SQL .= "ORDER By accessLevel ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="accessLevel"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $accessLevel = $row['accessLevel'];
			    $userType = $row['userType'];
			    
			    if ($currentValue == $accessLevel) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option value="'.$accessLevel.'"'.$selectedFlag.'&gt;'.$userType.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';

		return $rendering;
	}		
				
		
	function dropdownSalutations($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'Salutation' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="Salutation"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';

		return $rendering;
	}		
			

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_tCompany_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tCompany_SQL.php
*
*		folder:			includes/
*
*		used in:       tp_companyInsert.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FUNCTIONS:
*							companyInsert - INSERTS new tcompany record
*							companyUpdate - UPDATES edits from tp_companyEditForm.php
*							companyDropdown - return HTML select of company list
*
*	===========================================================================
*/		

	function companyInsert($preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY) {

		$tcompany_SQLinsert = "INSERT INTO tCompany (";			
		$tcompany_SQLinsert .=  "preName, ";
		$tcompany_SQLinsert .=  "Name, ";
		$tcompany_SQLinsert .=  "RegType, ";
		$tcompany_SQLinsert .=  "StreetA, ";	
		$tcompany_SQLinsert .=  "StreetB, ";	
		$tcompany_SQLinsert .=  "StreetC, ";	
		$tcompany_SQLinsert .=  "Town, ";	
		$tcompany_SQLinsert .=  "County, ";	
		$tcompany_SQLinsert .=  "Postcode, ";	
		$tcompany_SQLinsert .=  "COUNTRY ";
		$tcompany_SQLinsert .=  ") ";
		
		$tcompany_SQLinsert .=  "VALUES (";
		$tcompany_SQLinsert .=  "'".$preName."', ";
		$tcompany_SQLinsert .=  "'".$companyName."', ";
		$tcompany_SQLinsert .=  "'".$RegType."', ";
		$tcompany_SQLinsert .=  "'".$StreetA."', ";	
		$tcompany_SQLinsert .=  "'".$StreetB."', ";	
		$tcompany_SQLinsert .=  "'".$StreetC."', ";
		$tcompany_SQLinsert .=  "'".$Town."', ";
		$tcompany_SQLinsert .=  "'".$County."', ";
		$tcompany_SQLinsert .=  "'".$Postcode."', ";
		$tcompany_SQLinsert .=  "'".$COUNTRY."' ";
		$tcompany_SQLinsert .=  ") ";

		if (!empty($companyName)) {
			if (mysql_query($tcompany_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new company.";
			}
		} else {
			$errorMsg = "Cannot add company with no Name.";
		}		
		return $errorMsg;
	}	


	function companyUpdate($companyID, $preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY) {
		
		$tcompany_SQLupdate = "UPDATE tCompany SET ";			
		$tcompany_SQLupdate .=  "preName = '".$preName."', "; 		
		$tcompany_SQLupdate .=  "Name = '".$companyName."', ";
		$tcompany_SQLupdate .=  "RegType = '".$RegType."', ";
		$tcompany_SQLupdate .=  "StreetA = '".$StreetA."', ";
		$tcompany_SQLupdate .=  "StreetB = '".$StreetB."', ";
		$tcompany_SQLupdate .=  "StreetC = '".$StreetC."', ";
		$tcompany_SQLupdate .=  "Town = '".$Town."', ";
		$tcompany_SQLupdate .=  "County = '".$County."', ";
		$tcompany_SQLupdate .=  "Postcode = '".$Postcode."', ";
		$tcompany_SQLupdate .=  "COUNTRY = '".$COUNTRY."' ";
		
		$tcompany_SQLupdate .=  "WHERE ID = '".$companyID."' "; 	
	
		if (!empty($companyName)) {
			if (mysql_query($tcompany_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update company.";
			}
		} else {
			$errorMsg = "Cannot make company Name empty.";
		}		
		
		return $errorMsg;
	}	


	function companyDropdown($currentIDvalue) {
		
		$tCompany_SQLselect = "SELECT  ";
		$tCompany_SQLselect .= "ID, preName, Name ";	
		$tCompany_SQLselect .= "FROM ";
		$tCompany_SQLselect .= "tCompany ";
		$tCompany_SQLselect .= "Order By Name ";
			
		$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
			
		$rendering = '&lt;select name="companyID"&gt;';
		
		$rendering .= '&lt;option value="0" label="coyvalue" selected="selected"&gt;';
		$rendering .= '..select company..&lt;/option&gt;';
	 	
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
				    $ID = $row['ID'];
				    $preName = $row['preName'];
				    $companyName = $row['Name'];
				    $RegType = $row['RegType'];
				    
				    $fullCoyName = trim($preName." ".$companyName." ".$RegType);

				    if ($currentIDvalue == $ID) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $rendering .= '&lt;option value="'.$ID.'" '.$selectedFlag.'&gt;'.$fullCoyName.'&lt;/option&gt;';
				}
				$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_personUpdate.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_personUpdate.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			UPDATES edits from tp_personEditForm.php
*
*	===========================================================================
*/		

	function personUpdate($personID, $Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {
		
		$tPerson_SQLupdate = "UPDATE tPerson SET ";			
		$tPerson_SQLupdate .=  "CompanyID = '".$companyID."', "; 
		
		$tPerson_SQLupdate .=  "Salutation = '".$Salutation."', ";
		$tPerson_SQLupdate .=  "FirstName = '".$FirstName."', ";
		$tPerson_SQLupdate .=  "LastName = '".$LastName."', ";
		$tPerson_SQLupdate .=  "Tel = '".$Tel."', ";
		$tPerson_SQLupdate .=  "eMail = '".$eMail."' ";
		$tPerson_SQLupdate .=  "WHERE ID = '".$personID."' "; 	
	
		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update person.";
			}
		} else {
			$errorMsg = "Cannot make Lastname empty.";
		}		
		
		return $errorMsg;
	}	

	
?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_tp_personInsert.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_personInsert.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			INSERTS the current fields to tPerson
*
*	===========================================================================
*/		

	function personInsert($Salutation, $FirstName, $LastName, $Tel, $eMail, $companyID) {

		$tPerson_SQLinsert = "INSERT INTO tPerson (";			
		$tPerson_SQLinsert .=  "Salutation, ";
		$tPerson_SQLinsert .=  "FirstName, ";
		$tPerson_SQLinsert .=  "LastName, ";
		$tPerson_SQLinsert .=  "Tel, ";	
		$tPerson_SQLinsert .=  "eMail, ";	
		$tPerson_SQLinsert .=  "companyID ";
		$tPerson_SQLinsert .=  ") ";
		
		$tPerson_SQLinsert .=  "VALUES (";
		$tPerson_SQLinsert .=  "'".$Salutation."', ";
		$tPerson_SQLinsert .=  "'".$FirstName."', ";
		$tPerson_SQLinsert .=  "'".$LastName."', ";
		$tPerson_SQLinsert .=  "'".$Tel."', ";	
		$tPerson_SQLinsert .=  "'".$eMail."', ";	
		$tPerson_SQLinsert .=  "'".$companyID."' ";
		$tPerson_SQLinsert .=  ") ";

		if (!empty($LastName)) {
			if (mysql_query($tPerson_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new person.";
			}
		} else {
			$errorMsg = "Cannot add person with no Lastname.";
		}		
		return $errorMsg;
	}	

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="09_END_fn_authorise.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_authorise.php
*
*		folder:			includes/
*
*		used in:        index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:		test $username, $password for authorisation
*
*	===========================================================================
*/		

	function userAuthorised($username, $password) {

			$md5Password = md5($password);
			$tUser_SQLselect = "SELECT ID, password, accessLevel FROM tUser ";
			$tUser_SQLselect .= "WHERE username = '".$username."' ";	

			$tUser_SQLselect_Query = mysql_query($tUser_SQLselect); 	
			while ($row = mysql_fetch_array($tUser_SQLselect_Query, MYSQL_ASSOC)) {
			    $userID = $row['ID'];
			    $passwordRetrieved = $row['password'];
			    $accessLevel = $row['accessLevel'];
			}
		
			mysql_free_result($tUser_SQLselect_Query);
						
			if (!empty($passwordRetrieved) AND ($md5Password == $passwordRetrieved)) {
	
					setcookie("accessLevel", $accessLevel, time()+7200, "/");	
					setcookie("userID", $userID, time()+7200, "/");	
					setcookie("loginAuthorised", "loginAuthorised", time()+7200, "/");
					
					$returnCode = true;
					
					$sessionLogged = insertLogin($userID);
					if (!$sessionLogged) {
						setcookie("sessionLogging", "failed", time()+300, "/");
					}				
			} else {
				$returnCode = false;			
			}
			
		return $returnCode;
	}


	function insertLogin($userID) {
		$success = false;
		//	Get current date-time in MySQL format
		$nowTimeStamp = date("Y-m-d H:i:s");
		//	Get user's IP address
		$userIP = $_SERVER['REMOTE_ADDR'];
	
		$insertLogin_SQL = 'INSERT INTO tAccessLog (
										userID, 
										timeLogin, 
										IPaddress
									) VALUES (
										'.$userID.',
										"'.$nowTimeStamp.'",
										"'.$userIP.'"
									)';
									
			if (mysql_query($insertLogin_SQL))  {	
				$success = true;
			} else {
				$success = $insertLogin_SQL."&lt;br /&gt;".mysql_error();		
			}	
			
		return $success;	
	}



?&gt;</before>
          <after/>
        </leaf>
      </branch>
    </branch>
    <branch title="exercises (Templates)">
      <branch title="Insert Company">
        <leaf type="insert" title="index: case &quot;insertCompany&quot;:">
          <before>				    case "insertCompany":
				        $contentFile = "includes/tp_companyInsert.php";
				        break;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_companyInsert.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyInsert.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FORM to enter new company details
*
*	===========================================================================
*/		


		include_once('includes/fn_tCompany_SQL.php');
							
		{	//	create the COUNTRY DROPDOWN  FIELD 	
		$companyInserted = $_POST["companyInserted"];
		if(!isset($companyInserted)) {$companyInserted = $_GET["companyInserted"]; }
		
		{	//		Insert New Person Record
			if(isset($companyInserted) AND $companyInserted == '1'){
				
				$preName = $_POST["preName"];	
				$companyName = $_POST["companyName"];	
				$RegType = $_POST["RegType"];	
				$StreetA = $_POST["StreetA"];	
				$StreetB = $_POST["StreetB"];	
				$StreetC = $_POST["StreetC"];	
				$Town = $_POST["Town"];	
				$County = $_POST["County"];	
				$Postcode = $_POST["Postcode"];	
				$COUNTRY = $_POST["COUNTRY"];	
					
				$insertMsg = companyInsert($preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY)	;
									
				if (!empty($insertMsg)) {
					echo $insertMsg;
				} else {
					$fullCoName = fullCoName('1', $preName, $companyName, $RegType);
					echo "Company &lt;strong&gt;".$fullCoName."&lt;/strong&gt; was successfully inserted.&lt;br /&gt;&lt;br /&gt;";	
				}
				
				unset($companyInserted);
			}		
		//		END:  Insert New Person Record		
		}
		


		$fld_companyInserted = '&lt;input type="hidden" name="companyInserted" value="1"/&gt;';

		{	//	FORM postCompany 
		//echo '&lt;form name="postCompany" action="companySave.php" method="post"&gt;';
		echo '&lt;form name="postCompany" action="index.php?content=insertCompany" method="post"&gt;';
				echo $fld_companyInserted;
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;pre Name&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="preName" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Company Name&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="companyName" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Reg Type&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="RegType" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Address&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetA" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetB" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="StreetC" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Town&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="Town" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;County&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="County" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Postcode&lt;/td&gt;
						&lt;td&gt;&lt;input type="text" name="Postcode" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;COUNTRY&lt;/td&gt;
						&lt;td&gt;'.$fld_COUNTRY.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
				';
					
		echo '&lt;/form&gt;';
		//	END: FORM postCompany 
		}		
		
	echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	echo '&lt;a href="../index.php"&gt;homepage&lt;/a&gt;';
	echo '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;';
	echo '&lt;a href="index.php?content=companyList"&gt;Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_tCompany_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tCompany_SQL.php
*
*		folder:			includes/
*
*		used in:       tp_companyInsert.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FUNCTIONS:
*							companyInsert - INSERTS new tcompany record
*							companyUpdate - UPDATES edits from tp_companyEditForm.php
*							companyDropdown - return HTML select of company list
*
*	===========================================================================
*/		

	function companyInsert($preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY) {

		$tcompany_SQLinsert = "INSERT INTO tCompany (";			
		$tcompany_SQLinsert .=  "preName, ";
		$tcompany_SQLinsert .=  "Name, ";
		$tcompany_SQLinsert .=  "RegType, ";
		$tcompany_SQLinsert .=  "StreetA, ";	
		$tcompany_SQLinsert .=  "StreetB, ";	
		$tcompany_SQLinsert .=  "StreetC, ";	
		$tcompany_SQLinsert .=  "Town, ";	
		$tcompany_SQLinsert .=  "County, ";	
		$tcompany_SQLinsert .=  "Postcode, ";	
		$tcompany_SQLinsert .=  "COUNTRY ";
		$tcompany_SQLinsert .=  ") ";
		
		$tcompany_SQLinsert .=  "VALUES (";
		$tcompany_SQLinsert .=  "'".$preName."', ";
		$tcompany_SQLinsert .=  "'".$companyName."', ";
		$tcompany_SQLinsert .=  "'".$RegType."', ";
		$tcompany_SQLinsert .=  "'".$StreetA."', ";	
		$tcompany_SQLinsert .=  "'".$StreetB."', ";	
		$tcompany_SQLinsert .=  "'".$StreetC."', ";
		$tcompany_SQLinsert .=  "'".$Town."', ";
		$tcompany_SQLinsert .=  "'".$County."', ";
		$tcompany_SQLinsert .=  "'".$Postcode."', ";
		$tcompany_SQLinsert .=  "'".$COUNTRY."' ";
		$tcompany_SQLinsert .=  ") ";

		if (!empty($companyName)) {
			if (mysql_query($tcompany_SQLinsert))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to add new company.";
			}
		} else {
			$errorMsg = "Cannot add company with no Name.";
		}		
		return $errorMsg;
	}	


	function companyUpdate($companyID, $preName, $companyName, $RegType, $StreetA, 
									$StreetB, $StreetC, $Town, $County,
									$Postcode, $COUNTRY) {
		
		$tcompany_SQLupdate = "UPDATE tCompany SET ";			
		$tcompany_SQLupdate .=  "preName = '".$preName."', "; 		
		$tcompany_SQLupdate .=  "Name = '".$companyName."', ";
		$tcompany_SQLupdate .=  "RegType = '".$RegType."', ";
		$tcompany_SQLupdate .=  "StreetA = '".$StreetA."', ";
		$tcompany_SQLupdate .=  "StreetB = '".$StreetB."', ";
		$tcompany_SQLupdate .=  "StreetC = '".$StreetC."', ";
		$tcompany_SQLupdate .=  "Town = '".$Town."', ";
		$tcompany_SQLupdate .=  "County = '".$County."', ";
		$tcompany_SQLupdate .=  "Postcode = '".$Postcode."', ";
		$tcompany_SQLupdate .=  "COUNTRY = '".$COUNTRY."' ";
		
		$tcompany_SQLupdate .=  "WHERE ID = '".$companyID."' "; 	
	
		if (!empty($companyName)) {
			if (mysql_query($tcompany_SQLupdate))  {	
				$errorMsg = "";
			} else {
				$errorMsg = "FAILED to update company.";
			}
		} else {
			$errorMsg = "Cannot make company Name empty.";
		}		
		
		return $errorMsg;
	}	


	function companyDropdown($currentIDvalue) {
		
		$tCompany_SQLselect = "SELECT  ";
		$tCompany_SQLselect .= "ID, preName, Name ";	
		$tCompany_SQLselect .= "FROM ";
		$tCompany_SQLselect .= "tCompany ";
		$tCompany_SQLselect .= "Order By Name ";
			
		$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
			
		$rendering = '&lt;select name="companyID"&gt;';
		
		$rendering .= '&lt;option value="0" label="coyvalue" selected="selected"&gt;';
		$rendering .= '..select company..&lt;/option&gt;';
	 	
				while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
				    $ID = $row['ID'];
				    $preName = $row['preName'];
				    $companyName = $row['Name'];
				    $RegType = $row['RegType'];
				    
				    $fullCoyName = trim($preName." ".$companyName." ".$RegType);

				    if ($currentIDvalue == $ID) { 
				    	$selectedFlag = " selected";
				    } else { 
				    	$selectedFlag = "";
				    }
				    $rendering .= '&lt;option value="'.$ID.'" '.$selectedFlag.'&gt;'.$fullCoyName.'&lt;/option&gt;';
				}
				$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}	


?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_tLookup_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tLookup_SQL.php
*
*		folder:			includes/
*
*		used in:       anywhere
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			dropdowns of lookup values from tables:
*							tAccessControl and tLookup
*
*	===========================================================================
*/		

	function dropdownCountries($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'country' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="COUNTRY"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}		
		
		
	function dropdownCoRegTypes($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'RegType' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="RegType"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}		
		
		
	function dropdownUserAccess($currentValue) {

		$lookup_SQL =  "SELECT accessLevel, userType FROM tAccessControl ";
		$lookup_SQL .= "ORDER By accessLevel ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="accessLevel"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $accessLevel = $row['accessLevel'];
			    $userType = $row['userType'];
			    
			    if ($currentValue == $accessLevel) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option value="'.$accessLevel.'"'.$selectedFlag.'&gt;'.$userType.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';

		return $rendering;
	}		
				
		
	function dropdownSalutations($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'Salutation' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="Salutation"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';

		return $rendering;
	}		
			

?&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="Insert User">
        <leaf type="insert" title="index: case &quot;insertUser&quot;">
          <before>				    case "insertUser":					
 				        $contentFile = "includes/tp_userInsert.php";
				        break;
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_userInsert.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_userInsert.php
*
*		folder:			includes/
*
*		used in:       index.php
*
*		version:    	0901   date: 2010-07-01
*
*		purpose:			FORM to enter new user details
*							POST fields to itself via index.php?content=insertCompany
*							invoke function companyInsert(...) [from file fn_tCompany_SQL.php]
*
*	=====================================================================================
*/		

		include_once('includes/fn_tLookup_SQL.php');
		include_once('includes/fn_tUser_SQL.php');

		{  //   collect the data with $_POST
			$username = $_POST["username"];	
			$password = $_POST["password"];	
			$passwordValidate = $_POST["passwordValidate"];	
			$eMail = $_POST["eMail"];	
			$accessLevel = $_POST["accessLevel"];	
							
			$userInserted = $_POST["userInserted"];

		}
		
		{	//		Insert New tUser Record
			if(isset($userInserted) AND $userInserted == '1'){
				
				$insertMsg = userInsert($username, $password, $passwordValidate, $eMail, $accessLevel);
					
				if (empty($insertMsg)) {
					echo "User &lt;strong&gt;".$username."&lt;/strong&gt; was successfully inserted.&lt;br /&gt;&lt;br /&gt;";
				} else {
					echo $insertMsg;
				}
				
				unset($userInserted);
			}		
		//		END:  Insert New tUser Record		
		}
		
		$fld_userInserted = '&lt;input type="hidden" name="userInserted" value="1"/&gt;';
		$fld_access = dropdownUserAccess('');
		
			{	//	FORM postUser
			echo '&lt;form name="postUser" action="index.php?content=insertUser" method="post"&gt;';
					echo $fld_userInserted;
					echo '
					&lt;table&gt;
						&lt;tr&gt;
							&lt;td&gt;username&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="username" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;password&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="password" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;retype password&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="passwordValidate" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;eMail&lt;/td&gt;
							&lt;td&gt;&lt;input type="text" name="eMail" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;access level&lt;/td&gt;
							&lt;td&gt;'.$fld_access.'&lt;/td&gt;
						&lt;/tr&gt;
						&lt;tr&gt;
							&lt;td&gt;&lt;/td&gt;
							&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
						&lt;/tr&gt;
					&lt;/table&gt;
					';
						
			echo '&lt;/form&gt;';
			//	END: FORM postUser 
			}			
		
		
	echo "&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;";

	echo '&lt;a href="../index.php"&gt;homepage&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn_tUser_SQL.php">
          <before>&lt;?php

/*		INCLUDE FILE:   fn_tUser_SQL.php
*
*		folder:			includes/
*
*		used in:       anywhere
*
*		version:    	0907   date: 2010-07-01
*
*		purpose:			SQL commands for tUser, tAccessLog and tAccessControl
*
*		content:			function userInsert($username, $password, $eMail, $accessLevel)
*
*
*	===========================================================================
*/		

	function userInsert($username, $password, $passwordValidate, $eMail, $accessLevel) {

		{	//		check the data before processing it
			$errorMsg = "";		 
			if (strlen($username) &lt; 5) { $errorMsg = "Username cannot be less than 5 characters&lt;br /&gt;"; }
			if (strlen($password) &lt; 5) { $errorMsg .= "Password cannot be less than 5 characters&lt;br /&gt;"; }
			if ($password &lt;&gt; $passwordValidate) { $errorMsg .= "Password retype does not match.&lt;br /&gt;"; }
		}
		
		if (empty($errorMsg)) {
			
			$md5Password = md5($password);
			
			{  //   SQL:     $tUser_SQLinsert			
				$tUser_SQLinsert = "INSERT INTO tUser (";			
				$tUser_SQLinsert .=  "username, ";
				$tUser_SQLinsert .=  "password, ";
				$tUser_SQLinsert .=  "eMail, ";
				$tUser_SQLinsert .=  "accessLevel ";
				$tUser_SQLinsert .=  ") ";
				
				$tUser_SQLinsert .=  "VALUES (";
				$tUser_SQLinsert .=  "'".$username."', ";
				$tUser_SQLinsert .=  "'".$md5Password."', ";	
				$tUser_SQLinsert .=  "'".$eMail."', ";	
				$tUser_SQLinsert .=  "'".$accessLevel."' ";
				$tUser_SQLinsert .=  ") ";
			}
			
			if (mysql_query($tUser_SQLinsert))  {	
					$errorMsg = "";
			} else {
					$errorMsg = "FAILED to add new person.";
			}		
		} 		
		return $errorMsg;
		//		END: function userInsert()
	 }  
		

	
?&gt;</before>
          <after/>
        </leaf>
      </branch>
      <branch title="Update Company">
        <leaf type="insert" title="SQL - tLookup.RegTypes">
          <before>INSERT INTO tLookup (
lookupType , lookupValue, lookupOrder 
)
VALUES 
('RegType', 'Ltd.', 1), 
('RegType', 'LLC.', 2), 
('RegType', 'plc', 3), 
('RegType', 'GmbH', 4), 
('RegType', 'BV', 5), 
('RegType', 'Inc.', 6), 
('RegType', 'AG', 7), 
('RegType', 'AB', 8)
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="fn: dropdownCountries">
          <before>	function dropdownCountries($currentValue) {

		$lookup_SQL =  "SELECT lookupValue FROM tLookup ";
		$lookup_SQL .= "WHERE lookupType = 'country' ";
		$lookup_SQL .= "ORDER By lookupOrder ";
		
		$lookup_SQL_Query = mysql_query($lookup_SQL);	

		$rendering = '&lt;select name="COUNTRY"&gt;';		 
		$rendering .= '&lt;option&gt;&lt;/option&gt;';	
			while ($row = mysql_fetch_array($lookup_SQL_Query, MYSQL_ASSOC)) {
			    $itmeValue = $row['lookupValue'];
			    if ($currentValue == $itmeValue) { 
			    	$selectedFlag = " selected";
			    } else { 
			    	$selectedFlag = "";
			    }
			    $rendering .= '&lt;option'.$selectedFlag.'&gt;'.$itmeValue.'&lt;/option&gt;';
			}			
		$rendering .= '&lt;/select&gt;';
		
		return $rendering;
	}		
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_companyEditForm.php">
          <before>&lt;?php

/*		INCLUDE FILE:   tp_companyEditForm.php
*
*		folder:			includes/
*
*		used in:       tp_companyList.php
*
*		version:    	0907   date: 2010-07-01
*
*		purpose:			EDIT FORM for tCompany record selected  
*							by clicking company Name in tp_companyList.php
*
*	===========================================================================
*/	
	include_once('includes/fn_tLookup_SQL.php');
	include_once('includes/fn_tCompany_SQL.php');

	$companyID = $_POST["companyID"];
	if(!isset($companyID)) {$companyID = $_GET["companyID"]; }

	$thisScriptName = 'index.php?content=editCompany&amp;companyID='.$companyID;
	
		$companyEdited = $_POST["companyEdited"];
		if(!isset($companyEdited)) {$companyEdited = $_GET["companyEdited"]; }
	
	
	{	//		Update tCompany Record
		if(isset($companyEdited) AND $companyEdited == '1'){
			
			$preName = $_POST["preName"];	
			$companyName = $_POST["companyName"];	
			$RegType = $_POST["RegType"];	
			$StreetA = $_POST["StreetA"];	
			$StreetB = $_POST["StreetB"];	
			$StreetC = $_POST["StreetC"];	
			$Town = $_POST["Town"];	
			$County = $_POST["County"];	
			$Postcode = $_POST["Postcode"];	
			$COUNTRY = $_POST["COUNTRY"];	

			$insertMsg = companyUpdate($companyID, $preName, $companyName, $RegType, $StreetA, 
								$StreetB, $StreetC, $Town, $County,
								$Postcode, $COUNTRY);

								
			if (empty($insertMsg)) {
				$fullCoName = fullCoName('1', $preName, $companyName, $RegType);
				echo "Company &lt;strong&gt;".$fullCoName."&lt;/strong&gt; was successfully updated.&lt;br /&gt;&lt;br /&gt;";						
			} else {
				echo $insertMsg;
			}
			
			unset($companyInserted);
		}		
	//		END:  Update tCompany Record
	}

	{	//  Get the details of the company selected 

			$tCompany_SQLselect = "SELECT * ";
			$tCompany_SQLselect .= "FROM ";
			$tCompany_SQLselect .= "tCompany ";
			$tCompany_SQLselect .= "WHERE ID = '".$companyID."' ";
			
			$tCompany_SQLselect_Query = mysql_query($tCompany_SQLselect);	
			
			while ($row = mysql_fetch_array($tCompany_SQLselect_Query, MYSQL_ASSOC)) {
				$current_preName = $row['preName'];
				$current_Name = $row['Name'];
				$current_RegType = $row['RegType'];
				
				$current_StreetA = $row['StreetA'];
				$current_StreetB = $row['StreetB'];
				$current_StreetC = $row['StreetC'];
				$current_Town = $row['Town'];
				$current_County = $row['County'];
				$current_Postcode = $row['Postcode'];
				$current_COUNTRY = $row['COUNTRY'];
				 
			}
	}

	//		FORM vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
	{	//		Create form fields 
		$fld_ID = '&lt;input type="hidden" name="companyID" value="'.$companyID.'"/&gt;';
		$fld_companyEdited = '&lt;input type="hidden" name="companyEdited" value="1"/&gt;';

		$fld_preName = '&lt;input type="text" name="preName" value="'.$current_preName.'"/&gt;';
		$fld_companyName = '&lt;input type="text" name="companyName" value="'.$current_Name.'"/&gt;';
		
		$fld_RegType = dropdownCoRegTypes($current_RegType);
		
		$fld_StreetA = '&lt;input type="text" name="StreetA" value="'.$current_StreetA.'"/&gt;';
		$fld_StreetB = '&lt;input type="text" name="StreetB" value="'.$current_StreetB.'"/&gt;';
		$fld_StreetC = '&lt;input type="text" name="StreetC" value="'.$current_StreetC.'"/&gt;';
		$fld_Town = '&lt;input type="text" name="Town" value="'.$current_Town.'"/&gt;';
		$fld_County = '&lt;input type="text" name="County" value="'.$current_County.'"/&gt;';
		$fld_Postcode = '&lt;input type="text" name="Postcode" value="'.$current_Postcode.'"/&gt;';

		
		$fld_COUNTRY = dropdownCountries($current_COUNTRY);

	//  END: Create form fields 
	}
		
	{	//		render FORM postCompany 
		echo '&lt;form name="postCompany" action="index.php?content=editCompany" method="post"&gt;';

			
				echo $fld_ID.$fld_companyEdited;	
				echo '&lt;input type="hidden" name="companyID" value="'.$companyID.'"/&gt;';
				echo '
				&lt;table&gt;
					&lt;tr&gt;
						&lt;td&gt;pre Name&lt;/td&gt;
						&lt;td&gt;'.$fld_preName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Company Name&lt;/td&gt;
						&lt;td&gt;'.$fld_companyName.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Reg Type&lt;/td&gt;
						&lt;td&gt;'.$fld_RegType.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Address&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetA.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetB.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td&gt;'.$fld_StreetC.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Town&lt;/td&gt;
						&lt;td&gt;'.$fld_Town.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;County&lt;/td&gt;
						&lt;td&gt;'.$fld_County.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;Postcode&lt;/td&gt;
						&lt;td&gt;'.$fld_Postcode.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;COUNTRY&lt;/td&gt;
						&lt;td&gt;'.$fld_COUNTRY.'&lt;/td&gt;
					&lt;/tr&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;/td&gt;
						&lt;td align="right"&gt;&lt;input type="submit"  value="Save" /&gt;&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
				';
					
		echo '&lt;/form&gt;';
	}
	

echo '&lt;br /&gt;&lt;hr /&gt;&lt;br /&gt;';
echo '&lt;a href="index.php?content=companyList"&gt;Back to Company List&lt;/a&gt;';

?&gt;</before>
          <after/>
        </leaf>
        <leaf type="insert" title="tp_co..List + linkToEditCo..">
          <before>
			$linkToEditCompany = '&lt;a href="index.php?content=editCompany&amp;companyID='.$ID.'"&gt;'
										.$CompanyFullName.'&lt;/a&gt;';
			
</before>
          <after/>
        </leaf>
        <leaf type="insert" title="..... + &lt;td&gt;$LINK&lt;/td&gt;';">
          <before>	//			echo '&lt;td&gt;'.$CompanyFullName.'&amp;nbsp;&lt;/td&gt;';
				echo '&lt;td&gt;'.$linkToEditCompany.'&amp;nbsp;&lt;/td&gt;';
</before>
          <after/>
        </leaf>
      </branch>
    </branch>
  </branch>
</snippets>
